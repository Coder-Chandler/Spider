[{"url_object_id": "fd842a72622552f4dffcc903ae3af9b5", "praise_num": 2, "tags": "IT技术", "fav_nums": 4, "title": "漫画算法：什么是 B 树？", "comments_num": 1, "create_date": "2017/07/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/f4156a04d1ce10e1d6b6e119ce1fc3db.jpg"], "front_image_path": "full/3f0be7614d3c4b769873121d69a7e1ad5ae8b755.jpg", "url": "http://blog.jobbole.com/111757/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<blockquote><p>伯乐在线补充：本文提到的「B-树」，就是「B树」，都是 B-tree 的翻译，里面不是减号-，是连接符-。因为有人把 B-tree 翻成 「B-树」，让人以为「B树」和「B-树」是两种树，实际上两者就是同一种树。</p></blockquote>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f4156a04d1ce10e1d6b6e119ce1fc3db.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/fc713400ca8ce73e4d4f7b656974a270.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/98d1b3066e41fa6e28ad131e4f04f2d5.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4cb37c6fcae8dbb405cb4b8ed10112aa.jpg\" alt=\"\"></p>\n<p>————————————</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/70f82597c6205ae0b915cf9446605986.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/fbb934ec8ef90054d26303d34bb27a24.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/616f5e86b4cf206dcfee036fd55e9602.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ce70b97a696efa28520a19e5adea080c.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/54f122a98313bd4f61c2e95d9858eaf6.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/06556ae2f9f1dbf3bc798b350a97290a.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b159585a12d50e1fbfffa2d892fde68f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/40fb54cfbec0e48c40e3f01d79f2cc3e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/89cca300c77afb89a592d252de98f012.jpg\" alt=\"\"></p>\n<p>————————————</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f2ab28eb6aa7b3efce6c000aed8ccba2.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/29249cf3f3edddb4eb738a4b05eff361.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0264f0d13bce4acf176e0e67412e02d8.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/093de5649072fa0e9118d6b47ea4c39f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0aa46ad4cff77069122a89d83238dd02.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1516c8202da7f5df1ba479edeff75d9e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/70d834f21e6e7a482270817f1ef9b66a.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a5c3760c3b6375ab7f3db270c833205.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/423081a186bb730f6246d4fc88fe8397.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/35e21257dd7649cbf648f8a12c9526bf.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/be4e8c9eea941021983b3a0ec2e30fe7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c8115df892823961e16b58e50f2745f7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3fc378e0a26f0a455b5de0c2b9085d0e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2540a2a93236be26570e7cfed001dd0c.jpg\" alt=\"\"></p>\n<p><strong>二叉查找树的结构：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a48d291a87e8f7451d7096f06c28a266.jpg\" alt=\"\"></p>\n<p><strong>第1次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c3afbbed4dc8d9ab0eb28f36c525eb64.jpg\" alt=\"\"></p>\n<p><strong>第2次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eaaadd8563fe9c2ce028b356b4b1b972.jpg\" alt=\"\"></p>\n<p><strong>第3次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/29510bc7455978e0a4b76538c481d211.jpg\" alt=\"\"></p>\n<p><strong>第4次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e776aad15f9db6791ed4ece4cebf179b.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/519a5ecae2049027e151f56404221cd6.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/57a3d2232bdc3602101d26de6af70629.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dfe811439d5a4b83908d1aece65b2858.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a551a5af0899d0f4487d5174c879fbee.jpg\" alt=\"\"></p>\n<p><strong>下面来具体介绍一下B-树（Balance Tree），一个m阶的B树具有如下几个特征：</strong></p>\n<p>1.根结点至少有两个子女。</p>\n<p>2.每个中间节点都包含k-1个元素和k个孩子，其中 m/2 &lt;= k &lt;= m</p>\n<p>3.每一个叶子节点都包含k-1个元素，其中 m/2 &lt;= k &lt;= m</p>\n<p>4.所有的叶子结点都位于同一层。</p>\n<p>5.每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域分划。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3bdde769e986c29df17ee5a05e2283f5.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1053258e35bc3a11daa6a35c0a4876a5.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7b6f7416cab11f23fa141cbcbe5ae97b.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e4bab35b22e04f408f20d9d78dd1ada7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1da23fc560320dd7fc33c4250f7bc62f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a18c14c033cc7773cbc5417b47c8433e.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e00c03897682ce16665f1fc6a103fae5.jpg\" alt=\"\"></p>\n<p><strong>第1次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a9bff5a34ad1b721c406d49aa5f71c7f.jpg\" alt=\"\"></p>\n<p><strong>在内存中定位（和9比较）：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e7aad0107f143df4d294f6d4ddc2efca.jpg\" alt=\"\"></p>\n<p><strong>第2次磁盘IO：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/55f9ffb7ec69c5624d3d38c3e487619f.jpg\" alt=\"\"></p>\n<p><strong>在内存中定位（和2，6比较）：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7181bf7db0d93d67a6d19e98bdec086a.jpg\" alt=\"\"></p>\n<p>第3次磁盘IO：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c7d939ddbd73ea5a28ab7c895e996d1e.jpg\" alt=\"\"></p>\n<p><strong>在内存中定位（和3，5比较）：</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e00c658824f6979d5c2a6526adcdd07.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a8d6dd48be32ff61f0a20955c3f1231.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e067432832fd13a46e588a4165f6f2e9.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/150acc7b44a31e028d53b97e44e6a7f7.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/301f7f8c3add3183aa7fcc85a6ac584c.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/07469afd080afb68036063ba808965f1.jpg\" alt=\"\"></p>\n<p>自顶向下查找4的节点位置，发现4应当插入到节点元素3，5之间。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b19105d47fd35c8b0d1e7ed2248bdaa0.jpg\" alt=\"\"></p>\n<p>节点3，5已经是两元素节点，无法再增加。父亲节点 2， 6 也是两元素节点，也无法再增加。根节点9是单元素节点，可以升级为两元素节点。于是<strong>拆分</strong>节点3，5与节点2，6，让根节点9升级为两元素节点4，9。节点6独立为根节点的第二个孩子。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1a708a324257d422e594224c6f7afad4.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/60daf22a13c44bec7cd0384a04fe9e12.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ebf569b446c84c77405395ea1503477c.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ed7fea3cc0eeab4fac24420dfa6a57c0.jpg\" alt=\"\"></p>\n<p>自顶向下查找元素11的节点位置。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ca7856622c48d55fbf9502f4ef8219b7.jpg\" alt=\"\"></p>\n<p>删除11后，节点12只有一个孩子，不符合B树规范。因此找出12,13,15三个节点的中位数13，取代节点12，而节点12自身下移成为第一个孩子。（这个过程称为<strong>左旋</strong>）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f5f4b28523d3d381b63c11b7ab3ac7d3.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/8d567b18da9582a3dbed613232117001.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7041d2780cb7fa9bf64af19b6476dc2f.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/04191ffe9d9fa92c54b4375b8b3da210.jpg\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0fd1168e35ccc3953584f971f38c75b5.jpg\" alt=\"\"></p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/2df4a3ede6e684f78858dfde0e7b118f.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111757\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111757votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111757\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/7ce4028f2cece3294efcb3e5caa73af1.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            互联网公司的码农一枚，喜欢算法和面向对象设计。个人微信号：13522239721 个人订阅号：dreamsee321欢迎一起交流讨论！        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/bjweimengshu\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/bjweimengshu/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 94</a> · <a title=\"个人微信：bjweimengshu\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "28306cda6bcd694e383903e031f1cdfe", "praise_num": 1, "tags": "开发", "fav_nums": 0, "title": "C++17 相比于 C++14 的所有重大变化", "comments_num": 0, "create_date": "2017/07/11", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/05/2b6a906c5f04bf387ccf049e4a20b855.png"], "front_image_path": "full/b7ccda3a3b2f793882325f528f2211d69c7b4f95.jpg", "url": "http://blog.jobbole.com/111801/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2017/p0636r1.html\">open-std</a>   译文出处：<a target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/27551890\">d41d8c</a>   </div><h2>摘要</h2>\n<p>本文档列举了自C++14发布以来，到C++17 DIS（N4660）发布为止，应用于C++工作草案（working draft）的所有重大变化。重大变化（major changes）是以专门的文件（paper）的形式加入的。不是每个文件都单独在此提及，没有单独提及的文件在下面简要列出。CWG或LWG问题清单（issue list）中的问题解决方案（issue resolution）通常不包括在重大变化之内，但是包含问题解决方案的文件也会简要列出。</p>\n<h2>目录</h2>\n<ol>\n<li>删除或弃用的特性</li>\n<li>具有全局影响的新的核心语言特性</li>\n<li>具有局部影响的新的核心语言特性</li>\n<li>新的库特性</li>\n<li>对现有特性的修改</li>\n<li>杂项</li>\n<li>未列入的文件</li>\n<li>展示C++17的代码片段合集</li>\n</ol>\n<h2>删除或弃用的特性</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4086\" target=\"_blank\" rel=\"nofollow noreferrer\">N4086<i class=\"icon-external\"></i></a><br>\n概要：删除trigraph<br>\n注释：字符序列 ??! 不再表示 | 。实现（implementation）可以把类似trigraph的功能作为输入编码的一环。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0001r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0001R1<i class=\"icon-external\"></i></a><br>\n概要：删除register<br>\n注释：register仍然是保留字，但是不再具有任何语义。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0002r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0002R1<i class=\"icon-external\"></i></a><br>\n概要：删除bool类型的++运算<br>\n注释：前自增和后自增运算符不再接受bool类型的操作数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0003r5\" target=\"_blank\" rel=\"nofollow noreferrer\">P0003R5<i class=\"icon-external\"></i></a><br>\n概要：删除throw(A, B, C)<br>\n注释：形如throw(A, B, C)的动态异常规范（dynamic exception specification）不再是合法的。throw()保留，成为noexcept(true)的同义词。注意throw()的语义变化。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0386r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0386R2<i class=\"icon-external\"></i></a><br>\n概要：弃用static constexpr成员的重复声明<br>\n注释： 对于struct X { static constexpr int n = 10; };，int X::n;不再是定义，而是多余的重复声明，这种重复声明已被弃用。成员X::n是隐含的inline变量（见下文）。</p>\n<p>———-</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4190\" target=\"_blank\" rel=\"nofollow noreferrer\">N4190<i class=\"icon-external\"></i></a><br>\n概要：删除auto_ptr、random_shuffle、&lt;functional&gt;中的过时部分<br>\n注释：在C++11已经被弃用并被更好的组件取代的功能将不再包含于C++17中。它们的名字仍然是保留的，实现可以选择继续提供。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0004r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0004R1<i class=\"icon-external\"></i></a><br>\n概要：删除被弃用的iostream成员<br>\n注释：同上</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0302r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0302R1<i class=\"icon-external\"></i></a><br>\n概要：删除std::function的内存分配器（allocator）支持<br>\n注释：多态函数包装器function不再具有接受内存分配器的构造函数。内存分配器支持对具有类型擦除（type-erase）功能的可复制类型来说很困难，可能无法有效实现。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0063r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0063R3<i class=\"icon-external\"></i></a>（见下文）<br>\n概要：弃用一些C库（C library）头文件（header）<br>\n注释：“C库”（C library，这个术语指的是C++标准库的一部分， 而不是C标准库的一部分）中的以下头文件被弃用：&lt;ccomplex&gt;、&lt;cstdalign&gt;、&lt;cstdbool&gt;、&lt;ctgmath&gt;。注意&lt;ciso646&gt;头文件没有被弃用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0174r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0174R2<i class=\"icon-external\"></i></a><br>\n概要：弃用标准库中的陈旧部分<br>\n注释：以下组件被弃用：allocator&lt;void&gt;、raw_storage_iterator、get_temporary_buffer、is_literal_type、std::iterator。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0618r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0618R0<i class=\"icon-external\"></i></a><br>\n概要：弃用&lt;codecvt&gt;<br>\n注释：整个&lt;codecvt&gt;头文件（注意codecvt类并不在这个头文件中）被弃用。wstring_convert和wbuffer_convert也被弃用。这些功能难以正确使用，甚至有怀疑它们的规范是否正确。用户应该使用专用的文本处理库。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0371r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0371R1<i class=\"icon-external\"></i></a><br>\n概要：暂时弃用memory_order_consume<br>\n注释： 当前的“consume”内存序的语义被发现是不够的，需要重新定义。这项工作希望能在C++的下一版中完成。在进行这项工作的时间里，建议用户不要使用“consume”内存序，而是使用“acquire”内存序，以免将来遇到问题。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0521r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0521R0<i class=\"icon-external\"></i></a><br>\n概要：弃用shared_ptr::unique<br>\n注释：该成员函数暗示了没有实际提供的行为。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0604r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0604R0<i class=\"icon-external\"></i></a><br>\n概要：弃用result_of<br>\n注释：请改用新的trait：invoke_result。</p>\n<h2>具有全局影响的新的核心语言特性</h2>\n<p>这些是在不需要你知情或同意的情况下，你可能遇到的特性。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0012r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0012R1<i class=\"icon-external\"></i></a><br>\n概要：异常规范（exception specification）作为类型系统的一部分<br>\n注释：函数的异常规范现在是函数类型的一部分：void f() noexcept(true); 和 void f() noexcept(false); 是具有不同类型的函数。函数指针可以按符合常理的方式转换。（但是这两个函数 f 不能构成重载。）这个变化加强了类型系统。例如，API可以通过类型系统要求回调函数不抛出异常。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0135r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0135R1<i class=\"icon-external\"></i></a><br>\n概要：保证的复制消除（guaranteed copy elision）<br>\n注释：prvalue和glvalue的含义已被修改，prvalue不再代表对象（object），而仅仅代表“初始化”（“initialization”）。返回prvalue的函数不再会复制对象（强制复制消除“mandatory copy elision”），并且有了新的从prvalue到glvalue的转换，叫做<i>temporary materialization conversion</i>。这个变化意味着复制消除是保证了的，而且甚至可以应用于不可移动或复制的类型。这允许你定义返回这种（不可移动或复制的）类型的函数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0035r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0035R4<i class=\"icon-external\"></i></a><br>\n概要：过度对齐类型（over-aligned types——即alignment超过std::max_align_t的类型）的动态内存分配<br>\n注释：动态内存分配（operator new）现在可以支持过度对齐的类型，这个运算符的一个新的重载接受对齐要求（alignment）参数。仍然是由实现决定支持哪些对齐。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0145r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0145R3<i class=\"icon-external\"></i></a><br>\n概要：更严格的表达式求值顺序<br>\n注释：对某些子表达式的求值顺序的规定更多了。这个变化的一个重要方面是函数的各个实参现在以不确定（indeterminate）的顺序的求值（也就是说没有交错 interleaving），而以前只是未指定的（unspecified）。注意重载运算符的求值顺序和调用方式有关：如果按照运算符的形式调用，就和相应的内置运算符的顺序相同；如果按照函数调用的形式调用，就和一般的函数调用相同（也就是不确定的 indeterminate）。</p>\n<h2>具有局部影响的新的核心语言特性</h2>\n<p>这些是如果你要使用，你就需要知道的特性。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4267\" target=\"_blank\" rel=\"nofollow noreferrer\">N4267<i class=\"icon-external\"></i></a><br>\n概要：u8字符字面量<br>\n注释：具有u8前缀的字符字面量产生一个在UTF-8中占有一个编码单元（code unit）的合法Unicode代码点（code point）对应的字符，换句话说，就是产生一个ASCII值。例如：u8’x’。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0245r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0245R1<i class=\"icon-external\"></i></a><br>\n概要：十六进制浮点数字面量<br>\n注释：具有十六进制底数和十进制指数的浮点数字面量： 0xC.68p+2, 0x1.P-126。C语言自从C99开始就支持这种语法， printf的%a可以输出这种形式的浮点数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4295\" target=\"_blank\" rel=\"nofollow noreferrer\">N4295<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0036r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0036R0<i class=\"icon-external\"></i></a><br>\n概要：fold表达式<br>\n注释：用于迭代地将二元运算符应用于参数包（parameter pack）的元素的便利语法：template &lt;typename …Args&gt; auto f(Args …args) { return <b>(0 + … + args)</b>; }</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0127r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0127R2<i class=\"icon-external\"></i></a><br>\n概要：template &lt;auto&gt;<br>\n注释：模板的非类型形参可以用占位符类型auto声明。例如：<br>\n• template &lt;<b>auto</b> X&gt; struct constant { static constexpr auto value = X; };<br>\n• Delegate&lt;&amp;MyClass::some_function&gt;<br>\n（←_←第二个例子的完整版本见下文）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0091r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0091R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0512r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0512R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0433r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0433R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0620r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0620R0<i class=\"icon-external\"></i></a><br>\n概要：类模板参数推导<br>\n注释：类模板的模板参数现在可以从构造函数推导。例如 pair p(1, ‘x’); 定义 p 为 pair&lt;int, char&gt; 类型的变量（这不是HTML错误，模板实参是故意省略的）。显式的推导指引（deduction guide）是隐式推导的补充，显式的推导指引允许作者定制推导如何发生，或者禁止推导。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0292r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0292R2<i class=\"icon-external\"></i></a><br>\n概要：Constexpr if<br>\n注释：新的 if <b>constexpr</b> (<i>condition</i>) 语句根据常量表达式（constant expression）的值选择执行哪个分支。在模板的实例中，只有在条件（condition）具有合适的值的时候，对应的分支才会实例化。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0305r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0305R1<i class=\"icon-external\"></i></a><br>\n概要：带初始化的选择语句<br>\n注释：选择语句 if 和 switch 有了一个新的、可选的初始化部分：if (auto it = m.find(key); it != m.end()) return it-&gt;second;</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0170r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0170R1<i class=\"icon-external\"></i></a><br>\n概要：Constexpr lambda<br>\n注释：lambda表达式现在可以是常量表达式了：auto add = [](int a, int b) <b>constexpr</b> { return a + b; }; int arr[add(1, 2)];</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0018r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0018R3<i class=\"icon-external\"></i></a><br>\n概要：lambda捕获*this<br>\n注释：以前：[self = *this]{ self.f(); } 现在：[<b>*this</b>]{ f(); }</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0386r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0386R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0607r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0607R0<i class=\"icon-external\"></i></a><br>\n概要：inline变量<br>\n注释：在头文件中：<b>inline</b> int n = 10; 所有定义都指代同一个实体。static constexpr 成员变量隐含地成为 inline 变量。（标准库中的常量，不论是已有的还是新增的，都已使用inline。）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0217r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0217R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0615r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0615R0<i class=\"icon-external\"></i></a><br>\n概要：结构化绑定<br>\n注释：<b>auto [it, ins]</b> = m.try_emplace(key, a1, a2, a3);<br>\n可以分解数组、所有成员都是public的类、像pair、tuple和array一样遵循get&lt;N&gt;协议的自定义类型。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0061r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0061R1<i class=\"icon-external\"></i></a><br>\n概要：__has_include<br>\n注释：检查能否包含特定头文件的预处理运算符。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0188r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0188R1 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0189r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0189R1 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0212r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0212R1<i class=\"icon-external\"></i></a><br>\n概要：属性（attribute）[[fallthrough]]、[[nodiscard]]、[[maybe_unused]]（分别对应三个文件）<br>\n注释：一套新的标准化属性。属性没有必要的语义，但是鼓励实现发出或抑制适当的诊断（警告）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0137r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0137R1<i class=\"icon-external\"></i></a><br>\n概要：launder<br>\n注释：语言支持工具（“优化屏障optimisation barrier”），允许库重新使用存储（storage），并通过旧指针访问该存储（以前是不允许的）。（这是实现者的专家工具，预期不会在“正常”代码中出现）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0298r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0298R3<i class=\"icon-external\"></i></a><br>\n概要：字节类型<br>\n注释：新的类型byte在&lt;cstddef&gt;中定义（不在&lt;stddef.h&gt;，并且只定义在命名空间std中），它和unsigned char具有相同的布局，和现有的字符类型一样允许别名（aliasing），并且定义了按位操作。</p>\n<h2>新的库特性</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0226r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0226R1<i class=\"icon-external\"></i></a><br>\n概要：数学特殊函数（mathematical special functions）<br>\n注释：前国际标准ISO/IEC 29124:2010（数学特殊函数）的内容现在是C++的一部分。 这些函数只添加到&lt;cmath&gt; ，而没有添加到&lt;math.h&gt; ，并且只定义在命名空间std中。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0218r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0218R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0219r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0219R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0317r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0317R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0392r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0392R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0430r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0430R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0492r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0492R2<i class=\"icon-external\"></i></a><br>\n概要：文件系统<br>\n注释：文件系统技术规范（Filesystems Technical Specification）的内容现在是C++的一部分。 文件系统库允许以可移植的方式与目录和类似目录的结构进行交互（列出文件目录的内容，移动文件等）。 它主要以POSIX为模型，但它足够灵活，可以在各种系统上实现。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0024r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0024R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0336r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0336R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0394r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0394R4<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0452r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0452R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0467r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0467R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0502r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0502R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0518r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0518R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0523r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0523R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0574r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0574R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0623r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0623R0<i class=\"icon-external\"></i></a><br>\n概要：并行<br>\n注释：并行技术规范（Parallelism Technical Specification）的内容现在是C++的一部分。它为很多算法（algorithm）增加了重载，这些新的重载额外接受一个<i>执行策略</i>（<i>execution policy</i>）参数。它也加入了新的算法（见下文）。 支持三种执行策略，分别提供顺序（sequential），并行（ parallel）和向量化（vectorized）的执行。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0024r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0024R2<i class=\"icon-external\"></i></a><br>\n概要：新算法<br>\n注释：并行技术规范为标准库添加了几种新算法。加入它们的动机是它们可以有效地并行执行，但也提供了通常的（不接受execution policy参数的）简单形式：for_each_n、reduce、transform_reduce、exclusive_scan、inclusive_scan、transform_exclusive_scan、transform_inclusive_scan。请注意， reduce看起来与现有的accumulate相似，但reduce不保证任何特定的操作顺序。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0254r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0254R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0403r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0403R1<i class=\"icon-external\"></i></a><br>\n概要：新类型：string_view（以及basic_string_view）<br>\n注释：新的string_view类是API接口的推荐类型，如果API需要读取字符串的内容，但是不需要取得字符串的所有权或者修改字符串。它可以从char指针构造，但是其他的字符串类型应该自己提供到string_view的隐式转换。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0032r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0032R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0504r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0504R0<i class=\"icon-external\"></i></a><br>\n概要：新类型：any<br>\n注释：类型any对可复制（copyable）的对象进行类型擦除（type-erase）。基本上可以用any做以下三件事：1. 把T类型的值放入其中。2. 复制它。 3. 检查它是否包含一个U类型的值，并且取出这个值，取出操作只有在U就是T的时候才会成功。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0088r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0088R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0393r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0393R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0032r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0032R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0504r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0504R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0510r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0510R0<i class=\"icon-external\"></i></a><br>\n概要：新的类模板：variant<br>\n注释：variant是一个可辨识联合（disjoint union / discriminated union）。variant&lt;A, B, C&gt; 类型的值在任何时间都包含一个类型为A、B或C之一的值。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0307r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0307R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0032r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0032R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0504r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0504R0<i class=\"icon-external\"></i></a><br>\n概要：新的类模板：optional<br>\n注释：一个可选的值。一个optional&lt;T&gt;表示一个T值，或者表示没有值（由类型nullopt_t标记）。在某些方面，可以认为它等同于variant&lt;nullopt_t, T&gt;，但是它具有专门的接口。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a><br>\n概要：新算法：sample<br>\n注释：从一个范围（range）里均匀选取最多n个元素作为样本。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4169\" target=\"_blank\" rel=\"nofollow noreferrer\">N4169<i class=\"icon-external\"></i></a><br>\n概要：invoke<br>\n注释：以统一形式调用Callable实体（包括函数、函数对象和成员指针）的工具。这允许用户编写的库可以使用与标准的魔法（magic）<i>INVOKE</i>规则相同的行为。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0077r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0077R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0604r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0604R0<i class=\"icon-external\"></i></a><br>\n概要：is_invocable, is_invocable_r, invoke_result<br>\n注释：用于推断可调用性和调用结果的trait。（←_←看名字就知道应该和std::invoke配合使用。C++11的result_of也应该和invoke配合使用来着，如果只支持函数和函数对象应该直接用decltype，可惜名字取得不好，造成不少误用）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0067r5\" target=\"_blank\" rel=\"nofollow noreferrer\">P0067R5<i class=\"icon-external\"></i></a><br>\n概要：基本字符串转换<br>\n注释：函数to_chars和from_chars分别生成和解析数字的字符串表示。这些旨在形成用于替换printf和iostream格式化操作的高效、低级（low-level）的基础。它们遵循惯用的C++算法风格。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n3911\" target=\"_blank\" rel=\"nofollow noreferrer\">N3911<i class=\"icon-external\"></i></a><br>\n概要：类型别名模板void_t<br>\n注释：template &lt;class…&gt; using void_t = void; 在元编程中惊人地有用，简化了SFINAE的使用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4389\" target=\"_blank\" rel=\"nofollow noreferrer\">N4389<i class=\"icon-external\"></i></a><br>\n概要：类型别名模板bool_constant<br>\n注释：template &lt;bool B&gt; using bool_constant = integral_constant&lt;bool, B&gt;</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0013r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0013R1<i class=\"icon-external\"></i></a><br>\n概要：逻辑操作元函数<br>\n注释：用于元编程的变长元函数conjunction、disjunction和negation。这些trait在元编程的意义上是短路（short-circuit）的：不影响结果的模板不会被实例化。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0185r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0185R1<i class=\"icon-external\"></i></a><br>\n概要：用于SFINAE友好（SFINAE-friendly）swap的traits<br>\n注释：新的trait is_swappable、is_nothrow_swappable、is_swappable_with、is_nothrow_swappable_with。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/lwg2911\" target=\"_blank\" rel=\"nofollow noreferrer\">LWG 2911<i class=\"icon-external\"></i></a><br>\n概要：Trait is_aggregate<br>\n注释：检查类型是否是聚合类（aggregate）。例如，可以用于判断泛型类型（←_←就是作为模板参数的类型）是应该用列表初始化（list-initialization）还是应该用非列表初始化（non-list-initialization）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0258r2%2520%253Cview-source%3Ahttp%3A//wg21.link/p0258r2%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0258R2<i class=\"icon-external\"></i></a><br>\n概要：Trait has_unique_object_representations<br>\n注释：这个trait可以用来判断特定的基于值的操作（例如比较和求hash值）是否可以用基于对象表示（object representation）的操作（例如memcmp）代替。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0007r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0007r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0007R1<i class=\"icon-external\"></i></a><br>\n概要：as_const<br>\n注释：给定lvalue x，std::as_const(x)返回相应的带const限定符的lvalue。std::as_const不能接受rvalue。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4280%2520%253Cview-source%3Ahttp%3A//wg21.link/n4280%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">N4280<i class=\"icon-external\"></i></a><br>\n概要：非成员函数size、data、empty<br>\n注释：新增的函数补充了现有的非成员函数begin、end等等。通过这些函数，可以用统一的方式访问标准容器和C风格数组。注意，和begin/end不同，这些新的函数不是定制点（customisation point），仅为方便起见提供。（←_←不知道原文作者为什么强调 the new functions are <i>not</i> customisation points，记得customization point是Ranges里的术语，而且在Ranges里这些非成员函数确实是customization point object）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0025r0%2520%253Cview-source%3Ahttp%3A//wg21.link/p0025r0%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0025R0<i class=\"icon-external\"></i></a><br>\n概要：clamp<br>\n注释：clamp(x, low, high)在x处于区间[low, high]内时返回x，否则返回最接近的边界（小于low就返回low，大于high就返回high）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0295r0%2520%253Cview-source%3Ahttp%3A//wg21.link/p0295r0%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0295R0<i class=\"icon-external\"></i></a><br>\n概要：gcd和lcm<br>\n注释：数论中的函数，计算两个整数的最大公约数和最小公倍数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4508%2520%253Cview-source%3Ahttp%3A//wg21.link/n4508%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">N4508<i class=\"icon-external\"></i></a><br>\n概要：shared_mutex类<br>\n注释：读-写互斥体，能够以共享或独占模式锁定。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0154r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0154r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0154R1<i class=\"icon-external\"></i></a><br>\n概要：干扰尺寸（interference sizes）<br>\n注释：两个新的实现定义常量hardware_constructive_interference_size、hardware_destructive_interference_size允许平台记录其高速缓存行大小（cache line size），以便用户避免虚假共享（破坏性干扰）并提高局部性（建设性干扰）。定义了两个单独的常量，以支持异构体系结构（heterogeneous architecture）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a><br>\n概要：元组（tuple）apply<br>\n注释：调用一个callable，参数从给定的元组中提取。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0209r2%2520%253Cview-source%3Ahttp%3A//wg21.link/p0209r2%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0209R2<i class=\"icon-external\"></i></a><br>\n概要：从元组构造<br>\n注释：新的函数模板make_from_tuple，功能是用给定元组的成员初始化T类型的值。它有点像刚提到的apply，但是它用于构造函数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0005r4%2520%253Cview-source%3Ahttp%3A//wg21.link/p0005r4%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0005R4<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0358r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0358r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0358R1<i class=\"icon-external\"></i></a><br>\n概要：通用否定函数对象not_fn<br>\n注释：一个调用包装器（call wrapper），对它包装的callable取否定。它适用于具有任意数量参数的callable。它取代了旧的not1和not2包装器。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a><br>\n概要：memory resource<br>\n注释：一套新的组件，包括用于动态选择内存提供者的<i>memory resource</i>基类，以及三个具体实现（synchronized_pool_resource、unsynchronized_pool_resource、monotonic_buffer_resource）。有关用例参见下一条。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0337r0%2520%253Cview-source%3Ahttp%3A//wg21.link/p0337r0%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0337R0<i class=\"icon-external\"></i></a><br>\n概要：多态的内存分配器<br>\n注释：使用memory resource的内存分配器，memory resource可以在运行时改变，不是分配器类型的一部分。为方便使用，还提供了类型别名，如std::pmr::vector&lt;T&gt; = std::vector&lt;T, polymorphic_allocator&lt;T&gt;&gt;。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0220r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0253r1%2520%253Cview-source%3Ahttp%3A//wg21.link/p0253r1%253E\" target=\"_blank\" rel=\"nofollow noreferrer\">P0253R1<i class=\"icon-external\"></i></a><br>\n概要：搜索器函数对象<br>\n注释：使用Boyer-Moore和Boyer-Moore-Horspool算法、用于搜索子字符串的函数对象，和一个使用这些函数对象的algorithm。</p>\n<h2>对现有特性的修改</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n3928\" target=\"_blank\" rel=\"nofollow noreferrer\">N3928<i class=\"icon-external\"></i></a><br>\n概要：只接受一个参数的static_assert<br>\n注释：static_assert声明不再需要第二个参数：static_assert(N &gt; 0);</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4230\" target=\"_blank\" rel=\"nofollow noreferrer\">N4230<i class=\"icon-external\"></i></a><br>\n概要：嵌套命名空间声明<br>\n注释：namespace <b>foo::bar</b> { /* … */ }</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4051\" target=\"_blank\" rel=\"nofollow noreferrer\">N4051<i class=\"icon-external\"></i></a><br>\n概要：允许用typename声明模板的模板参数（template template parameters）<br>\n注释：template &lt;template &lt;typename&gt; <b>typename</b> Tmpl&gt; struct X; 以前，模板的模板参数的声明只能用关键字class。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0184r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0184R0<i class=\"icon-external\"></i></a><br>\n概要：基于范围的for循环（range-based for）接受不同的begin/end类型<br>\n注释：for (<i>decl</i> : <i>expr</i>) 的规则受到重写，从以前的auto __begin = <i>begin-expr</i>, __end = <i>end-expr</i>;改成现在使用的 auto __begin = <i>begin-expr</i>; auto __end = <i>end-expr</i>;。这使得基于范围的for循环为新的Ranges（工作正在进行中）做好准备。</p>\n<p>文件： <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0195r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0195R2<i class=\"icon-external\"></i></a><br>\n概要：<i>using-declaration</i> 中的包扩展（pack expansion）<br>\n注释：template &lt;typename …Args&gt; struct X : Args… { <b>using Args::f…;</b> };</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0138r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0138R2<i class=\"icon-external\"></i></a><br>\n概要：固定枚举（fixed enum）值的构造<br>\n注释：类型为固定枚举 E 的变量可以用 E e { 5 }; 的形式定义，不再需要更啰嗦的 E e { E(5) };。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n3922\" target=\"_blank\" rel=\"nofollow noreferrer\">N3922<i class=\"icon-external\"></i></a><br>\n概要：从花括号列表中推导auto的新规则<br>\n注释：以前，auto a{1, 2, 3}, b{1}; 是允许的，两个变量的类型都是 initializer_list&lt;int&gt;。现在 auto a{1, 2, 3}; 是错误的（ill-formed）， auto b{1}; 声明一个 int。注意，auto a = {1, 2, 3}, b = {1}; 保持不变，推导出 initializer_list&lt;int&gt; 。此改变预期作为缺陷解决方案（defect resolution）（在C++11和C++14模式下也会使用新规则）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4259\" target=\"_blank\" rel=\"nofollow noreferrer\">N4259<i class=\"icon-external\"></i></a><br>\n概要：uncaught_exceptions()<br>\n注释：函数uncaught_exception被弃用，新函数uncaught_exceptions返回计数而不是布尔值。以前的功能实际上是不能用的，<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4152\" target=\"_blank\" rel=\"nofollow noreferrer\">N4152<i class=\"icon-external\"></i></a>解释了细节。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4266\" target=\"_blank\" rel=\"nofollow noreferrer\">N4266<i class=\"icon-external\"></i></a><br>\n概要：命名空间（namespace）和枚举成员（enumerators）的属性（attributes）<br>\n注释：命名空间和枚举成员现在可以用属性标记。例如，这允许标记命名空间和枚举成员为弃用的（deprecated）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0028r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0028R4<i class=\"icon-external\"></i></a><br>\n概要：属性命名空间（attribute namespace）不需要重复指定<br>\n注释：当重复使用某一个属性命名空间时，这简化了命名空间限定。</p>\n<p>———-</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4279\" target=\"_blank\" rel=\"nofollow noreferrer\">N4279<i class=\"icon-external\"></i></a><br>\n概要：改进了std::map和std::unordered_map的插入<br>\n注释：m.try_emplace(key, arg1, arg2, arg3) 在m中已经含有key的时候没有任何效果，否则插入一个从参数构造的新元素。这个接口（interface）保证即使实参绑定到右值引用（rvalue reference），如果没有发生插入，实参将不会被移动（not moved from）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0084r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0084R2<i class=\"icon-external\"></i></a><br>\n概要：emplace的返回类型<br>\n注释：顺序容器（sequence container）的过去返回void的emplace、emplace_front、emplace_back成员函数模板，现在返回刚刚插入的元素的引用。（关联容器不受影响，因为它们的插入函数一直都返回相关元素的迭代器。）</p>\n<p>文件： <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0083r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0083R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0508r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0508R0<i class=\"icon-external\"></i></a><br>\n概要：set和map的拼接（splice）<br>\n注释：一个叫做<i>节点句柄</i>（<i>node handle</i>）的新机制加入了标准容器库。这个新机制允许在不同的map/set对象之间移植元素，而不会触及容器中的对象。此外，这个机制使得对提取（extract）出的键值进行可变访问成为可能。（←_←可以不使用mutable就修改set的元素和map的key了，当然在修改之前必须先提取出来，修改之后再插入回去，以保证set和map的内部结构不受破坏）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0272r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0272R1<i class=\"icon-external\"></i></a><br>\n概要：非const的string::data<br>\n注释：现在有了一个非const的basic_string::data重载，返回一个可变的（mutable）指针。此外，C++17允许向空终止符（null terminator）写入，只要写入的值是零。这使得字符串类更便于和C风格接口一起使用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0156r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0156R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0156r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0156R2<i class=\"icon-external\"></i></a><br>\n概要：变长（variadic）版的lock_guard，名叫scoped_lock<br>\n注释：增加了变长的类模板scoped_lock&lt;Args…&gt;。它可以同时给多个可锁的对象（lockable object）加锁（使用和std::lock相同的算法），并且在析构函数中释放锁。一开始建议直接修改lock_guard，使它成为变长模板，但是发现这会造成ABI不兼容，所以现在我们有了新的类模板scoped_lock，它严格优于旧的lock_guard，所以不要使用lock_guard了。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0006r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0006R0<i class=\"icon-external\"></i></a><br>\n概要：变量模板trait<br>\n注释：对于每一个只包含一个静态成员常量的trait foo ，有了一个对应的变量模板foo_v&lt;Args…&gt;。foo_v&lt;Args…&gt;等价于foo&lt;Args…&gt;::value。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0152r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0152R1<i class=\"icon-external\"></i></a><br>\n概要：atomic::is_always_lock_free<br>\n注释：一个新的静态成员常量is_always_lock_free记录了给定原子类型（atomic type）的操作是否总是无锁（lock-free）的。现有的非静态成员函数可能对同一原子类型的不同值给出不同的答案。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0220r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0220R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0414r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0414R2<i class=\"icon-external\"></i></a><br>\n概要：数组的shared_ptr<br>\n注释：类模板shared_ptr现在可以支持C风格数组，只需传入T[]或T[N]作为模板参数。接受原始指针（raw pointer）的构造函数将会设置（install）合适的数组内存释放器（array deleter）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0163r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0163R0<i class=\"icon-external\"></i></a><br>\n概要：shared_ptr::weak_type<br>\n注释：shared_ptr&lt;T&gt;现在有了一个成员类型weak_type，它是weak_ptr&lt;T&gt;的别名。这使得泛型代码不需要解构shard_ptr的类型就可以知道对应的weak_ptr类型。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0030r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0030R1<i class=\"icon-external\"></i></a><br>\n概要：三维的斜边长（hypotenuse）<br>\n注释：三维斜边长hypot(x, y, z) （可以用来计算三维空间中两个点的距离）作为额外的重载加入 &lt;cmath&gt; （但没有加入&lt;math.h&gt;，并且只定义在命名空间std中）。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0040r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0040R3<i class=\"icon-external\"></i></a><br>\n概要：更多用于未初始化内存的算法<br>\n注释：增加在未初始化的内存中构造对象和销毁对象的算法。包括分别进行默认初始化（default-initialization）和值初始化（value-initialization）的版本。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4510\" target=\"_blank\" rel=\"nofollow noreferrer\">N4510<i class=\"icon-external\"></i></a><br>\n概要：内存分配器对不完整类型（incomplete type）的支持<br>\n注释：这项改变放宽了内存分配器对它的值类型（value type）的要求，使得值类型可以是不完整类型。例如，这允许递归的结构，如：struct X { std::vector&lt;X&gt; data; };</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0092r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0092R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0505r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0505R0<i class=\"icon-external\"></i></a><br>\n概要：对&lt;chrono&gt;的改变<br>\n注释：为时间点（time point）增加了向上取整（floor）、向下取整（ceiling）、除法（division）和四舍六入五成双取整（rounding）。（←_←我们中出了一个除法。根据P0092R1来看，原文似有问题，增加的应该是绝对值abs而不是除法。）大多数成员函数成为constexpr函数。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0426r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0426R1<i class=\"icon-external\"></i></a><br>\n概要：char_traits的constexpr支持<br>\n注释：对于标准要求的所有的char_traits特化（也就是std::char_traits&lt;char&gt;、std::char_traits&lt;wchar_t&gt;、std::char_traits&lt;char16_t&gt;、std::char_traits&lt;char32_t&gt;这四个类），成员函数length、compare、find和assign现在都是constexpr成员函数了。这使得string view可以在常量表达式中更广泛地使用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4387\" target=\"_blank\" rel=\"nofollow noreferrer\">N4387<i class=\"icon-external\"></i></a><br>\n概要：改善pair和tuple<br>\n注释：这个变化使得pair和tuple的构造函数变为“带条件的explicit”构造函数。只有在有某个元素的对应构造函数是explicit的时候，pair和tuple的构造函数才是explicit的。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0435r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0435R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0548r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0548R1<i class=\"icon-external\"></i></a><br>\n概要：对common_type的改变<br>\n注释：因为如果不改一下common_type，就不能称为新标准了……</p>\n<h2>杂项</h2>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0063r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0063R3<i class=\"icon-external\"></i></a><br>\n概要：C++引用C11<br>\n注释：C++标准现在正式地（normatively）引用C11 (ISO/IEC 9899:2011) 为“C标准”（“The C Standard”）了。这不仅是应对ISO的要求（ISO要求对其他国际标准的引用必须引用最新发布的版本，而不是某个历史版本），也使得我们可以使用aligned_alloc，它对于改进动态内存管理（dynamic memory management）非常有用。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0180r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0180R2<i class=\"icon-external\"></i></a><br>\n概要：保留的（reserved）命名空间<br>\n注释：所有形如 std<i>N</i> （其中 <i>N</i> 是一串数字）的命名空间现在被保留了。（用户不能使用了。）</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0175r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0175R1<i class=\"icon-external\"></i></a><br>\n概要：C库总览（synopsis）<br>\n注释：一个纯粹非技术性（editorial）的变化：标准库的“C库”部分的所有头文件的内容现在在C++标准文档中以完整的总览（synopsis）的形式展现（也就是完整列出每个标准头文件包含的完整声明），而不再是像以前一样只列出名字。这使得与C语言中的语义不同的地方（例如增加的重载，针对language linkage的重载）更容易理解。</p>\n<p>文件：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4262\" target=\"_blank\" rel=\"nofollow noreferrer\">N4262 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0134r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0134R0 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0391r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0391R0 <i class=\"icon-external\"></i></a><a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4284\" target=\"_blank\" rel=\"nofollow noreferrer\">N4284<i class=\"icon-external\"></i></a><br>\n概要：术语“forwarding reference”、“default member initializer”、“templated entity”、“contiguous iterator”（分别对应四个文件）<br>\n注释：这些变化没有正式的（normative）影响，但是它们为迄今为止只从语言规则中<i>出现</i>的概念建立了官方术语。精确和众所周知的术语简化了关于C++的讨论，也简化了规范。</p>\n<h2>未列入的文件</h2>\n<p>以下文件在委员会会议（committee meeting）上被接受，但是它们的内容过于专门，不能称为单独的特性：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4258\" target=\"_blank\" rel=\"nofollow noreferrer\">N4258<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4268\" target=\"_blank\" rel=\"nofollow noreferrer\">N4268<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4277\" target=\"_blank\" rel=\"nofollow noreferrer\">N4277<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4285\" target=\"_blank\" rel=\"nofollow noreferrer\">N4285<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0017r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0017R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0031r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0031R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0074r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0074R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0270r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0270R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0283r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0283R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0296r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0296R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0503r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0503R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0509r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0509R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0516r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0516R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0517r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0517R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0558r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0558R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0599r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0599R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0612r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0612R0<i class=\"icon-external\"></i></a>。</p>\n<p>以下文件包含被接受为缺陷报告（defect report）的问题（issue）。处理CWG问题的文件有 <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4192\" target=\"_blank\" rel=\"nofollow noreferrer\">N4192<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4457\" target=\"_blank\" rel=\"nofollow noreferrer\">N4457<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0164r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0164R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0167r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0167R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0263r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0263R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0384r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0384R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0398r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0398R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0490r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0490R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0507r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0507R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0519r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0519R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0520r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0520R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0522r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0522R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0575r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0575R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0576r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0576R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0613r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0613R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0622r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0622R0<i class=\"icon-external\"></i></a>。处理LWG问题的文件有 <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4245\" target=\"_blank\" rel=\"nofollow noreferrer\">N4245<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4366\" target=\"_blank\" rel=\"nofollow noreferrer\">N4366<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4383\" target=\"_blank\" rel=\"nofollow noreferrer\">N4383<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4525\" target=\"_blank\" rel=\"nofollow noreferrer\">N4525<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0165r4\" target=\"_blank\" rel=\"nofollow noreferrer\">P0165R4<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0304r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0304R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0397r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0397R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0610r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0610R0<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0625r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0625R0<i class=\"icon-external\"></i></a>。每份文件中只有部分问题被选出，具体细节见会议记录（meeting minutes）。以下单独的文件解决特定的问题：<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4089\" target=\"_blank\" rel=\"nofollow noreferrer\">N4089<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/n4261\" target=\"_blank\" rel=\"nofollow noreferrer\">N4261<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0033r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0033R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0136r1\" target=\"_blank\" rel=\"nofollow noreferrer\">P0136R1<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0250r3\" target=\"_blank\" rel=\"nofollow noreferrer\">P0250R3<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0418r2\" target=\"_blank\" rel=\"nofollow noreferrer\">P0418R2<i class=\"icon-external\"></i></a>, <a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//wg21.link/p0513r0\" target=\"_blank\" rel=\"nofollow noreferrer\">P0513R0<i class=\"icon-external\"></i></a>。历年来解决的问题（accepted issue）的完整列表公布在<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html\" target=\"_blank\" rel=\"nofollow noreferrer\">CWG issues list<i class=\"icon-external\"></i></a>和<a class=\" wrap external\" href=\"http://link.zhihu.com/?target=http%3A//www.open-std.org/jtc1/sc22/wg21/docs/lwg-defects.html\" target=\"_blank\" rel=\"nofollow noreferrer\">LWG issues list<i class=\"icon-external\"></i></a>，二者会经常更新。</p>\n<h2>展示C++17的代码片段合集</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965c75da9a18945407208\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstd::unordered_map&lt;std::string, std::unique_ptr&lt;Foo&gt;&gt; items;\r\nstd::vector&lt;std::unique_ptr&lt;Foo&gt;&gt; standby;\r\n\r\n// 如果没有'id'元素，则把'foo'作为'id'元素插入。\r\n// 否则把'foo'保存起来以备之后使用，将其放入standby中。\r\n\r\n// C++17以前\r\n\r\nvoid f(std::string id, std::unique_ptr&lt;Foo&gt; foo) {\r\n  auto it = items.find(id);\r\n  if (it == items.end()) {\r\n    auto p = items.emplace(std::move(id), std::move(foo));\r\n    p.first-&gt;second-&gt;launch();\r\n  } else {\r\n    standby.push_back(std::move(foo));\r\n    standby.back()-&gt;wait_for_notification();\r\n  }\r\n\r\n  // 注意：\r\n  // * 变量'id'不能再次使用（moved-from）；或者……\r\n  // * ……需要使用'const string&amp; id'作为参数，并强制复制。\r\n  // * 做了两次map查找。有序的map可以使用lower_bound + hint，但无序的map（unordered map）用不了。\r\n  // * （不能无条件调用emplace，因为它可能导致*foo被析构。）\r\n}\r\n\r\n// 使用C++17\r\n\r\nvoid f(std::string_view id, std::unique_ptr&lt;Foo&gt; foo) {\r\n  if (auto [pos, inserted] = items.try_emplace(id, std::move(foo)); inserted) {\r\n    pos-&gt;second-&gt;launch();\r\n  } else {\r\n    standby.emplace_back(std::move(foo))-&gt;wait_for_notification();\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a18945407208-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a18945407208-34\">34</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-1\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unordered_map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-2\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-4\"><span class=\"crayon-c\">// 如果没有'id'元素，则把'foo'作为'id'元素插入。</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-5\"><span class=\"crayon-c\">// 否则把'foo'保存起来以备之后使用，将其放入standby中。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-6\"> </div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-7\"><span class=\"crayon-c\">// C++17以前</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-8\"> </div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-9\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">auto </span><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">auto</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">emplace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">first</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">second</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">launch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push_back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">wait_for_notification</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-18\"> </div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// 注意：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * 变量'id'不能再次使用（moved-from）；或者……</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * ……需要使用'const string&amp; id'作为参数，并强制复制。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * 做了两次map查找。有序的map可以使用lower_bound + hint，但无序的map（unordered map）用不了。</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// * （不能无条件调用emplace，因为它可能导致*foo被析构。）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-24\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-26\"><span class=\"crayon-c\">// 使用C++17</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-28\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">string_view </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">unique_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Foo</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-29\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">auto</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inserted</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">try_emplace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inserted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pos</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">second</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">launch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-31\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">standby</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">emplace_back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">move</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">wait_for_notification</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a18945407208-33\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a18945407208-34\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p>下面的代码片段展示了template &lt;auto&gt;的用法，例子中的类模板将一个非成员函数转发给绑定了类实例的成员函数，并且成员函数是这个类模板的<i>类型</i>的一部分。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965c75da9a27677305281\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// C++17以前\r\n\r\ntemplate &lt;typename T, int (T::* MF)(int, int)&gt; // 两个参数：一个类型参数，一个非类型参数\r\nstruct Delegate { /* ... */ };\r\n\r\nint n = Delegate&lt;MyComplexClass, &amp;MyComplexClass::an_imporant_function&gt;(&amp;obj)(10, 20);\r\n\r\n// 使用C++17\r\n\r\ntemplate &lt;auto&gt; struct Delegate;                  // 一个（非类型）参数\r\ntemplate &lt;typename T, int (T::* MF)(int, int)&gt;\r\nstruct Delegate&lt;MF&gt;  { /* ... */ };              // 实现方法和以前相同，但现在使用偏特化（partial specialization）\r\n\r\nint n = Delegate&lt;&amp;MyComplexClass::an_imporant_function&gt;(&amp;obj)(10, 20);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a27677305281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a27677305281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a27677305281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a27677305281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a27677305281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a27677305281-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a27677305281-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a27677305281-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a27677305281-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a27677305281-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a27677305281-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a27677305281-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a27677305281-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a27677305281-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965c75da9a27677305281-1\"><span class=\"crayon-c\">// C++17以前</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a27677305281-2\"> </div><div class=\"crayon-line\" id=\"crayon-5965c75da9a27677305281-3\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MF</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 两个参数：一个类型参数，一个非类型参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a27677305281-4\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Delegate</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* ... */</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a27677305281-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a27677305281-6\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delegate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">MyComplexClass</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">MyComplexClass</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">an_imporant_function</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a27677305281-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a27677305281-8\"><span class=\"crayon-c\">// 使用C++17</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a27677305281-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a27677305281-10\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">auto</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delegate</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                  </span><span class=\"crayon-c\">// 一个（非类型）参数</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a27677305281-11\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MF</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a27677305281-12\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Delegate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">MF</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* ... */</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">              </span><span class=\"crayon-c\">// 实现方法和以前相同，但现在使用偏特化（partial specialization）</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a27677305281-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a27677305281-14\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Delegate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">MyComplexClass</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">an_imporant_function</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>下面的代码片段展示fold表达式在泛型代码中的用法。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965c75da9a2c877068504\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 对于参数包f中的所有元素，调用f(n)。\r\ntemplate &lt;typename ...F&gt;\r\nvoid ApplyAll(int n, const F&amp;... f) {\r\n   (f(n), ...); // 一元fold (over the comma operator)\r\n}\r\n\r\n// 对于参数包f中的所有元素，计算f(a, b)，返回和。\r\ntemplate &lt;typename ...F&gt;\r\nint ApplyAndSum(int a, int b, const F&amp;... f) {\r\n   return (f(a, b) + ... + 0); // 二元fold\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a2c877068504-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a2c877068504-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a2c877068504-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a2c877068504-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a2c877068504-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a2c877068504-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a2c877068504-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a2c877068504-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a2c877068504-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a2c877068504-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a2c877068504-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965c75da9a2c877068504-1\"><span class=\"crayon-c\">// 对于参数包f中的所有元素，调用f(n)。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a2c877068504-2\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a2c877068504-3\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplyAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a2c877068504-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 一元fold (over the comma operator)</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a2c877068504-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a2c877068504-6\"> </div><div class=\"crayon-line\" id=\"crayon-5965c75da9a2c877068504-7\"><span class=\"crayon-c\">// 对于参数包f中的所有元素，计算f(a, b)，返回和。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a2c877068504-8\"><span class=\"crayon-v\">template</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">typename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a2c877068504-9\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplyAndSum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a2c877068504-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 二元fold</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a2c877068504-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>下面的代码片段展示shared_ptr对数组的支持。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965c75da9a2f678908018\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// C++17以前\r\nstd::shared_ptr&lt;char&gt; p(new char[N], std::default_delete&lt;char[]&gt;()); // 如果不提供删除器（deleter）就错了\r\n\r\n// 使用C++17\r\nstd::shared_ptr&lt;char[]&gt; p(new char[N]); // 删除器自动使用“delete[]”</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a2f678908018-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a2f678908018-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a2f678908018-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965c75da9a2f678908018-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965c75da9a2f678908018-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965c75da9a2f678908018-1\"><span class=\"crayon-c\">// C++17以前</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a2f678908018-2\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">shared_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">char</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">p</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">default_delete</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 如果不提供删除器（deleter）就错了</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a2f678908018-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965c75da9a2f678908018-4\"><span class=\"crayon-c\">// 使用C++17</span></div><div class=\"crayon-line\" id=\"crayon-5965c75da9a2f678908018-5\"><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">shared_ptr</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">p</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 删除器自动使用“delete[]”</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111801\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111801votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111801\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "b727b9066b0e290ea3a28731fb346c13", "praise_num": 3, "tags": "IT技术", "fav_nums": 8, "title": "走近比特币：一个故事看懂“区块链”", "comments_num": 0, "create_date": "2017/07/10", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/9b36ef38a61d648c3160895636320231.png"], "front_image_path": "full/63f2aa24b2b070edaefbb38b67ace3ebd11241ce.jpg", "url": "http://blog.jobbole.com/111768/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"\">赛博朔方</a>   </div><p>区块链是比特币的底层技术和基础架构，本质上是一个去中心化的数据库。区块链是一串使用密码学方法相关联产生的数据块，每一个数据块中包含了一次比特币网络交易的信息，用于验证其信息的有效性（防伪）并生成下一个区块。</p>\n<p>狭义来讲，区块链是一种按照时间顺序将数据区块以顺序相连的方式组合成的一 种链式数据结构， 并以密码学方式保证的不可篡改和不可伪造的分布式账本。</p>\n<p>以上定义摘自百度百科。很多菜鸟朋友看完这段解释依然满脸懵逼，到底什么是“区块链”？</p>\n<p><strong>起因</strong></p>\n<p>除非你完全没有接触过信息安全，否则一定听说过比特币和区块链。毕竟这两个名词也是近两年来各大国内外媒体争相报道的热词。尤其是继今年5月爆发的WannaCry病毒爆发以后，很多从未接触过的人都开始加入讨论大军。</p>\n<p>我的很多朋友都不懂技术。最近几周他们一个个都变身好奇宝宝，围着我问比特币和区块链。我想这两个名词的热度一定还会持续攀高，对他们不够了解的人也还有很多很多。何不采用通俗的语言对“区块链”做一个解释，把这个概念传播开来？</p>\n<p>和网上一般的名词解释不同（不管三七二十一，下个定义再说，其实并没有什么卵用），我们以它的作用为切入点来理解区块链的工作机制。</p>\n<p><strong>故事的开端</strong></p>\n<p>Joe是你最好的朋友。他出国旅游后的第五天给你打了个电话：“兄弟，我需要点钱，出国之后把身上的钱都花完了。”</p>\n<p>你回复：“我马上打过来”，然后挂了电话。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9b36ef38a61d648c3160895636320231.png\"><img class=\"aligncenter wp-image-111770 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9b36ef38a61d648c3160895636320231.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>接着你又打电话给你的银行客户经理：“麻烦你马上从我的账户转1000美元给Joe。”</p>\n<p>客户经理：“好的，明白。”</p>\n<p>客户经理随后确认了你的账户是否有足够的余额。因为你是百万富翁，所以客户经理进行了如下的操作：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/01ba164bb2faac9366790f480929ba0d.png\"><img class=\"aligncenter wp-image-111771 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/01ba164bb2faac9366790f480929ba0d.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>交易账单</p>\n<p>你打电话给Joe说你已经把1000美元转过去了。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/63a42b41972d79baeb70657d8fa43e4d.png\"><img class=\"aligncenter wp-image-111772 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/63a42b41972d79baeb70657d8fa43e4d.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>回头我们再来看看刚刚到底发生了什么。你和Joe都信任那家银行来管理你们各自的财产。整个过程中实际并没有真实货币的物理流动。整个过程只涉及录入系统的两个账户即可。更准确地说，全程只需主动权属于该银行的两个账户就可以完成。</p>\n<p>在这样传统的货币体系中，我的问题就来了。</p>\n<p>交易双方的信任机制建立需要借助第三方。这种“中间人”的方式由来已久。那么你可能又要问了：“这种信任机制有什么问题吗？”问题在于除交易双方以外的“监督者”只是单个个体。这种情况可能存在以下风险：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59661a8609c8a981072414\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n如果有人有意或无意地摧毁了某个人或某个第三方组织机构就可能足以引起社会混乱。\r\n如果记录了某个交易的注册表遭遇火灾怎么办？\r\n万一你的客户经理不小心划了1500美元到你朋友的账户怎么办？\r\n如果他是故意这么做的呢？</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661a8609c8a981072414-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661a8609c8a981072414-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661a8609c8a981072414-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661a8609c8a981072414-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661a8609c8a981072414-1\">如果有人有意或无意地摧毁了某个人或某个第三方组织机构就可能足以引起社会混乱。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661a8609c8a981072414-2\">如果记录了某个交易的注册表遭遇火灾怎么办？</div><div class=\"crayon-line\" id=\"crayon-59661a8609c8a981072414-3\">万一你的客户经理不小心划了<span class=\"crayon-cn\">1500</span>美元到你朋友的账户怎么办？</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661a8609c8a981072414-4\">如果他是故意这么做的呢？</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>世界上有没有无需借助银行就能帮助我们完成安全转账的系统？</p>\n<p>要想解决这个问题，我们首先应该静下心来好好思考，问自己一个更深层次的问题：我们能不能自己掌握账户和历史交易的信息呢？</p>\n<p>这的确是一个值得探讨的问题。答案当然你一定也已经猜到了——那就是“区块链”。现在我们就开始学习这个分布式账本是如何运作的。</p>\n<p><strong>故事的发展</strong></p>\n<p>该方法得以实行的必要条件是必须有足够多的人愿意在交易时不依赖于第三方。只有这样，这一部分的人才能够自己掌控账本资料。</p>\n<p>那么人数要达到多少才足够呢？在下面的例子中，我们假设有10个人愿意放弃银行或其它任何第三方机构。在双方达成协议的前提下，他们互相之间能够在不知道对方身份的情况下时刻掌握对方账户的一切信息和动态。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9c3b01673d22d6a83ed4ab9a6ec0f20b.png\"><img class=\"aligncenter wp-image-111773 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9c3b01673d22d6a83ed4ab9a6ec0f20b.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>1. 一个空文件夹</p>\n<p>一开始每个人都会获得一个空文件夹。随着时间推进，这十个人都会在他们现在空的文件夹里不断添加记录交易信息的纸张。</p>\n<p>2. 交易发生时</p>\n<p>接下来，这个交易网络中的每个人都带着纸和笔坐下来，准备记录下在这个系统中发生的每一笔交易。</p>\n<p>假设，2号想给9号10美元。</p>\n<p>为了完成这笔交易，2号大声地告诉每个人：“我要转10美元给9号。请大家都在自己的纸上记下来。”</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/81b4ecaa4773d202ad3bfbecd6a37b70.png\"><img class=\"aligncenter wp-image-111774 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/81b4ecaa4773d202ad3bfbecd6a37b70.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>然后每个人都检查确认2号是不是有10美元及以上的余额能够转给9。如2号余额足够，那么大家都在空白纸上记录下这笔交易。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/1183d1ddac95cb55be40dd6f13215cf4.png\"><img class=\"aligncenter wp-image-111775 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1183d1ddac95cb55be40dd6f13215cf4.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>纸上的第一笔交易</p>\n<p>这笔交易这样就算完成了。</p>\n<p>3. 持续发生的交易</p>\n<p>随着时间的流逝，这个交易网络中出现交易需求的人越来越多。无论何时他们产生交易需求，都会通知网络中的每个人。只要有人听到了这个通知，他/她就会在他们各自的纸上记录下来。</p>\n<p>这个过程会持续进行，直到这张纸上的空间不足。假设每张纸只能记录10次交易，那么只要第10次交易完成，每个人纸上的空间也就随之耗尽。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/5bd3935a377f1251c6165091f6270aa6.png\"><img class=\"aligncenter wp-image-111776 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5bd3935a377f1251c6165091f6270aa6.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>当白纸被填满</p>\n<p>这时候我们就需要把这张纸放进文件夹并拿出另一张新的白纸，重复上面步骤2的过程。</p>\n<p>4. 把纸张放进文件夹的注意点</p>\n<p>在把纸张放进文件夹之前，我们需要对这张纸用网络中每个人都认可的专有密钥进行密封。但是密封后我们要确保的是，这张纸就只能尘封在文件夹里，无论是谁无论何时都不能对其作任何修改。并且如果每个人都相信这个“封印”，那么也就意味着每个人都绝对信任这张纸上的内容。这种密封方式也是区块链的关键所在。</p>\n<p>以前第三方或中间人都会说服我们相信无论他们在注册表中记录了什么，里面的内容都不会发生改变。但在现在这个分布式的、去中心化的系统中，这个印章（密钥）就为我们建立了这种信任机制。</p>\n<p><strong>故事的高潮 （一）</strong></p>\n<p>新的问题又来了。我们应该如何密封这张纸？</p>\n<p>在学习如何密封之前，我们先来了解印章的工作原理。</p>\n<p>假设我们现在有一个机器，如果你把一个里面装着东西的盒子从左边放进去，这个魔法机器会从右边吐出一个装着其它东西的盒子。</p>\n<p>【术语解析】这个机器实际叫作“哈希函数”，但是今天我们不讨论技术。所以我们暂且称它为“魔法机器”。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e3f892be4247730976be45fb1f1e270.png\"><img class=\"aligncenter wp-image-111777 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e3f892be4247730976be45fb1f1e270.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>魔法机器（即哈希函数）</p>\n<p>如果我们把装有数字4的盒子从左边放进去，它会从右边给出下列字符：dcbea。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/7f0d5928f1188ea21c9480dcff258578.png\"><img class=\"aligncenter wp-image-111778 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7f0d5928f1188ea21c9480dcff258578.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>如果已知条件是输出结果为“dcbea”，要想知道从左边输入的是什么非常困难。但是每次如果你把4放进去，最终的输出结果“dcbea”是肯定的。</p>\n<p>我们来试试发送其它数字。如果放入26会得到什么呢？</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/1e6ae033a33080a677a6191ea391e5f0.png\"><img class=\"aligncenter wp-image-111779 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1e6ae033a33080a677a6191ea391e5f0.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>哈希（26）=94c8e</p>\n<p>这次我们得到的是“94c8e”。从26的输出结果来看，结果也可以包含数字。</p>\n<p>了解到这儿，我们可以开始思考下一个更加深入的问题了：</p>\n<p>“如果我想从右边得到一个以3个零为开头的结果（如000ab、00098、000fa等），那么我应该从机器的左边放入什么内容？”</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b5094d27681e08d4fd51ff4fe96457f.png\"><img class=\"aligncenter wp-image-111780 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b5094d27681e08d4fd51ff4fe96457f.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>预测输入的内容</p>\n<p>这个机器有一个单向性的属性：给出右边的预期结果后，我们无法计算出左边放入的内容。那是不是意味着这个问题无解？倒也未必。</p>\n<p>我能想到一种方法——把每个数字都输入一遍，直到机器输出以3个零为开头的结果。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/f8de38b5d93b04da9c1cef1bf1857e6c.png\"><img class=\"aligncenter wp-image-111781 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f8de38b5d93b04da9c1cef1bf1857e6c.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>把每个数字都尝试一遍</p>\n<p>有耐心的人试上几千次可能也就找到了这个符合我们输出要求的数字。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/772ab83f8b259605193ef6eafda2b66e.png\"><img class=\"aligncenter wp-image-111782 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/772ab83f8b259605193ef6eafda2b66e.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>通过输出结果来获得输入数字这种逆向计算的确非常困难。但是如果我们得到了预测的输入内容，验证该输入是否能得出我们想要的结果就非常非常容易了。记住，这个机器最大的特点就是每个结果只对应一个数字，绝无例外的“一夫一妻制”。</p>\n<p>如果我给你72533这个数字，然后问你：“这个数字输入魔法机器后会不会输出以3个零为开头的结果？”这个问题就简单到简直在侮辱我们的智商了。</p>\n<p>因此这个机器最最最重要的属性是——知道结果，要想算出输出非常困难，但是如果我们知道输入的数字和输出结果，验证两者是否匹配很简单。</p>\n<p><strong>如何利用这个机器密封纸张？</strong></p>\n<p>怎样利用魔法机器生成每张纸独有的封印？还是老办法，采用情境模拟的方法展开解释。</p>\n<p>假设我给了你两个盒子。第一个盒子里面有数字20893，你能不能想出一个数字，这个数字与第一个盒子里的数字相加后的结果放入魔法机器后，我们能够得到一个以3个零为开头的字符结果。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/21d6fade61921245e50fb1a30147c031.png\"><img class=\"aligncenter wp-image-111783 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/21d6fade61921245e50fb1a30147c031.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>这个情景和之前的难题几乎相同。唯一的办法就是把每个数字都放入机器尝试一遍。</p>\n<p>经过几千次的尝试，我们会在21191这个数字这里停下，21191+20893=42084，把42084放入这个机器后所得到的结果正是我们想要的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/449e0679475edf81e6cbfc2a763db20d.png\"><img class=\"aligncenter wp-image-111784 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/449e0679475edf81e6cbfc2a763db20d.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>在这个案例中，21191这个数字就是20893这个数字的“封印”。假设有张纸上写着20893这个数字。为了密封这张纸（即没有人能够再对其内容作改动），我们把带有21191标签的徽章贴在纸上，密封完成。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/c01dc72fb256585c8432e1ca563ec34a.png\"><img class=\"aligncenter wp-image-111785 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c01dc72fb256585c8432e1ca563ec34a.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>被密封的数字</p>\n<p>【术语解析】用来密封的数字实际被称为“工作证明（Proof Of Work）”，因为这个数字是通过努力计算得来的。本文为了简单易懂，我们称它为“密封数字”。</p>\n<p>无论谁想验证这个页面是否被改动过，只要把页面上的内容与密封号码叠加后放入魔法机器。如果机器输出的内容是以3个零为开头的，那么该页面内容是没有被“污染”过的。但如果结果不满足这个特点，我们就应果断丢弃这个页面，因为上面的内容已经被改动、已经失效。</p>\n<p><strong>密封过程总结</strong></p>\n<p>要想密封记录整个交易网络中交易流水的页面，我们需要找到那个加入交易内容并输入机器后会得到以3个零为开头的字符的关键数字。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/acf9c1fe14e240e49751ed7852fcdaa1.png\"><img class=\"aligncenter wp-image-111786 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/acf9c1fe14e240e49751ed7852fcdaa1.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>注意：“以3个零为开头的字符”只是一个举例，简单地反应哈希函数的工作原理。实际问题处理起来会复杂得多。</p>\n<p>只要花费一定的时间，交易网络中的参与者就能够计算出这个数字，该页面也就随之密封。一旦有人更改了页面上的内容，任何人都能够通过这个密封号码来验证这个页面的完整性。</p>\n<p><strong>故事的高潮（二）</strong></p>\n<p>了解如何密封页面后，我们再把思绪拉回10个人用完了一张纸上所有空间的时候。</p>\n<p>当这个页面上记不下更多的交易记录时，交易网络中的每个人都会停下来计算该页面的密封数字，然后将其放入文件夹。如果第一个人算好了密封数字，他就会向所有人公布。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/a3985de89845392cf48ab2239b4615ea.png\"><img class=\"aligncenter wp-image-111787 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a3985de89845392cf48ab2239b4615ea.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>听到密封号码后，大家都去验证这个数字是否能满足输出需求。如是，则在他们的页面上贴上这个标签，再把这个页面放进文件夹。</p>\n<p>但是如果7号算出了密封号码并“昭告了天下”，但结果大家发现这个数字并不满足他们的输出需求怎么办？这样的情况也很常见。原因可能有以下几点：</p>\n<p>1. 公布交易信息时听错了；</p>\n<p>2. 记录交易信息时出现笔误；</p>\n<p>3. 为了一己之利，记录交易时故意犯错。</p>\n<p>不管出于什么原因，7号只有一种选择——丢弃自己这张纸，然后从别人那里复制一份副本放进他自己的文件夹。如果不把这个页面放进文件夹，他就不能继续记录接下来的交易记录，这也就相当于把他从这个交易网络中踢掉了。</p>\n<p>说到这里，我相信有的人脑海里又出现了一个疑惑：既然有人计算好密封号码后会公布，为什么我们每个人还要花费那么多时间都去计算一遍？其他人为什么不歇着、坐等公布？</p>\n<p>Good question!区块链包含特殊的奖励机制，网络中每个人都有资格获得奖励。第一个计算出密封号码的人能够获得一定奖励。</p>\n<p>我们再来简单地假设一下，如果5号第一个算出了页面的密封号码，并获得了1美元的金额奖励，那么这1美元就是凭空出现的。换句话说，假如他账户里本来余额5美元，现在增加了1元，但是这1元没有从其它任何人的账户里扣除，即没有减少任何人的账户余额。</p>\n<p>这就是比特币的起源。它是在区块链（分布式账目）上发生交易的第一种货币。如果在这个交易网络上持续努力，你同样也能获得回报，这个过程就是我们所说的“挖矿”。</p>\n<p>拥有比特币的人越来越多，这些人一刻不闲着地开始炒这种虚拟货币，不断扩大市场对比特币的需求，再进一步提高比特币的价值。就这样周而复始地把比特币的价格炒得很高。</p>\n<p>这种奖励机制让交易网络中的每个人都勤勤恳恳地劳作。</p>\n<p>他们把纸张放进文件夹后，拿出一张新的空白纸张，然后再次重复前面的过程——循环往复、永无止境。</p>\n<p>假设文件夹中已经有5个被密封的页面。如果我为了谋取私利修改了第二个页面的其中一笔交易会发生什么？前面已经提到过，所有人都可以通过密封号码查出交易内容已经发生改变。但是如果我根据修改的内容重新计算密封号码，然后把新号码贴在纸上，出现这样的情况怎么办？</p>\n<p>为了防止有人同时修改页面和密封号码，计算密封号码时有一个小技巧。</p>\n<p><strong>如何防止密封号码被重新计算、更改？</strong></p>\n<p>还记得之前我假设你有两个盒子，一个包含20893这个数字，一个是用于计算的空盒子吗？在区块链中计算密封号码，实际上存在三个盒子，而不是两个，其中两个是有内容的，一个是待计算填充的。</p>\n<p>当三个盒子的内容都填好放入机器后，机器右边输出的结果能够满足我们的需求。</p>\n<p>一个盒子里是交易记录、一个盒子是密封号码，第三个盒子是通过哈希函数计算出来的前一页的输出结果。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/e21b6b9e3ecaf688e7062ac64e85e53c.png\"><img class=\"aligncenter wp-image-111788 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e21b6b9e3ecaf688e7062ac64e85e53c.png\" alt=\"1\" width=\"800\" height=\"800\"></a></p>\n<p>通过这个小技巧，我们能够确保每一页的密封号码都与前一页的内容相关联。因此如果有人修改了历史页面的内容，他需要改动接下来每一页的密封号码，从而保证整个链路的一致性。</p>\n<p>我们假设十个人中有一个人想要恶意修改区块链中的内容（包含记录了交易历史页面的文件夹），那么他需要调整很多页面，计算改动页面之后所有页面的密封号码。我们都知道计算密封号码的工作非常困难。因此，整个交易网络中的一个叛徒最终还是会输个剩下的9个好人。</p>\n<p>从这个叛徒想要更改内容的页面开始，他就需要在整个网络中创建另一个区块链，但是这个区块链几乎不可能赶上好人们创建的链路——一个人的力量赶不上剩下9个人的共同努力。因此，有一点非常明确，区块链规模越大，安全性和可信度越高。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0cccd45985994d1e22ee95332fe1fb1c.png\"><img class=\"aligncenter wp-image-111789 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0cccd45985994d1e22ee95332fe1fb1c.png\" alt=\"1\" width=\"1000\" height=\"637\"></a></p>\n<p>但是如果10个人中有6个人都叛变了怎么办？</p>\n<p>如果出现这样的情况，这个协议就有点打脸了。这种情况被称为“51%攻击”。如果整个网络中的大多数人都决定叛变，欺骗剩下不到半数的人，那么整个协议就自然而然地走向了灭亡。</p>\n<p>这是区块链最大的弱点。尽管这样的情况不可能出现，但我们还是要谨记这个系统的弱点。整个体系都是基于一个假设：整个交易网络中的大多数人都不会叛变。</p>\n<p><strong>结 局</strong></p>\n<p>解释到这里也就差不多了。还请亲爱的们再回头看看百度百科给出的定义，现在是不是理解起来容易很多了？</p>\n<p>如果还有人问起到底什么是区块链，比特币的运作机制是怎样的，我相信本文的读者都能够解释给更多的小白们听啦。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111768\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111768votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111768\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "939ee37643c72df31691e8a75739908f", "praise_num": 5, "tags": "开发", "fav_nums": 15, "title": "王垠：如何掌握所有的程序语言", "comments_num": 2, "create_date": "2017/07/07", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/01/f9dc3a6611e10b616985757498ed6a74.jpg"], "front_image_path": "full/9a8539839727cdcb8492a550ef7b35f838a85f14.jpg", "url": "http://blog.jobbole.com/111469/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.yinwang.org/blog-cn/2017/07/06/master-pl\">王垠</a>   </div><p>对的，我这里要讲的不是如何掌握一种程序语言，而是所有的……</p>\n<p>很多编程初学者至今还在给我写信请教，问我该学习什么程序语言，怎么学习。由于我知道标题问题的答案，所以总感觉这个问题是如此“低级”，一直没来得及回复 :P 可是逐渐的，我发现原来不只是小白们有这个问题，就连美国大公司的很多资深工程师，其实也没搞明白。</p>\n<p>今天休闲活动进入第二个星期，稍微闲下来一点，我想来统一回答一下这个搁置已久的“初级问题”。这个话题貌似曾经写过，然而现在我想把它重新写一遍。因为通过跟很多人的交流，我对自己头脑中的（未转化为语言的）想法，有了更精确的表达。</p>\n<p>如果你存在以下的种种困惑，那么这篇文章也许会对你有所帮助：</p>\n<ol>\n<li>你是编程初学者，不知道该选择什么程序语言来入门。</li>\n<li>你是资深的程序员或者团队领导，对新出现的种种语言感到困惑，不知道该“投资”哪种语言。</li>\n<li>你的团队为使用哪种程序语言争论不休，发生各种宗教斗争。</li>\n<li>你追逐潮流采用了某种时髦的语言，结果两个月之后发现深陷泥潭，痛苦不堪……</li>\n</ol>\n<p>虽然我已经不再过问这些世事，然而无可置疑的现实是，程序语言仍然是很重要的话题，这个情况短时间内不会改变。程序员的岗位往往会要求熟悉某些语言，甚至某些奇葩的公司要求你“深入理解 OOP 或者 FP 设计模式”。对于在职的程序员，程序语言至今仍然是可以争得面红耳赤的宗教话题。它的宗教性之强，以至于我在批评和调侃某些语言（比如 Go 语言）的时候，有些人会本能地以为我是另外一种语言（比如 Java）的粉丝。</p>\n<p>显然我不可能是任何一种语言的粉丝，我甚至不是 Yin 语言的粉丝 ;) 对于任何从没见过的语言，我都是直接拿起来就用，而不需要经过学习的过程。看了这篇文章，也许你会明白我为什么可以达到这个效果。理解了这里面的东西，每个程序员都应该可以做到这一点。嗯，但愿吧。</p>\n<h3 id=\"重视语言特性而不是语言\">重视语言特性，而不是语言</h3>\n<p>很多人在乎自己或者别人是否“会”某种语言，对“发明”了某种语言的人倍加崇拜，为各种语言的孰优孰劣争得面红耳赤。这些问题对于我来说都是不存在的。虽然我写文章批评过不少语言的缺陷，在实际工作中我却很少跟人争论这些。如果有其它人在我身边争论，我甚至会戴上耳机，都懒得听他们说什么 ;) 为什么呢？我发现归根结底的原因，是因为我重视的是“语言特性”，而不是整个的“语言”。我能用任何语言写出不错的代码，就算再糟糕的语言也差不了多少。</p>\n<p>任何一种“语言”，都是各种“语言特性”的组合。打个比方吧，一个程序语言就像一台电脑。它的牌子可能叫“联想”，或者“IBM”，或者“Dell”，或者“苹果”。那么，你可以说苹果一定比 IBM 好吗？你不能。你得看看它里面装的是什么型号的处理器，有多少个核，主频多少，有多少 L1 cache，L2 cache……，有多少内存和硬盘，显示器分辨率有多大，显卡是什么 GPU，网卡速度，等等各种“配置”。有时候你还得看各个组件之间的兼容性。</p>\n<p>这些配置对应到程序语言里面，就是所谓“语言特性”。举一些语言特性的例子：</p>\n<ul>\n<li>变量定义</li>\n<li>算术运算</li>\n<li>for 循环语句，while 循环语句</li>\n<li>函数定义，函数调用</li>\n<li>递归</li>\n<li>静态类型系统</li>\n<li>类型推导</li>\n<li>lambda 函数</li>\n<li>面向对象</li>\n<li>垃圾回收</li>\n<li>指针算术</li>\n<li>goto 语句</li>\n</ul>\n<p>这些语言特性，就像你在选择一台电脑的时候，看它里面是什么配置。选电脑的时候，没有人会说 Dell 一定是最好的，他们只会说这个型号里面装的是 Intel 的 i7 处理器，这个比 i5 的好，DDR3 的内存 比 DDR2 的快这么多，SSD 比磁盘快很多，ATI 的显卡是垃圾…… 如此等等。</p>\n<p>程序语言也是一样的道理。对于初学者来说，其实没必要纠结到底要先学哪一种语言，再学哪一种。曾经有人给我发信问这种问题，纠结了好几个星期，结果一个语言都还没开始学。有这纠结的时间，其实都可以把他纠结过的语言全部掌握了。</p>\n<p>初学者往往不理解，每一种语言里面必然有一套“通用”的特性。比如变量，函数，整数和浮点数运算，等等。这些是每个通用程序语言里面都必须有的，一个都不能少。你只要通过“某种语言”学会了这些特性，掌握这些特性的根本概念，就能随时把这些知识应用到任何其它语言。你为此投入的时间基本不会浪费。所以初学者纠结要“先学哪种语言”，这种时间花的很不值得，还不如随便挑一个语言，跳进去。</p>\n<p>很多初学者不了解，一个高明的程序员如果开始用一种新的程序语言，他往往不是去看这个语言的大部头手册或者书籍，而是先有一个需要解决的问题。手头有了问题，他可以用两分钟浏览一下这语言的手册，看看这语言大概长什么样。然后，他直接拿起一段例子代码来开始修改捣鼓，想法把这代码改成自己正想解决的问题。在这个简短的过程中，他很快的掌握了这个语言，并用它表达出心里的想法。</p>\n<p>在这个过程中，随着需求的出现，他可能会问这样的问题：</p>\n<ul>\n<li>这个语言的“变量定义”是什么语法，需要“声明类型”吗，还是可以用“类型推导”？</li>\n<li>它的“类型”是什么语法？是否支持“泛型”？泛型的 “variance” 如何表达？</li>\n<li>这个语言的“函数”是什么语法，“函数调用”是什么语法，可否使用“缺省参数”？</li>\n<li>……</li>\n</ul>\n<p>注意到了吗？上面每一个引号里面的内容，都是一种语言特性（或者叫概念）。这些概念可以存在于任何的语言里面，虽然语法可能不一样，它们的本质都是一样的。比如，有些语言的参数类型写在变量前面，有些写在后面，有些中间隔了一个冒号，有些没有。</p>\n<p>这些实际问题都是随着写实际的代码，解决手头的问题，自然而然带出来的，而不是一开头就抱着语言手册看得仔仔细细。因为掌握了语言特性的人都知道，自己需要的特性，在任何语言里面一定有对应的表达方式。如果没有直接的方式表达，那么一定有某种“绕过方式”。如果有直接的表达方式，那么它只是语法稍微有所不同而已。所以，他是带着问题找特性，就像查字典一样，而不是被淹没于大部头的手册里面，昏昏欲睡一个月才开始写代码。</p>\n<p>掌握了通用的语言特性，剩下的就只剩某些语言“特有”的特性了。研究语言的人都知道，要设计出新的，好的，无害的特性，是非常困难的。所以一般说来，一种好的语言，它所特有的新特性，终究不会超过一两种。如果有个语言号称自己有超过 5 种新特性，那你就得小心了，因为它们带来的和可能不是优势，而是灾难！</p>\n<p>同样的道理，最好的语言研究者，往往不是某种语言的设计者，而是某种关键语言特性的设计者（或者支持者）。举个例子，著名的计算机科学家 Dijkstra 就是“递归”的强烈支持者。现在的语言里面都有递归，然而你可能不知道，早期的程序语言是不支持递归的。直到 Dijkstra 强烈要求 Algol 60 委员会加入对递归的支持，这个局面才改变了。Tony Hoare 也是语言特性设计者。他设计了几个重要的语言特性，却没有设计过任何语言。另外大家不要忘了，有个语言专家叫王垠，他是早期 union type 的支持者和实现者，也是 checked exception 特性的支持者，他在自己的<a href=\"http://www.yinwang.org/blog-cn/2017/05/23/kotlin\">博文</a>里指出了 checked exception 和 union type 之间的关系 :P</p>\n<p>很多人盲目的崇拜语言设计者，只要听到有人设计（或者美其民曰“发明”）了一个语言，就热血沸腾，佩服的五体投地。他们却没有理解，其实所有的程序语言，不过是像 Dell，联想一样的“组装机”。语言特性的设计者，才是像 Intel，AMD，ARM，Qualcomm 那样核心技术的创造者。</p>\n<h3 id=\"合理的入门语言\">合理的入门语言</h3>\n<p>所以初学者要想事半功倍，就应该从一种“合理”的，没有明显严重问题的语言出发，掌握最关键的语言特性，然后由此把这些概念应用到其它语言。哪些是合理的入门语言呢？我个人觉得这些语言都可以用来入门：</p>\n<ul>\n<li>Scheme</li>\n<li>C</li>\n<li>Java</li>\n<li>Python</li>\n<li>JavaScript</li>\n</ul>\n<p>那么相比之下，我不推荐用哪些语言入门呢？</p>\n<ul>\n<li>Shell</li>\n<li>PowerShell</li>\n<li>AWK</li>\n<li>Perl</li>\n<li>PHP</li>\n<li>Basic</li>\n<li>Go</li>\n</ul>\n<p>总的说来，你不应该使用所谓“<a href=\"http://www.yinwang.org/blog-cn/2013/03/29/scripting-language\">脚本语言</a>”作为入门语言，特别是那些源于早期 Unix 系统的脚本语言工具。PowerShell 虽然比 Unix 的 Shell 有所进步，然而它仍然没有摆脱脚本语言的根本问题——他们的设计者不知道他们自己在干什么 :P</p>\n<p>采用脚本语言学编程，一个很严重的问题就是使得学习者抓不住关键。脚本语言往往把一些系统工具性质的东西（比如正则表达式，Web 概念）加入到语法里面，导致初学者为它们浪费太多时间，却没有理解编程最关键的概念：变量，函数，递归，类型……</p>\n<p>不推荐 Go 语言的原因类似，虽然 Go 语言不算脚本语言，然而他的设计者显然不明白自己在干什么。所以使用 Go 语言来学编程，你不能专注于最关键，最好的语言特性。</p>\n<h3 id=\"掌握关键语言特性忽略次要特性\">掌握关键语言特性，忽略次要特性</h3>\n<p>为了达到我之前提到的融会贯通，一通百通的效果，初学者应该专注于语言里面最关键的特性，而不是被次要的内容分心。我发现很多编程培训班和野鸡大学的编程入门课，往往一来就教学生如何使用 printf 打印“Hello World！”，进而要他们记忆 printf 的各种“格式字符”的意义，要他们实现各种复杂格式的打印输出，甚至要求打印到文本文件里，然后再读出来……</p>\n<p>可是殊不知，这种输出输入操作其实根本不算是语言的一部分，而且对于掌握编程的核心概念来说，都是次要的。有些人的 Java 课程进行了好几个星期，居然还在布置各种 printf 的作业。学生写出几百行的 printf，却不理解变量和函数是什么，甚至连算术语句和循环语句都不知道怎么用！这就是为什么很多初学者感觉编程很难，我连 <code class=\"highlighter-rouge\">%d</code>，<code class=\"highlighter-rouge\">%f</code>，<code class=\"highlighter-rouge\">%.2f</code>的含义都记不住，还怎么学编程！</p>\n<p>然而这些野鸡大学的“教授”头衔是如此的洗脑，以至于被他们教过的学生（比如我女朋友）到我这里请教，居然骂我净教一些没用的东西，学了连 printf 的作业都没法完成 :P 你别跟我讲 for 循环，函数什么的了…… 可不可以等几个月，等我背熟了 printf 的用法再学那些啊？</p>\n<p>所以你就发现一旦被差劲的老师教过，这个程序员基本就毁了。就算遇到好的老师，他们也很难纠正过来。</p>\n<h3 id=\"自己动手实现语言特性\">自己动手实现语言特性</h3>\n<p>在基本学会了各种语言特性，能用它们来写代码之后，下一步的进阶就是去实现它们。只有实现了各种语言特性，你才能完完全全的拥有它们，成为它们的主人。否则你就只是它们的使用者，你会永远做语言创造者们的仆人。</p>\n<p>有个大师说得好，完全理解一种语言最好的方法就是自己动手实现它，也就是自己写一个解释器来实现它的语义。但我觉得这句话应该稍微修改一下：完全理解一种“语言特性”最好的方法就是自己亲自实现它。</p>\n<p>注意我在这里把“语言”改为了“语言特性”。你并不需要实现整个语言来达到这个目的，因为我们最终使用的是语言特性。只要你自己实现了一种语言特性，你就能理解这个特性在任何语言里的实现方式和用法。</p>\n<p>举个例子，学习 SICP 的时候，大家都会亲自用 Scheme 实现一个面向对象系统。用 Scheme 实现的面向对象系统，跟 Java，C++，Python 之类的语言语法相去甚远，然而它却能帮助你理解任何这些 OOP 语言里面的“面向对象”这一概念，它甚至能帮助你理解各种面向对象实现的差异。</p>\n<p>这种效果是你直接学习 OOP 语言得不到的，因为在学习 Java，C++，Python 之类语言的时候，你只是一个用户，而用 Scheme 自己动手实现了 OO 系统之后，你成为了一个创造者。</p>\n<p>类似的特性还包括类型推导，类型检查，惰性求值，如此等等。我实现过几乎所有的语言特性，所以任何语言在我的面前，都是可以被任意拆卸组装的玩具，而不再是凌驾于我之上的神圣。</p>\n<h3 id=\"总结\">总结</h3>\n<p>写了这么多，重要的话重复三遍：语言特性，语言特性，语言特性，语言特性！不管是初学者还是资深程序员，应该专注于语言特性，而不是纠结于整个的“语言品牌”。只有这样才能达到融会贯通，拿起任何语言几乎立即就会用，并且写出高质量的代码。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111469\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111469votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111469\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 15 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "206d408271cde72276773274eb31dfde", "praise_num": 1, "tags": "IT技术", "fav_nums": 0, "title": "如何最有效的编写SQL", "comments_num": 0, "create_date": "2017/07/12", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/01/970c5be7812066919173f6ec5ab052ce.png"], "front_image_path": "full/0e89c4879b2842f9c58098e98ad64d0a9d218103.jpg", "url": "http://blog.jobbole.com/111807/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/the-most-effective-way-to-write-effective-sql-chan\">Emrah Mete</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32540\">ITeye-黑色巧克力</a>   </div><p><em>译者注：解决数据库级（SQL）工作上的问题，应该采用的是SET方法（整体的）而不是过程式的方法。下面来看看作者为什么这么说。</em></p>\n<p>编写有效的SQL查询是企业软件世界中最大的难题之一。</p>\n<p>每个公司在数据库开发项目中所面临的最根本的问题，在于开发环境中实现的性能不能在生产环境中实现。一般来说，存在性能损失是因为生产环境中的数据量要大得多。</p>\n<p>这些问题（运行缓慢的数据库操作）可能有各种各样的原因。本文将解释如何在编写查询时进行思考，如何思考是最基本的问题，也是解决此类问题的起点。</p>\n<p>观察发现SQL开发人员常使用过程方法编写查询。事实上，这是很自然的，因为用程序方法解决问题是最方便的人类逻辑解决方案。另一个方面，几乎所有的SQL开发人员都在同时编写Java、c#或其他编程语言的代码。Java、C#等可以用来训练开发人员以一种程序化的方式来培养他们的思维方式，因为当使用这些语言开发应用程序时，会使用很多类似的东西，比如IF .. THEN .. ELSE，FOR .. LOOP，WHILE .. DO， CASE .. WHEN。当然，在这种情况下，当将业务规则应用到一组数据时，意味着每个记录都是单独处理的(逐行处理)。这个过程方法在Java、c#等语言中使用。虽然使用语言开发软件是一种正确的方法，但在编写数据库级(SQL)的查询时，却不会产生同样的效果。</p>\n<p>下面用两种不同的方法来解决同一个示例问题，并将结果进行比较。看看CUSTOMERS表中对应的每个客户在SALES表中有多少条记录。</p>\n<p>过程式方法如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965d87f4ae50764262222\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET AUTOTRACE ON\r\nSELECT \r\n      c.cust_id,\r\n       (SELECT COUNT (*)\r\n          FROM sh.sales s\r\n         WHERE s.cust_id = c.cust_id)\r\n          sa_count\r\n  FROM SH.CUSTOMERS c;\r\nPlan hash value: 881374884\r\nStatistics\r\n----------------------------------------------------------\r\n          0  recursive calls\r\n          0  db block gets\r\n    2454756  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     925474  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae50764262222-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae50764262222-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-3\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-4\"><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-5\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sales</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">sa_count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-8\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">CUSTOMERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-9\"><span class=\"crayon-e\">Plan </span><span class=\"crayon-e\">hash </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">881374884</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-10\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-11\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-12\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-13\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">2454756</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-15\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-17\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">925474</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-18\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-19\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-20\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae50764262222-21\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae50764262222-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5c59d421762074b3cc17f430ca7ce714.png\"></div>\n<p>现在，采用基于SET的方法来编写查询。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965d87f4ae59356273113\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET AUTOTRACE ON\r\nSELECT \r\n        c.cust_id, COUNT (s.cust_id) jh_count\r\n    FROM SH.CUSTOMERS c, sh.sales s\r\n   WHERE c.cust_id = s.cust_id(+)\r\nGROUP BY c.cust_id;\r\nPlan hash value: 716053480\r\nStatistics\r\n----------------------------------------------------------\r\n          1  recursive calls\r\n          0  db block gets\r\n        742  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     925474  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae59356273113-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae59356273113-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-2\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jh_count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">CUSTOMERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sales</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cust_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-6\"><span class=\"crayon-e\">GROUP </span><span class=\"crayon-i\">BY</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-7\"><span class=\"crayon-e\">Plan </span><span class=\"crayon-e\">hash </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">716053480</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-8\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-9\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-10\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-11\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">742</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-13\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-14\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-15\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">925474</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-17\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-18\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae59356273113-19\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae59356273113-20\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c68cc95938e0f52a457d15867b33b3fc.png\"></div>\n<p>可以看到在两个查询的consistent gets数量之间的差异（当检查缓冲区缓存读到的块数据时）是巨大的。使用两种不同方法编写的查询在运行时导致不同时间。这种差别可以用性能来解释。</p>\n<p>在另一个例子中，常见的习惯是在SQL语句中调用PL/SQL函数。作为过程式工作的例子，也是一种解决问题的方法。还有其他一些影响在SQL内调用PL/SQL代码性能的不利因素，但在本文中，不会提到性能问题。</p>\n<p>下面编写查找客户表中每个客户的购买金额的代码。</p>\n<p>过程方法:</p>\n<p>在第一步中，创建一个PL/SQL函数来计算每个客户的总数，然后在代码和输出中调用这个函数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965d87f4ae5e281268645\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE OR REPLACE FUNCTION get_grand_total (\r\n   p_cust_id_in IN SH.CUSTOMERS.CUST_ID%TYPE)\r\n   RETURN NUMBER\r\nIS\r\n   r_grand_total   NUMBER;\r\nBEGIN\r\n   SELECT SUM (amount_sold)\r\n     INTO r_grand_total\r\n     FROM sh.sales\r\n    WHERE cust_id = p_cust_id_in;\r\n   RETURN r_grand_total;\r\nEND;\r\nSET AUTOTRACE ON\r\nSELECT cust_id, \r\n            get_grand_total (cust_id) grand_total \r\nFROM sh.customers;\r\nStatistics\r\n----------------------------------------------------------\r\n      55503  recursive calls\r\n          0  db block gets\r\n    3066293  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     890447  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae5e281268645-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae5e281268645-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">REPLACE </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_grand_total</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">p_cust_id_in </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CUSTOMERS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CUST_ID</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">TYPE</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NUMBER</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-4\"><span class=\"crayon-st\">IS</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">r_grand_total   </span><span class=\"crayon-v\">NUMBER</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-6\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-7\"><span class=\"crayon-e\">   </span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">SUM</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">amount_sold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-8\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">r_grand_total</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-9\"><span class=\"crayon-e\">     </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sales</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p_cust_id_in</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r_grand_total</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-12\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-13\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-14\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">get_grand_total</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grand_total </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-16\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">customers</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-17\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-18\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55503</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-20\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">3066293</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-22\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-23\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-24\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">890447</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-25\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-26\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-27\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae5e281268645-28\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae5e281268645-29\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b2618277a22d514ec13ef9a857ab3ec9.png\"></div>\n<p>现在，采用基于SET的方法来编写查询。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965d87f4ae62857429724\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET AUTOTRACE ON\r\n  SELECT c.cust_id, SUM (amount_sold)\r\n    FROM SH.CUSTOMERS c, sh.sales s\r\n   WHERE c.cust_id = s.cust_id(+)\r\nGROUP BY c.cust_id;\r\nStatistics\r\n----------------------------------------------------------\r\n          1  recursive calls\r\n          0  db block gets\r\n       1841  consistent gets\r\n          0  physical reads\r\n          0  redo size\r\n     890452  bytes sent via SQL*Net to client\r\n      41104  bytes received via SQL*Net from client\r\n       3701  SQL*Net roundtrips to/from client\r\n          0  sorts (memory)\r\n          0  sorts (disk)\r\n      55500  rows processed</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae62857429724-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae62857429724-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae62857429724-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae62857429724-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae62857429724-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae62857429724-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae62857429724-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae62857429724-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae62857429724-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae62857429724-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae62857429724-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae62857429724-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae62857429724-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae62857429724-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae62857429724-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae62857429724-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965d87f4ae62857429724-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965d87f4ae62857429724-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965d87f4ae62857429724-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-e\">AUTOTRACE </span><span class=\"crayon-e\">ON</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae62857429724-2\"><span class=\"crayon-e\">  </span><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUM</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">amount_sold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae62857429724-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">SH</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">CUSTOMERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sales</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae62857429724-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cust_id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae62857429724-5\"><span class=\"crayon-e\">GROUP </span><span class=\"crayon-i\">BY</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cust_id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae62857429724-6\"><span class=\"crayon-v\">Statistics</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae62857429724-7\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae62857429724-8\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">recursive </span><span class=\"crayon-i\">calls</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae62857429724-9\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">db </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae62857429724-10\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">1841</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">consistent </span><span class=\"crayon-i\">gets</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae62857429724-11\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">physical </span><span class=\"crayon-i\">reads</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae62857429724-12\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">redo </span><span class=\"crayon-i\">size</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae62857429724-13\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">890452</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">sent </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae62857429724-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">41104</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">received </span><span class=\"crayon-e\">via </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae62857429724-15\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">3701</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">SQL*</span><span class=\"crayon-e\">Net </span><span class=\"crayon-e\">roundtrips </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae62857429724-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965d87f4ae62857429724-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sorts</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">disk</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965d87f4ae62857429724-18\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">55500</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">rows </span><span class=\"crayon-v\">processed</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p></p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c419b66138cea074ab015cdd55726c10.png\"></div>\n<p>在本例中，通过查看consistent GETS和递归调用输出，我们可以看到相同的情况。</p>\n<p>我们的查询也是生成更高效的数据库操作的第一步，它考虑的是批处理，而不是逐行思考。在进行数据库操作时，批处理的方法会让你在一天结束时消耗更少的资源，从而提高工作效率。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111807\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111807votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111807\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "a7e761864e16693a072a866a8afdabb1", "praise_num": 1, "tags": "趣文小说", "fav_nums": 8, "title": "漫画算法：什么是跳跃表？", "comments_num": 5, "create_date": "2017/07/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/daab64eb4fff66513ac482d07e5ae054.jpeg"], "front_image_path": "full/27823440373381b04421fc70634750dfcfca3b30.jpg", "url": "http://blog.jobbole.com/111731/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>这是发生在很多年以前的故事……</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/daab64eb4fff66513ac482d07e5ae054.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/890d2a8f840ed95165dcd3df24ed584c.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1ec995966632cc86d75a2511bba11c5c.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b0c602dc9acb987c129f35169341b74d.jpeg\"></p>\n<p>几天以前……</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/53f3319b898ce41a545b29d930946a2a.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5f1e257214c48a4d8246b9395bb0f0df.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/10dd099feb00060dad6b1339e0db8799.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/45606dfe47cc5586318007d1970f26e5.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0716a40761dbfdbf797543bb24b58945.jpeg\"></p>\n<p>几天之后……</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5f5785668595f59e8ba4778cae9f2d6a.jpeg\"></p>\n<p>拍卖行的商品总数量有几十万件，对应数据库商品表的几十万条记录。</p>\n<p>如果是按照商品名称精确查询还好办，可以直接从数据库查出来，最多也就上百条记录。</p>\n<p>如果是没有商品名称的全量查询怎么办？总不可能把数据库里的所有记录全查出来吧，而且还要支持不同字段的排序。</p>\n<p>所以，只能提前在内存中存储有序的全量商品集合，每一种排序方式都保存成独立的集合，每次请求的时候按照请求的排序种类，返回对应的集合。</p>\n<p>比如按价格字段排序的集合：</p>\n<p>比如按等级字段排序的集合：</p>\n<p>需要注意的是，当时还没有Redis这样的内存数据库，所以小灰只能自己实现一套合适的数据结构来存储。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/8eadcb96909cbebc38292974d5216fab.jpeg\"></p>\n<p>拍卖行商品列表是线性的，最容易表达线性结构的自然是数组和链表。可是，无论是数组还是链表，在插入新商品的时候，都会存在性能问题。</p>\n<p>按照商品等级排序的集合为例，如果使用数组，插入新商品的方式如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/af7f12cccfbda80b967d515acebe79d9.jpeg\"></p>\n<p>如果要插入一个等级是3的商品，首先要知道这个商品应该插入的位置。使用二分查找可以最快定位，这一步时间复杂度是O（logN）。</p>\n<p>插入过程中，原数组中所有大于3的商品都要右移，这一步时间复杂度是O（N）。所以总体时间复杂度是O（N）。</p>\n<p>如果使用链表，插入新商品的方式如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1bce6be23668647edf9eff28d305c84f.jpeg\"></p>\n<p>如果要插入一个等级是3的商品，首先要知道这个商品应该插入的位置。链表无法使用二分查找，只能和原链表中的节点逐一比较大小来确定位置。这一步的时间复杂度是O（N）。</p>\n<p>插入的过程倒是很容易，直接改变节点指针的目标，时间复杂度O（1）。因此总体的时间复杂度也是O（N）。</p>\n<p>这对于拥有几十万商品的集合来说，这两种方法显然都太慢了。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e3be5ef6ac109306ee1dd169fb6b8df3.jpeg\"></p>\n<p>——————————————</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/00e8f84563ba3fc4e926f4b8b2f5fe7a.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e795edb90cf7d598d733592920657a97.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3cd2a28c4e3e48550d33f7fe4a47fd0.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/02717bbe18ec7d1034580481ffa22e7e.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9bfe1887ff9177a8c0f303de054c79fe.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/377693e7b3f37892f42e4e144f92c362.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b9b3c90dc0681f0af4963d783dff24d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/15ece5c25170a528131c4e7803c8e0e8.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a58d35069f85e181659f2c8dc98cffbc.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/325af9d7f350486e58b41b32bd254227.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c708e4a0c267b5e9f3a37ad309e6c3e8.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/fa5f0684ada4d509f3e978c104f576ac.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4d469cbe0d0afb9bb7cf2c99f266a5f9.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d972154799e05c43dc61c56cbc182203.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e0ef1f5c4cbfa110713984f06904c97a.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bb33df3e70571a35b0d38cfa2aa0f719.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c66bd9b6ba634f5df05dfb4931201217.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/757e77b87645239013108a7eac7cac78.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a502d32bad14a5943b78e5ec283eb6a3.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ea99ed67b7cdb47d04c3703f12a64bc4.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e98cfa966bb1cfa58a5e8a11505a3e0f.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6e5972f05c028476a0b2eb43850a1432.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ea50cbc49ca84c72b94cb693d121c017.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3063e527ca511c457824b146b3047fb2.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ad1e060829476ef9de94d33ea246009d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f0fed037f81a07b51108a6d6468e4235.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6f7628b9803eaae385222da353b34b83.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0b69b19d022c8a75aa2d83fca3d10066.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a327ac84038bdf376496a07a5d61d23d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/98b8caa7a5b7da9aaf7999a7f502fd92.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/df485893afb0b40cfec65ce19233faa6.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0c38e0ee3659932960bbc9b3c310fab8.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dedddf4bf8ad251e479ce73ef0f628c9.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4b8a95bfc81b232d79b2c8056ca454ec.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4f6bafe8717d30780a0bc7ae1110c37d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9e92dc231f4069da54a71fa6be3bd12e.jpeg\"></p>\n<p>新节点和各层索引节点逐一比较，确定原链表的插入位置。O（logN）</p>\n<p>把索引插入到原链表。O（1）</p>\n<p>利用抛硬币的随机方式，决定新节点是否提升为上一级索引。结果为“正”则提升并继续抛硬币，结果为“负”则停止。O（logN）</p>\n<p>总体上，跳跃表插入操作的时间复杂度是O（logN），而这种数据结构所占空间是2N，既空间复杂度是 O（N）。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/95b14789cf228b85159be05aa93cbaa4.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0a64ff5e6453328bf1360416339c0adb.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0da2ce061fbca4790c93b0139e66d289.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/86a6084f88fa592dd304e890b72409eb.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7c32aa5ab5f2c936078f16840eabf1b2.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/41d9de8c654dc43b0f1703b0e29c6590.jpeg\"></p>\n<p>自上而下，查找第一次出现节点的索引，并逐层找到每一层对应的节点。O（logN）</p>\n<p>删除每一层查找到的节点，如果该层只剩下1个节点，删除整个一层（原链表除外）。O（logN）</p>\n<p>总体上，跳跃表删除操作的时间复杂度是O（logN）。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/24f060f88decdf946d1069ce4c82f57d.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e7566dee2274eb9bfcefcc13c1a7494c.jpeg\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/869228a1933d8e4a9e8ec81afc0603d5.jpeg\"></p>\n<p>小灰和大黄并不知道，他们的这一解决方案和若干年后Redis当中的Sorted-set不谋而合。而Sorted-set这种有序集合，正是对于跳跃表的改进和应用。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/2df4a3ede6e684f78858dfde0e7b118f.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111731\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111731votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111731\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">玻璃猫</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/7ce4028f2cece3294efcb3e5caa73af1.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            互联网公司的码农一枚，喜欢算法和面向对象设计。个人微信号：13522239721 个人订阅号：dreamsee321欢迎一起交流讨论！        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/bjweimengshu\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/bjweimengshu/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/bjweimengshu/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 94</a> · <a title=\"个人微信：bjweimengshu\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "7005be04c2edd13df9a087263d719892", "praise_num": 1, "tags": "IT技术", "fav_nums": 3, "title": "带着问题学习分布式系统之数据分片", "comments_num": 0, "create_date": "2017/07/03", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/9c3ebd88533763a9cc48fc406d741a1a.png"], "front_image_path": "full/4f98c9ecf55b5d6ac63cc8ecc27f2fa194e86ad0.jpg", "url": "http://blog.jobbole.com/111716/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xybaby/p/7076731.html\">xybaby</a>   </div><p>听过很多道理，却依然过不好这一生。</p>\n<p>看过很多关于学习的技巧、方法，却没应用到自己的学习中。</p>\n<p>随着年纪变大，记忆力越来越差，整块的时间也越来越少，于是，越来越希望能够更高效的学习。学习是一种习惯也是一种能力，这种能力在上学期间养成是最好的，毕竟那个时候绝大部分时间都在学习。但很遗憾，我没有养成适合自己的、好的学习习惯。工作之后，除了在日常工作中用到的知识技术，很难通过自学掌握新的知识（偏向于专业知识，即技术）。而互联网行业的分支、知识点又是如此之多，于是会出现这样的情况，遇到一个新的知识，觉得很厉害很感兴趣，看两天，但很快就忘记了。另外，对于一些比较庞杂的技术，又无从下手，也很难坚持下去。</p>\n<p>根本的问题在于学习不系统，没有把一个个的知识点连接起来，本来这些新的知识就很少在工作中实践，如果又是一个个的信息孤岛，很快就会被遗忘。另一个问题，没有良好的规划，今天看看这里，明天看看哪里，纠结于细枝末节，忘了从整体上把握。</p>\n<p>幸好，差不多半年前开始意识到了这个问题，开始看书，看别人的博客，开始思考如何充分利用好有限的时间。自己也实践了一些想法，比如写博客，坚持写博客。也有很多没做好，比如如何学习掌握一门新技术。关于这一点，其实看了许多文章，也有很多印象深刻，觉得很有道理；也有一些好书，比如《study more，learn less》。纸上得来终觉浅，绝知此事要躬行，别人的办法再好也需要亲身实践才知道是否对自己适用。</p>\n<p>需要学习的技术很多，要自学新知识也不是一件容易的事，选择一个自己比较感兴趣的会是一个比较好的开端，于是，打算学一学分布式系统。</p>\n<p><strong>带着问题，有目的的学习，先了解整体架构，在深入感兴趣的细节</strong>，这是我的计划。</p>\n<div>首先得有问题，如果每日重复相同的工作，也不主动去学习，很难发现新的问题。不怕自己无知，就怕不知道自己无知，只有不断的学习，才会发现更多未知的知识领域！</div>\n<h3>带着问题出发</h3>\n<p>分布式要解决什么问题呢？解决持久化数据太大，单个节点的硬盘无法存储的问题；解决运算量太大，单个节点的内存、CPU无法处理的问题。解决这些问题，有两种思路：scale up，scale out。前者就是提升单个节点的能力，更大的磁盘，更快的CPU，定制的软硬件，然而这意味着更高的价格，而且再怎么scaleup 也是有上限的。后者就是把存储、计算任务分担到普通的机器上，通过动态增加节点来应对数据量的增长，但缺点是多个节点的管理、任务的调度比较麻烦，这也是分布式系统研究和解决的问题。只有当数据量达到单机无法存储、处理的情况下才考虑分布式，不然都是自找麻烦。</p>\n<div>\n<div>状态的维护比计算要难很多，所谓状态就是需要持久化的数据。因此主要考虑分布式存储，况且即使是分布式计算，为了节省带宽需要尽量保证data locality，也是需要分布式存储。</div>\n<div></div>\n<div>现在有一堆数据，可能是结构化或者半结构化，需要将数据分片（segment、fragment、shard），形成一个个的数据子集，存储到一组物理节点上，物理节点之间通过网络通信。那么需要考虑两个问题：</div>\n<div></div>\n<blockquote>\n<div>第一：数据如何划分;</div>\n<div>第二：数据的可靠性、可用性问题</div>\n</blockquote>\n<h3>数据分片</h3>\n<p>数据分片是指将数据子集尽可能均衡的划分到各个物理节点上。那么会有哪些挑战呢？</p>\n<div>\n<p>（1）如果某个物理节点宕机，如何将该物理节点负责的数据尽快的转移到其他物理节点；</p>\n</div>\n<div>\n<p>（2）如果新增了物理节点，怎么从其他节点迁移数据到新节点；</p>\n</div>\n<p>（3）对于可修改的数据（即不是只能追加的数据），比如数据库数据，如果某节点数据量变大，怎么将部分数据迁移到其他负载较小的节点，及达到动态均衡的效果。</p>\n<div>（4）元数据的管理问题：当数据分布在各个节点，那么当用户使用的时候需要知道具体的数据在哪一个节点上。因此，系统需要维护<strong>数据的元数据：即每一个数据所在的位置、状态等信息</strong>。当用户需要具体的数据时，先查询元数据，然后再去具体的节点上查询。当数据在节点之间迁移的时候，也需要更新元数据。元数据的管理节点这里称之为meta server。元数据的管理也带来了新的挑战：</div>\n<div>（4.1）如何抽取数据的特征（特征是分片的依据，也是用户查询数据时的key），或者支持用户自定义数据特征；</div>\n<p>（4.2）如何保证meta server的高性能和高可用，是单点还是复制集</p>\n<div>（5）分片的粒度，即数据子集的大小，也是数据迁移的基本单位。粒度过粗，不利于数据均衡；粒度过细，管理、迁移成本又会比较大。</div>\n<h3>数据冗余</h3>\n<div>\n<p>前面提到，分布式系统中的节点都是普通的节点，因此有一定的概率会出现物理故障，比如断电、网络不可用，这些故障导致数据的暂时不可用；另外一些故障更严重，会导致数据的丢失，比如磁盘损坏。即使单个节点的故障是小概率，当集群中的节点数目很多是，故障就成为了一个大概率事件。因此，保证数据的高可用和可靠性是分布式系统必须解决的问题。</p>\n<p>为了避免单点故障，可行的办法就是数据冗余（复制集），即将同一份数据放在不同的物理节点，甚至是不同的数据中心。如果数据是一次写，多次读那很好办，随便从哪个副本读取都行。但对于很多分布式存储系统，比如数据库，数据是持续变化的，有读有写。那么复制集会带来什么样的挑战呢，需要如何权衡呢，假设有三个副本：</p>\n<p>（1）三个副本的地位，大家都是平等的还是有主（primary、master）有次（secondary、slave），如果是平等的，那么每个节点都可以接收写操作；如果不平等，可以一个节点负责所有的写操作，所有节点都提供读操作，</p>\n<p>（2）在平等的情况下，怎么保证写入操作不冲突，保证各个节点的数据是一致的，怎么保证能读取到最新的数据</p>\n<div>　　（3）不平等的情况下</div>\n<div>　　　　（3.1）写节点怎么将变更的数据同步到其他节点，同步还是异步；</div>\n<div>　　　　（3.2）非写节点能否提供读数据，如果能够允许，会不会读取到过时的数据。</div>\n<div>　　　　（3.3）主节点是怎么产生的，当主节点宕机的时候，怎么选择出新的主节点。是有统一的复制集管理中心（记录谁主谁次，各自的状态），还是复制集自己选举出一个主节点？</div>\n<p>（4）不管复制集内部的节点是平等的，还是有集中式节点的，只要有多个数据副本，就需要考虑数据的一致性可用性问题。按照CAP理论，只能同时满足一致性 可用性 分区容错性之间的二者，不同的分布式系统需要权衡。</p>\n</div>\n</div>\n<hr>\n<p>在前文中，提出了分布式系统（尤其是分布式存储系统）需要解决的两个最主要的问题，即数据分片和数据冗余，下面这个图片（<a href=\"http://book.mixu.net/distsys/intro.html\" target=\"_blank\">来源</a>）形象生动的解释了其概念和区别：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9c3ebd88533763a9cc48fc406d741a1a.png\" alt=\"\"></p>\n<p>其中数据即A、B属于数据分片，原始数据被拆分成两个正交子集分布在两个节点上。而数据集C属于数据冗余，同一份完整的数据在两个节点都有存储。当然，在实际的分布式系统中，数据分片和数据冗余一般都是共存的。</p>\n<p>本文主要讨论数据分片的三个问题：</p>\n<p>（1）如何做数据分片，即如何将数据映射到节点</p>\n<p>（2）数据分片的特征值，即按照数据中的哪一个属性（字段）来分片</p>\n<p>（3）数据分片的元数据的管理，如何保证元数据服务器的高性能、高可用，如果是一组服务器，如何保证强一致性</p>\n<p>所谓分布式系统，就是利用多个独立的计算机来解决单个节点（计算机）无法处理的存储、计算问题，这是非常典型的分而治之的思想。每个节点只负责原问题（即整个系统需要完成的任务）的一个子集，那么原问题如何拆分到多个节点？在分布式存储系统中，任务的拆分即数据分片。</p>\n<p>何为数据分片（segment，fragment， shard， partition），就是按照一定的规则，将数据集划分成相互独立、正交的数据子集，然后将数据子集分布到不同的节点上。注意，这里提到，数据分片需要按照一定的规则，不同的分布式应用有不同的规则，但都遵循同样的原则：按照最主要、最频繁使用的访问方式来分片。</p>\n<h1>三种数据分片方式</h1>\n<div>　　首先介绍三种分片方式：hash方式，一致性hash（consistent hash），按照数据范围（range based）。对于任何方式，都需要思考以下几个问题：</div>\n<div>\n<ol>\n<li>具体如何划分原始数据集？</li>\n<li>当原问题的规模变大的时候，能否通过增加节点来动态适应？</li>\n<li>当某个节点故障的时候，能否将该节点上的任务均衡的分摊到其他节点？</li>\n<li>对于可修改的数据（比如数据库数据），如果某节点数据量变大，能否以及如何将部分数据迁移到其他负载较小的节点，及达到动态均衡的效果？</li>\n<li>元数据的管理（即数据与物理节点的对应关系）规模？元数据更新的频率以及复杂度？</li>\n</ol>\n<p>为了后面分析不同的数据分片方式，假设有三个物理节点，编号为N0， N1， N2；有以下几条记录：</p>\n<p>R0: {id: 95, name: ‘aa’, tag:’older’}<br>\nR1: {id: 302, name: ‘bb’,}<br>\nR2: {id: 759, name: ‘aa’,}<br>\nR3: {id: 607, name: ‘dd’, age: 18}<br>\nR4: {id: 904, name: ‘ff’,}<br>\nR5: {id: 246, name: ‘gg’,}<br>\nR6: {id: 148, name: ‘ff’,}<br>\nR7: {id: 533, name: ‘kk’,}</p>\n</div>\n<h2>hash方式：</h2>\n<p>哈希表（散列表）是最为常见的数据结构，根据记录（或者对象）的关键值将记录映射到表中的一个槽（slot），便于快速访问。绝大多数编程语言都有对hash表的支持，如python中的dict， C++中的map，Java中的Hashtable， Lua中的table等等。在哈希表中，最为简单的散列函数是 mod N（N为表的大小）。即首先将关键值计算出hash值（这里是一个整型），通过对N取余，余数即在表中的位置。</p>\n<p>数据分片的hash方式也是这个思想，即按照数据的某一特征（key）来计算哈希值，并将哈希值与系统中的节点建立映射关系,从而将哈希值不同的数据分布到不同的节点上。</p>\n<p>我们选择id作为数据分片的key，那么各个节点负责的数据如下：</p>\n<div>　　<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/60b1cd0b902642fcd732d92d826bf1d7.png\" alt=\"\" width=\"735\" height=\"173\"></div>\n<p>由此可以看到，按照hash方式做数据分片，映射关系非常简单；需要管理的元数据也非常之少，只需要记录节点的数目以及hash方式就行了。</p>\n<div>　　但hash方式的缺点也非常明显：当加入或者删除一个节点的时候，大量的数据需要移动。比如在这里增加一个节点N3，因此hash方式变为了mod 4，数据的迁移如下：</div>\n<div>　　<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a070c20a578c8728f269a7c5f88a9bc1.png\" alt=\"\"></div>\n<p>在这种方式下，是不满足单调性（Monotonicity）的：如果已经有一些内容通过哈希分派到了相应的缓冲中，又有新的缓冲加入到系统中。哈希的结果应能够保证原有已分配的内容可以被映射到原有的或者新的缓冲中去，而不会被映射到旧的缓冲集合中的其他缓冲区。</p>\n<p>在工程中，为了减少迁移的数据量，节点的数目可以成倍增长，这样概率上来讲至多有50%的数据迁移。</p>\n<div>hash方式还有一个缺点，即很难解决数据不均衡的问题。有两种情况：原始数据的特征值分布不均匀，导致大量的数据集中到一个物理节点上；第二，对于可修改的记录数据，单条记录的数据变大。在这两种情况下，都会导致节点之间的负载不均衡，而且在hash方式下很难解决。</div>\n<h2>一致性hash</h2>\n<div><a href=\"https://en.wikipedia.org/wiki/Consistent_hashing\" target=\"_blank\">一致性hash</a>是将数据按照特征值映射到一个首尾相接的hash环上，同时也将节点（按照IP地址或者机器名hash）映射到这个环上。对于数据，从数据在环上的位置开始，顺时针找到的第一个节点即为数据的存储节点。这里仍然以上述的数据为例，假设id的范围为［0， 1000］，N0， N1， N2在环上的位置分别是100， 400， 800，那么hash环示意图与数据的分布如下：</div>\n<div style=\"text-align: center;\"> 　　<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/265e3dc723d195313a689e01bc6c542e.png\" alt=\"\">　　<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bba07578f38434571328a37d984025c0.png\" alt=\"\"></div>\n<p>可以看到相比于上述的hash方式，一致性hash方式需要维护的元数据额外包含了节点在环上的位置，但这个数据量也是非常小的。</p>\n<p>一致性hash在增加或者删除节点的时候，受到影响的数据是比较有限的，比如这里增加一个节点N3，其在环上的位置为600，因此，原来N2负责的范围段（400， 800］现在由N2（400， 600] N3(600, 800]负责，因此只需要将记录R2(id:759), R3(id: 607) 从N2,迁移到N3:</p>\n<div>　　不难发现一致性hash方式在增删的时候只会影响到hash环上响应的节点，不会发生大规模的数据迁移。</div>\n<p>但是，一致性hash方式在增加节点的时候，只能分摊一个已存在节点的压力；同样，在其中一个节点挂掉的时候，该节点的压力也会被全部转移到下一个节点。我们希望的是“一方有难，八方支援”，因此需要在增删节点的时候，已存在的所有节点都能参与响应，达到新的均衡状态。</p>\n<p>因此，在实际工程中，一般会引入虚拟节点（virtual node）的概念。即不是将物理节点映射在hash换上，而是将虚拟节点映射到hash环上。虚拟节点的数目远大于物理节点，因此一个物理节点需要负责多个虚拟节点的真实存储。操作数据的时候，先通过hash环找到对应的虚拟节点，再通过虚拟节点与物理节点的映射关系找到对应的物理节点。</p>\n<p>引入虚拟节点后的一致性hash需要维护的元数据也会增加：第一，虚拟节点在hash环上的问题，且虚拟节点的数目又比较多；第二，虚拟节点与物理节点的映射关系。但带来的好处是明显的，当一个物理节点失效是，hash环上多个虚拟节点失效，对应的压力也就会发散到多个其余的虚拟节点，事实上也就是多个其余的物理节点。在增加物理节点的时候同样如此。</p>\n<p>工程中，<a href=\"http://cloudgroup.neu.edu.cn/papers/cloud%20data%20storage/dynamo-sosp-2007.pdf\" target=\"_blank\">Dynamo</a>、<a href=\"https://cassandra.apache.org/%20%20%20%20\" target=\"_blank\">Cassandra</a>都使用了一致性hash算法，且在比较高的版本中都使用了虚拟节点的概念。在这些系统中，需要考虑综合考虑数据分布方式和数据副本，当引入数据副本之后，一致性hash方式也需要做相应的调整， 可以参加cassandra的相关文档。</p>\n<h2>range based</h2>\n<p>简单来说，就是按照关键值划分成不同的区间，每个物理节点负责一个或者多个区间。其实这种方式跟一致性hash有点像，可以理解为物理节点在hash环上的位置是动态变化的。</p>\n<p>还是以上面的数据举例，三个节点的数据区间分别是N0(0, 200]， N1(200, 500]， N2(500, 1000]。那么数据分布如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/97744e5665ed8d8444a5642e0e887714.png\" alt=\"\"></p>\n<p>注意，区间的大小不是固定的，每个数据区间的数据量与区间的大小也是没有关系的。比如说，一部分数据非常集中，那么区间大小应该是比较小的，即以数据量的大小为片段标准。在实际工程中，一个节点往往负责多个区间，每个区间成为一个块（chunk、block），每个块有一个阈值，当达到这个阈值之后就会分裂成两个块。这样做的目的在于当有节点加入的时候，可以快速达到均衡的目的。</p>\n<p>不知道读者有没有发现，如果一个节点负责的数据只有一个区间，range based与没有虚拟节点概念的一致性hash很类似；如果一个节点负责多个区间，range based与有虚拟节点概念的一致性hash很类似。</p>\n<p>range based的元数据管理相对复杂一些，需要记录每个节点的数据区间范围，特别单个节点对于多个区间的情况。而且，在数据可修改的情况下，如果块进行分裂，那么元数据中的区间信息也需要同步修改。</p>\n<p>range based这种数据分片方式应用非常广泛，比如MongoDB, PostgreSQL， HDFS</p>\n<h2>小结：</h2>\n<p>在这里对三种分片方式（应该是四种，有没有virtual node的一致性hash算两种）进行简单总结，主要是针对提出的几个问题：</p>\n<table cellspacing=\"0\" cellpadding=\"2\">\n<colgroup></colgroup>\n<tbody>\n<tr>\n<td></td>\n<td>映射难度</td>\n<td>元数据</td>\n<td>节点增删</td>\n<td>数据动态均衡</td>\n</tr>\n<tr>\n<td>hash方式</td>\n<td>简单</td>\n<td>非常简单，几乎不用修改</td>\n<td>需要迁移的数据比较多</td>\n<td>不支持</td>\n</tr>\n<tr>\n<td>consistent hash<br>\nwithout virtual node</td>\n<td>简单</td>\n<td>比较简单，取决于节点规模，几乎不用修改</td>\n<td>增删节点的时候只影响hash环上相邻节点，但不能使所有节点都参与数据迁移过程</td>\n<td>不支持</td>\n</tr>\n<tr>\n<td>consistent hash<br>\nwith virtual node</td>\n<td>中等</td>\n<td>稍微复杂一些，主要取决于虚拟节点规模，很少修改</td>\n<td>需要迁移的数据比较少，且所有节点都能贡献部分数据</td>\n<td>若支持（修改虚拟节点与物理节点映射关系）</td>\n</tr>\n<tr>\n<td>range based</td>\n<td>较为复杂</td>\n<td>取决于每个块的大小，一般来说规模较大；且修改频率较高</td>\n<td>需要迁移的数据比较少，且所有节点都能贡献部分数据</td>\n<td>支持，且比较容易</td>\n</tr>\n</tbody>\n</table>\n<p>上面的数据动态均衡，值得是上述问题的第4点，即如果某节点数据量变大，能否以及如何将部分数据迁移到其他负载较小的节点</p>\n<h1>分片特征值的选择</h1>\n<p>上面的三种方式都提到了对数据的分片是基于关键值、特征值的。这个特征值在不同的系统中有不同的叫法，比如MongoDB中的<a href=\"https://docs.mongodb.com/manual/core/sharding-shard-key/\" target=\"_blank\">sharding key</a>， Oracle中的<a href=\"https://docs.oracle.com/cd/B28359_01/server.111/b32024/partition.htm\" target=\"_blank\">Partition Key</a>，不管怎么样，这个特征值的选择都是非常非常重要的。</p>\n<p>那么。怎么选择这个特征值呢？《<a href=\"http://book.mixu.net/distsys/intro.html\" target=\"_blank\">Distributed systems for fun and profi</a>t》给出了言简意赅的标准：</p>\n<blockquote><p>　　 based on what you think the primary access pattern will be</p></blockquote>\n<p>大概翻译为：基于最常用的访问模式。访问时包括对数据的增删改查的。比如上面的列子，我们选择“id”作为分片的依据，那么就是默认对的数据增删改查都是通过“id”字段来进行的。</p>\n<p>如果在应用中，大量的数据操作都是通过这个特征值进行，那么数据分片就能提供两个额外的好处：</p>\n<p>（1）提升性能和并发，操作被分发到不同的分片，相互独立</p>\n<p>（2）提升系统的可用性，即使部分分片不能用，其他分片不会受到影响</p>\n<p>如果大量操作并没有使用到特征值，那么就很麻烦了。比如在本文的例子中，如果用name去查询，而元数据记录的是如何根据按照id映射数据位置，那就尴尬了，需要到多有分片都去查一下，然后再做一个聚合！</p>\n<p>另外一个问题，如果以单个字段为特征值（如id），那么不管按照什么分布方式，在多条数据拥有相同的特征值（如id）的情况下，这些数据一定都会分布到同一个节点上。在这种情况下有两个问题，一是不能达到节点间数据的均衡，二是如果数据超过了单个节点的存储能力怎么办？关键在于，即使按照分布式系统解决问题的常规办法 — 增加节点 –也是于事无补的。</p>\n<p>在这个时候，单个字段做特征值就不行了，可能得再增加一个字段作为“联合特征值”，类似数据库中的联合索引。比如，数据是用户的操作日志，可以使用id和时间戳一起作为hash函数的输入，然后算出特征值；但在这种情况下，如果还想以id为查询关键字来查询，那就得遍历所有节点了。</p>\n<p>所以说没有最优的设计，只有最符合应用需求的设计。</p>\n<p>下面以MongoDB中的sharding key为例，解释特征值选择的重要性以及对数据操作的影响。如果有数据库操作基础，即使没有使用过MongoDB，阅读下面的内容应该也没有问题。</p>\n<h2>以MongoDB sharding key为例</h2>\n<p>关于MongoDB Sharded cluster，之前也写过一篇文章《<a href=\"http://www.cnblogs.com/xybaby/p/6832296.html\" target=\"_blank\">通过一步步创建sharded cluster来认识mongodb</a>》，做了简单介绍。在我的工作场景中，除了联合查询（join）和事务，MongoDB的使用和Mysql还是比较相似的，特别是基本的CRUD操作、数据库索引。MongoDb中，每一个分片成为一个shard，分片的特征值成为sharding key，每个数据称之为一个document。选择适合的字段作为shardingkey非常重要，why？</p>\n<p>前面也提到，如果使用非sharding key去访问数据，那么元数据服务器（或者元数据缓存服务器，后面会讲解这一部分）是没法知道对应的数据在哪一个shard上，那么该访问就得发送到所有的shard，得到所有shard的结果之后再做聚合，在mongoDB中，由mongos（缓存有元数据信息）做数据聚合。对于数据读取（R： read or retrieve），通过同一个字段获取到多个数据，是没有问题的，只是效率比较低而已。对于数据更新，如果只能更新一个数据，那么在哪一个shard上更新呢，似乎都不对，这个时候，MongoDB是拒绝的。对应到MongoDB（MongoDD3.0）的命令包括但不限于：</p>\n<ul>\n<li>　　findandmodify：这个命令只能更新一个document，因此查询部分必须包含sharding key</li>\n</ul>\n<blockquote><p>　　When using <code>findAndModify</code> in a sharded environment, the <code>query</code> must contain the shard key for all operations against the shard cluster for the <em>sharded</em> collections.</p></blockquote>\n<ul>\n<li>　　update：这个命令有一个参数multi，默认是false，即只能更新一个document，此时查询部分必须包含sharding key</li>\n</ul>\n<blockquote>\n<div>All <code>update()</code> operations for a sharded collection that specify the <code>multi: false</code> option must include theshard key <em>or</em> the <code>_id</code> field in the query specification.</div>\n</blockquote>\n<ul>\n<li> 　  remove：有一个参数JustOne，如果为True，只能删除一个document，也必须使用sharidng key</li>\n</ul>\n<p>另外，熟悉sql的同学都知道，在数据中索引中有unique index（唯一索引），即保证这个字段的值在table中是唯一的。mongoDB中，也可以建立unique index，但是在sharded cluster环境下，只能对sharding key创建unique index，道理也很简单，如果unique index不是sharidng key，那么插入的时候就得去所有shard上查看，而且还得加锁。</p>\n<p>接下来，讨论分片到shard上的数据不均的问题，如果一段时间内shardkey过于集中（比如按时间增长），那么数据只往一个shard写入，导致无法平衡集群压力。</p>\n<div>　　MongoDB中提供了”<a href=\"https://docs.mongodb.com/manual/core/ranged-sharding/\" target=\"_blank\">range partition</a>“和”<a href=\"https://docs.mongodb.com/manual/core/hashed-sharding/\" target=\"_blank\">hash partition</a>“，<strong>这个跟上面提到的分片方式 hash方式， ranged based不是一回事儿</strong>，而是指对sharding key处理。MongoDB一定是ranged base分片方式,<a href=\"https://docs.mongodb.com/manual/core/sharding-shard-key/\" target=\"_blank\">docuemnt</a>中如是说：</div>\n<blockquote>\n<div>MongoDB <a href=\"https://docs.mongodb.com/manual/reference/glossary/#term-data-partition\">partitions</a> data in the collection using ranges of shard key values. Each range defines a non-overlapping range of shard key values and is associated with a <a href=\"https://docs.mongodb.com/manual/reference/glossary/#term-chunk\">chunk</a>.</div>\n</blockquote>\n<p>那么什么是”range partition”和”hash partition”，官网的一张图很好说明了二者的区别：</p>\n<p style=\"text-align: center;\">　　<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4f75dba562d78dd3cf88e6a0420a83b6.png\" alt=\"\" width=\"496\" height=\"248\">            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/13aa93953848ef771a508070a6e68ee7.png\" alt=\"\" width=\"504\" height=\"252\"></p>\n<p>　　上图左是range partition，右是hash partition。range partition就是使用字段本身作为分片的边界，比如上图的x；而hash partition会将字段重新hash到一个更大、更离散的值域区间。</p>\n<p>hash partition的最大好处在于保证数据在各个节点上均匀分布（这里的均匀指的是在写入的时候就均匀，而不是通过MongoDB的balancing功能）。比如MongoDB中默认的_id是objectid，objectid是一个12个字节的BSON类型，前4个字节是机器的时间戳，那么如果在同一时间大量创建以ObjectId为_id的数据 会分配到同一个shard上，此时若将_id设置为hash index 和 hash sharding key，就不会有这个问题。</p>\n<p>当然，hash  partition相比range partition也有一个很大的缺点，就是范围查询的时候效率低！因此到底选用hash  partition还是range partition还得根据应用场景来具体讨论。</p>\n<p>最后得知道，sharding key一但选定，就无法修改（Immutable）。如果应用必须要修改sharidng key，那么只能将数据导出，新建数据库并创建新的sharding key，最后导入数据。</p>\n<h1>元数据服务器</h1>\n<p>在上面讨论的三种数据分片分式中，或多或少都会记录一些元数据：数据与节点的映射关系、节点状态等等。我们称记录元数据的服务器为元数据服务器（metaserver），不同的系统叫法不一样，比如master、configserver、namenode等。</p>\n<p>元数据服务器就像人类的大脑，一只手不能用了还没忍受，大脑不工作整个人就瘫痪了。因此，元数据服务器的<strong>高性能、高可用</strong>，要达到这两个目标，元数据服务器就得高<strong>可扩展</strong> — 以此应对元数据的增长。</p>\n<p>元数据的高可用要求元数据服务器不能成为故障单点（single point of failure），因此需要元数据服务器有多个备份，并且能够在故障的时候迅速切换。</p>\n<p>有多个备份，那么问题就来了，怎么保证多个备份的数据一致性？</p>\n<p>多个副本的一致性、可用性是CAP理论讨论的范畴，这里简单介绍两种方案。第一种是主从同步，首先选出主服务器，只有主服务器提供对外服务，主服务器将元数据的变革信息以日志的方式持久化到共享存储（例如nfs），然后从服务器从共享存储读取日志并应用，达到与主服务器一致的状态，如果主服务器被检测到故障（比如通过心跳），那么会重新选出新的主服务器。第二种方式，通过分布式一致性协议来达到多个副本件的一致，比如大名鼎鼎的Paxos协议，以及工程中使用较多的Paxos的特化版本 — Raft协议，协议可以实现所有备份均可以提供对外服务，并且保证强一致性。</p>\n<h2>HDFS元数据</h2>\n<p>HDFS中，元数据服务器被称之为namenode，在hdfs1.0之前，namenode还是单点，一旦namenode挂掉，整个系统就无法工作。在hdfs2.0，解决了namenode的单点问题。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/8221eac439b32bd000638097d281c3bb.png\" alt=\"\"></p>\n<p>上图中NN即NameNode， DN即DataNode（即实际存储数据的节点）。从图中可以看到， 两台 NameNode 形成互备，一台处于 Active 状态，为主 NameNode，另外一台处于 Standby 状态，为备 NameNode，<strong>只有主 NameNode 才能对外提供读写服务</strong>。</p>\n<p>Active NN与standby NN之间的数据同步通过共享存储实现，共享存储系统保证了Namenode的高可用。为了保证元数据的强一致性，在进行准备切换的时候，新的Active NN必须要在确认元数据完全同步之后才能继续对外提供服务。</p>\n<p>另外，Namenode的状态监控以及准备切换都是Zookeeper集群负责，在网络分割（network partition）的情况下，有可能zookeeper认为原来的Active NN挂掉了，选举出新的ActiveNN，但实际上原来的Active NN还在继续提供服务。这就导致了“双主“或者脑裂（brain-split）现象。为了解决这个问题，提出了fencing机制，也就是想办法把旧的 Active NameNode 隔离起来，使它不能正常对外提供服务。具体参见<a href=\"https://www.ibm.com/developerworks/cn/opensource/os-cn-hadoop-name-node/\" target=\"_blank\">这篇文章</a>。</p>\n<h2>MongoDB元数据</h2>\n<p>MongoDB中，元数据服务器被称为config server。在MongoDB3.2中，已经不再建议使用三个镜像(Mirrored)MongoDB实例作为config server，而是推荐使用复制集（replica set）作为config server，此举的目的是增强config server的一致性，而且config sever中mongod的数目也能从3个达到replica set的上线（50个节点），从而提高了可靠性。</p>\n<p>在MongoDB3.0及之前的版本中，元数据的读写按照下面的方式进行：</p>\n<blockquote><p>　　When writing to the three config servers, a <strong>coordinator</strong> dispatches the same write commands to the three config servers and collects the results. Differing results indicate an inconsistent writes to the config servers and may require manual intervention.</p></blockquote>\n<p>MongoDB的官方文档并没有详细解释这一过程，不过在<a href=\"https://dba.stackexchange.com/questions/91194/why-does-mongodb-require-three-config-servers\" target=\"_blank\">stackexchange</a>上，有人指出这个过程是两阶段提交。</p>\n<p>MongoDB3.2及之后的版本，使用了replica set config server，在《<a href=\"http://www.cnblogs.com/xybaby/p/6871764.html\" target=\"_blank\">CAP理论与MongoDB一致性、可用性的一些思考</a>》文章中，详细介绍了replica set的write concern、read concern和read references，这三个选项会影响到复制集的一致性、可靠性与读取性能。在config server中，使用了WriteConcern：Majority；ReadConcern：Majority；ReadReferences：nearest。</p>\n<h2>元数据的缓存：</h2>\n<p>即使元数据服务器可以由一组物理机器组成，也保证了副本集之间的一致性问题。但是如果每次对数据的请求都经过元数据服务器的话，元数据服务器的压力也是非常大的。很多应用场景，元数据的变化并不是很频繁，因此可以在访问节点上做缓存，这样应用可以直接利用缓存数据进行数据读写，减轻元数据服务器压力。</p>\n<p>在这个环境下，缓存的元数据必须与元数据服务器上的元数据一致，缓存的元数据必须是准确的，未过时的。相反的例子是DNS之类的缓存，即使使用了过期的DNS缓存也不会有太大的问题。</p>\n<p>怎么达到缓存的强一致性呢？比较容易想到的办法是当metadata变化的时候立即通知所有的缓存服务器（mongos），但问题是通信有延时，不可靠。</p>\n<p>解决不一致的问题，一个比较常见的思路是版本号，比如网络通信，通信协议可能会发生变化，通信双方为了达成一致，那么可以使用版本号。在缓存一致性的问题上，也可以使用版本号，基本思路是请求的时候带上缓存的版本号，路由到具体节点之后比较实际数据的版本号，如果版本号不一致，那么表示缓存信息过旧，此时需要从元数据服务器重新拉取元数据并缓存。在MongoDB中，mongos缓存上就是使用的这种办法。</p>\n<p>另外一种解决办法，就是大名鼎鼎的lease机制 — “An Efficient Fault-Tolerant Mechanism for Distributed File Cache Consistency”，lease机制在分布式系统中使用非常广泛，不仅仅用于分布式缓存，在很多需要达成某种约定的地方都大显身手，在《分布式系统原理介绍》中，对lease机制有较为详细的描述，下面对lease机制进行简单介绍。</p>\n<h2>Lease机制：</h2>\n<p>既然，Lease机制提出的时候是为了解决分布式存储系统中缓存一致性的问题，那么首先来看看Lease机制是怎么保证缓存的强一致性的。<strong>注意</strong>，为了方便后文描述，在本小节中，我们称元数据服务器为服务器，缓存服务器为客户端。</p>\n<p><strong>要点</strong>：</p>\n<ul>\n<li>　　服务器向所有客户端发送缓存数据的同时，颁发一个lease，lease包含一个有限期（即过期时间）</li>\n<li>　　lease的含义是：在这个有效期内，服务器保证元数据不会发生变化</li>\n<li>　　因此客户端在这个有效期内可以放心大胆的使用缓存的元数据，如果超过了有效期，就不能使用数据了，就得去服务器请求。</li>\n<li>　　如果外部请求修改服务器上的元数据（元数据的修改一定在服务器上进行），那么服务器会阻塞修改请求，直到所有已颁发的lease过期，然后修改元数据，并将新的元数据和新的lease发送到客户端</li>\n<li>　　如果元数据没有发生变化，那么服务器也需要在之前已颁发的lease到期之间，重新给客户端颁发新的lease（只有lease，没有数据）</li>\n</ul>\n<p>在Lease论文的标题中，提到了“Fault-Tolerant”，那么lease是怎么做到容错的呢。关键在于，只要服务器一旦发出数据和lease，不关心客户端是否收到数据，只要等待lease过期，就可以修改元数据；另外，lease的有效期通过过期时间（一个时间戳）来标识，因此即使从服务器到客户端的消息延时到达、或者重复发送都是没有关系的。</p>\n<p>不难发现，容错的前提是服务器与客户端的时间要一致。如果服务器的时间比客户端的时间慢，那么客户端收到lease之后很快就过期了，lease机制就发挥不了作用；如果服务器的时间比客户端的时间快，那么就比较危险，因为客户端会在服务器已经开始更新元数据的时候继续使用缓存，工程中，通常将服务器的过期时间设置得比客户端的略大，来解决这个问题。为了保持时间的一致，最好的办法是使用NTP（Network Time Protocol）来保证时钟同步。</p>\n<p>Lease机制的本质是颁发者授予的在某一有效期内的承诺，承诺的范围是非常广泛的：比如上面提到的cache；比如做权限控制，例如当需要做并发控制时，同一时刻只给某一个节点颁发lease，只有持有lease的节点才可以修改数据；比如身份验证，例如在primary-secondary架构中，给节点颁发lease，只有持有lease的节点才具有primary身份；比如节点的状态监测，例如在primary-secondary架构中监测primary是否正常，这个后文再详细介绍。</p>\n<p>工程中，lease机制也有大量的应用：GFS中使用Lease确定Chuck的Primary副本, Lease由Master节点颁发给primary副本，持有Lease的副本成为primary副本。chubby通过paxos协议实现去中心化的选择primary节点，然后Secondary节点向primary节点发送lease，该lease的含义是：“承诺在lease时间内，不选举其他节点成为primary节点”。chubby中，primary节点也会向每个client节点颁发lease。该lease的含义是用来判断client的死活状态，一个client节点只有只有合法的lease，才能与chubby中的primary进行读写操作。</p>\n<h1>总结</h1>\n<p>本文主要介绍分布式系统中的分片相关问题，包括三种分布方式：hash、一致性hash、range based，以及各自的优缺点。分片都是按照一定的特征值来进行，特征值应该从应用的使用场景来选取，并结合MongoDB展示了特征值（mongodb中的sharding key）对数据操作的影响。分片信息（即元数据）需要专门的服务器存储，元数据服务器是分布式存储系统的核心，因此需要提到其可用性和可靠性，为了减轻元数据服务器的压力，分布式系统中，会在其他节点缓存元数据，缓存的元数据由带来了一致性的挑战，由此引入了Lease机制。</p>\n<h1>references</h1>\n<ul>\n<li>刘杰的《分布式系统原理介绍》</li>\n<li><a href=\"http://book.mixu.net/distsys/\" target=\"_blank\">Distributed systems for fun and profit  </a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Consistent_hashing\" target=\"_blank\">Wiki：Consistent_hashing</a></li>\n<li><a href=\"https://www.ibm.com/developerworks/cn/opensource/os-cn-hadoop-name-node/\" target=\"_blank\">Hadoop NameNode 高可用 (High Availability) 实现解析</a></li>\n<li><a href=\"http://www.cnblogs.com/xybaby/p/6871764.html\" target=\"_blank\">CAP理论与MongoDB一致性、可用性的一些思考</a></li>\n<li><a href=\"http://web.eecs.umich.edu/~mosharaf/Readings/Leases.pdf\" target=\"_blank\">Leases: An Efficient Fault-Tolerant Mechanism for Distributed File Cache Consistency</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111716\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111716votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111716\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "02798e0da54694b76c5f84ea9e994105", "praise_num": 1, "tags": "IT技术", "fav_nums": 7, "title": "数据结构中各种树", "comments_num": 2, "create_date": "2017/07/03", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/bc42d6b7087d92bf57edac612206395f.jpg"], "front_image_path": "full/6032d7dc1233f95d17343e58eeaff17e6a49cb23.jpg", "url": "http://blog.jobbole.com/111680/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/maybe2030/p/4732377.html\">Poll的笔记</a>   </div><p>数据结构中有很多树的结构，其中包括二叉树、二叉搜索树、2-3树、红黑树等等。本文中对数据结构中常见的几种树的概念和用途进行了汇总，不求严格精准，但求简单易懂。</p>\n<h1 class=\"First\"><strong>1. 二叉树</strong></h1>\n<p>二叉树是数据结构中一种重要的数据结构，也是树表家族最为基础的结构。</p>\n<p><strong>二叉树的定义：</strong>二叉树的每个结点至多只有二棵子树(不存在度大于2的结点)，二叉树的子树有左右之分，次序不能颠倒。二叉树的第i层至多有2<sup>i-1</sup>个结点；深度为k的二叉树至多有2<sup>k-1</sup>个结点；对任何一棵二叉树T，如果其终端结点数为n<sub>0</sub>，度为2的结点数为n<sub>2</sub>，则n<sub>0</sub>=n<sub>2</sub>+1。</p>\n<p><strong>二叉树的示例</strong>：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/bc42d6b7087d92bf57edac612206395f.jpg\"><img class=\"aligncenter wp-image-111682 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bc42d6b7087d92bf57edac612206395f.jpg\" alt=\"2009050402\" width=\"390\" height=\"312\"></a></p>\n<p><strong>满二叉树和完全二叉树：</strong></p>\n<p>满二叉树：除最后一层无任何子节点外，每一层上的所有结点都有两个子结点。也可以这样理解，除叶子结点外的所有结点均有两个子结点。节点数达到最大值，所有叶子结点必须在同一层上。</p>\n<p>满二叉树的性质：</p>\n<p>1) 一颗树深度为h，最大层数为k，深度与最大层数相同，k=h;</p>\n<p>2) 叶子数为2<sup>h</sup>;</p>\n<p>3) 第k层的结点数是：2<sup>k-1</sup>;</p>\n<p>4) 总结点数是：2<sup>k-1</sup>，且总节点数一定是奇数。</p>\n<p>完全二叉树：若设二叉树的深度为h，除第 h 层外，其它各层 (1～(h-1)层) 的结点数都达到最大个数，第h层所有的结点都连续集中在最左边，这就是完全二叉树。</p>\n<p><strong>注：</strong>完全二叉树是效率很高的数据结构，堆是一种完全二叉树或者近似完全二叉树，所以效率极高，像十分常用的排序算法、Dijkstra算法、Prim算法等都要用堆才能优化，二叉排序树的效率也要借助平衡性来提高，而平衡性基于完全二叉树。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/a5952ec741b60202c7b377bfb8e8f368.png\"><img class=\"aligncenter wp-image-111683 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/a5952ec741b60202c7b377bfb8e8f368.png\" alt=\"141749056837546\" width=\"534\" height=\"180\"></a></p>\n<p><strong>二叉树的性质</strong>：</p>\n<p>1) 在非空二叉树中，第i层的结点总数不超过2<sup>i-1</sup>, i&gt;=1;</p>\n<p>2) 深度为h的二叉树最多有2<sup>h</sup>-1个结点(h&gt;=1)，最少有h个结点;</p>\n<p>3) 对于任意一棵二叉树，如果其叶结点数为N<sub>0</sub>，而度数为2的结点总数为N<sub>2</sub>，则N<sub>0</sub>=N<sub>2</sub>+1;</p>\n<p>4) 具有n个结点的完全二叉树的深度为log<sub>2</sub>(n+1);</p>\n<p>5)有N个结点的完全二叉树各结点如果用顺序方式存储，则结点之间有如下关系：</p>\n<p>若I为结点编号则 如果I&gt;1，则其父结点的编号为I/2；</p>\n<p>如果2I&lt;=N，则其左儿子（即左子树的根结点）的编号为2I；若2I&gt;N，则无左儿子；</p>\n<p>如果2I+1&lt;=N，则其右儿子的结点编号为2I+1；若2I+1&gt;N，则无右儿子。</p>\n<p>6)给定N个节点，能构成h(N)种不同的二叉树，其中h(N)为卡特兰数的第N项，h(n)=C(2*n, n)/(n+1)。</p>\n<p>7)设有i个枝点，I为所有枝点的道路长度总和，J为叶的道路长度总和J=I+2<sup>i</sup>。</p>\n<h1 class=\"First\">2. 二叉查找树</h1>\n<p><strong>二叉查找树定义</strong>：又称为是二叉排序树（Binary Sort Tree）或二叉搜索树。二叉排序树或者是一棵空树，或者是具有下列性质的二叉树：</p>\n<p>1) 若左子树不空，则左子树上所有结点的值均小于它的根结点的值；</p>\n<p>2) 若右子树不空，则右子树上所有结点的值均大于或等于它的根结点的值；</p>\n<p>3) 左、右子树也分别为二叉排序树；</p>\n<p>4) 没有键值相等的节点。</p>\n<p><strong>二叉查找树的性质：</strong><strong>对二叉查找树进行中序遍历，即可得到有序的数列。</strong></p>\n<p><strong>二叉查找树的时间复杂度：<strong>它和二分查找一样，插入和查找的时间复杂度均为O(logn)，<span style=\"color: #ff0000\">但是在最坏的情况下仍然会有O(n)的时间复杂度。</span>原因在于插入和删除元素的时候，树没有保持平衡（比如，我们查找上图（b）中的“93”，我们需要进行n次查找操作）。我们追求的是在最坏的情况下仍然有较好的时间复杂度，这就是平衡查找树设计的初衷。</strong></strong></p>\n<p><span style=\"color: #ff0000\"><strong><strong>二叉查找树的高度决定了二叉查找树的查找效率。</strong></strong></span></p>\n<p><strong>二叉查找树的插入过程如下：</strong></p>\n<p>1) 若当前的二叉查找树为空，则插入的元素为根节点;</p>\n<p>2) 若插入的元素值小于根节点值，则将元素插入到左子树中;</p>\n<p>3) 若插入的元素值不小于根节点值，则将元素插入到右子树中。</p>\n<p><strong>二叉查找树的删除，分三种情况进行处理：</strong></p>\n<p>1) p为叶子节点，直接删除该节点，再修改其父节点的指针（注意分是根节点和不是根节点），如图a;</p>\n<p>2) p为单支节点（即只有左子树或右子树）。让p的子树与p的父亲节点相连，删除p即可（注意分是根节点和不是根节点），如图b;</p>\n<p>3) p的左子树和右子树均不空。找到p的后继y，因为y一定没有左子树，所以可以删除y，并让y的父亲节点成为y的右子树的父亲节点，并用y的值代替p的值；或者方法二是找到p的前驱x，x一定没有右子树，所以可以删除x，并让x的父亲节点成为y的左子树的父亲节点。如图c。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/2361a6d889a036b92d6fa44c8984d27e.png\"><img class=\"aligncenter wp-image-111684 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2361a6d889a036b92d6fa44c8984d27e.png\" alt=\"2012032717571645\" width=\"572\" height=\"205\"></a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/05b0ae29caf51cf3aeb26e30ee6996ec.png\"><img class=\"aligncenter wp-image-111685 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/05b0ae29caf51cf3aeb26e30ee6996ec.png\" alt=\"2012032717583358\" width=\"611\" height=\"210\"></a><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/2c51f44d9bfb87f38f9bf040552b6b31.png\"><img class=\"aligncenter wp-image-111686 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2c51f44d9bfb87f38f9bf040552b6b31.png\" alt=\"2012032717584562\" width=\"553\" height=\"148\"></a></p>\n<p>二叉树相关实现源码：</p>\n<p>插入操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965b441e66a5892427425\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstruct node\r\n{\r\n    int val;\r\n    pnode lchild;\r\n    pnode rchild;\r\n};\r\n\r\npnode BT = NULL;\r\n\r\n\r\n//递归方法插入节点 \r\npnode insert(pnode root, int x)\r\n{\r\n    pnode p = (pnode)malloc(LEN);\r\n    p-&gt;val = x;\r\n    p-&gt;lchild = NULL;\r\n    p-&gt;rchild = NULL;\r\n    if(root == NULL){\r\n        root = p;    \r\n    }    \r\n    else if(x &lt; root-&gt;val){\r\n        root-&gt;lchild = insert(root-&gt;lchild, x);    \r\n    }\r\n    else{\r\n        root-&gt;rchild = insert(root-&gt;rchild, x);    \r\n    }\r\n    return root;\r\n}\r\n\r\n//非递归方法插入节点 \r\nvoid insert_BST(pnode q, int x)\r\n{\r\n    pnode p = (pnode)malloc(LEN);\r\n    p-&gt;val = x;\r\n    p-&gt;lchild = NULL;\r\n    p-&gt;rchild = NULL;\r\n    if(q == NULL){\r\n        BT = p;\r\n        return ;    \r\n    }        \r\n    while(q-&gt;lchild != p &amp;&amp; q-&gt;rchild != p){\r\n        if(x &lt; q-&gt;val){\r\n            if(q-&gt;lchild){\r\n                q = q-&gt;lchild;    \r\n            }    \r\n            else{\r\n                q-&gt;lchild = p;\r\n            }        \r\n        }    \r\n        else{\r\n            if(q-&gt;rchild){\r\n                q = q-&gt;rchild;    \r\n            }    \r\n            else{\r\n                q-&gt;rchild = p;    \r\n            }\r\n        }\r\n    }\r\n    return;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66a5892427425-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66a5892427425-60\">60</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-1\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pnode </span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pnode </span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-8\"><span class=\"crayon-e\">pnode </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-10\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-11\"><span class=\"crayon-c\">//递归方法插入节点 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-12\"><span class=\"crayon-e\">pnode </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">pnode </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-13\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LEN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-28\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-30\"><span class=\"crayon-c\">//非递归方法插入节点 </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-31\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert_BST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-32\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LEN</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-47\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-55\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66a5892427425-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66a5892427425-60\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0073 seconds] -->\r\n<p>删除操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965b441e66b0445865634\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbool delete_BST(pnode p, int x) //返回一个标志，表示是否找到被删元素 \r\n{\r\n    bool find = false;\r\n    pnode q;\r\n    p = BT;\r\n    while(p &amp;&amp; !find){  //寻找被删元素 \r\n        if(x == p-&gt;val){  //找到被删元素 \r\n            find = true;    \r\n        }    \r\n        else if(x &lt; p-&gt;val){ //沿左子树找 \r\n            q = p;\r\n            p = p-&gt;lchild;    \r\n        }\r\n        else{   //沿右子树找 \r\n            q = p;\r\n            p = p-&gt;rchild;    \r\n        }\r\n    }\r\n    if(p == NULL){   //没找到 \r\n        cout &lt;&lt; \"没有找到\" &lt;&lt; x &lt;&lt; endl;    \r\n    }\r\n    \r\n    if(p-&gt;lchild == NULL &amp;&amp; p-&gt;rchild == NULL){  //p为叶子节点 \r\n        if(p == BT){  //p为根节点 \r\n            BT = NULL;    \r\n        }\r\n        else if(q-&gt;lchild == p){   \r\n            q-&gt;lchild = NULL;\r\n        }        \r\n        else{\r\n            q-&gt;rchild = NULL;    \r\n        }\r\n        free(p);  //释放节点p \r\n    }\r\n    else if(p-&gt;lchild == NULL || p-&gt;rchild == NULL){ //p为单支子树 \r\n        if(p == BT){  //p为根节点 \r\n            if(p-&gt;lchild == NULL){\r\n                BT = p-&gt;rchild;    \r\n            }    \r\n            else{\r\n                BT = p-&gt;lchild;    \r\n            }\r\n        }    \r\n        else{\r\n            if(q-&gt;lchild == p &amp;&amp; p-&gt;lchild){ //p是q的左子树且p有左子树 \r\n                q-&gt;lchild = p-&gt;lchild;    //将p的左子树链接到q的左指针上 \r\n            }    \r\n            else if(q-&gt;lchild == p &amp;&amp; p-&gt;rchild){\r\n                q-&gt;lchild = p-&gt;rchild;    \r\n            }\r\n            else if(q-&gt;rchild == p &amp;&amp; p-&gt;lchild){\r\n                q-&gt;rchild = p-&gt;lchild;    \r\n            }\r\n            else{\r\n                q-&gt;rchild = p-&gt;rchild;\r\n            }\r\n        }\r\n        free(p);\r\n    }\r\n    else{ //p的左右子树均不为空 \r\n        pnode t = p;\r\n        pnode s = p-&gt;lchild;  //从p的左子节点开始 \r\n        while(s-&gt;rchild){  //找到p的前驱，即p左子树中值最大的节点 \r\n            t = s;   \r\n            s = s-&gt;rchild;    \r\n        }\r\n        p-&gt;val = s-&gt;val;   //把节点s的值赋给p \r\n        if(t == p){\r\n            p-&gt;lchild = s-&gt;lchild;    \r\n        }    \r\n        else{\r\n            t-&gt;rchild = s-&gt;lchild;    \r\n        }\r\n        free(s); \r\n    }\r\n    return find;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b0445865634-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b0445865634-77\">77</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-1\"><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_BST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//返回一个标志，表示是否找到被删元素 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//寻找被删元素 </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//找到被删元素 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//沿左子树找 </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">//沿右子树找 </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">//没找到 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"没有找到\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endl</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-22\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//p为叶子节点 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//p为根节点 </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//释放节点p </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//p为单支子树 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//p为根节点 </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">BT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//p是q的左子树且p有左子树 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-46\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//将p的左子树链接到q的左指针上 </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-49\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-50\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-55\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">q</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//p的左右子树均不为空 </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//从p的左子节点开始 </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//找到p的前驱，即p左子树中值最大的节点 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-64\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-65\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">//把节点s的值赋给p </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-69\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-72\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">t</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b0445865634-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b0445865634-77\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0120 seconds] -->\r\n<p>查找操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965b441e66b5683353878\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npnode search_BST(pnode p, int x)\r\n{\r\n    bool solve = false;\r\n    while(p &amp;&amp; !solve){\r\n        if(x == p-&gt;val){\r\n            solve = true;    \r\n        }    \r\n        else if(x &lt; p-&gt;val){\r\n            p = p-&gt;lchild;    \r\n        }\r\n        else{\r\n            p = p-&gt;rchild;    \r\n        }\r\n    }\r\n    if(p == NULL){\r\n        cout &lt;&lt; \"没有找到\" &lt;&lt; x &lt;&lt; endl;    \r\n    } \r\n    return p;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b5683353878-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b5683353878-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b5683353878-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b5683353878-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b5683353878-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b5683353878-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b5683353878-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b5683353878-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66b5683353878-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66b5683353878-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-1\"><span class=\"crayon-e\">pnode </span><span class=\"crayon-e\">search_BST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">pnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b5683353878-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">solve</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b5683353878-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">solve</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b5683353878-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">solve</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b5683353878-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b5683353878-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b5683353878-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rchild</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b5683353878-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b5683353878-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"没有找到\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endl</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66b5683353878-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66b5683353878-19\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<h1 class=\"First\">3. 平衡二叉树</h1>\n<p>我们知道，对于一般的二叉搜索树（Binary Search Tree），其期望高度（即为一棵平衡树时）为log<sub>2</sub>n，其各操作的时间复杂度O(log<sub>2</sub>n)同时也由此而决定。但是，在某些极端的情况下（如在插入的序列是有序的时），二叉搜索树将退化成近似链或链，此时，其操作的时间复杂度将退化成线性的，即O(n)。我们可以通过随机化建立二叉搜索树来尽量的避免这种情况，但是在进行了多次的操作之后，由于在删除时，我们总是选择将待删除节点的后继代替它本身，这样就会造成总是右边的节点数目减少，以至于树向左偏沉。这同时也会造成树的平衡性受到破坏，提高它的操作的时间复杂度。于是就有了我们下边介绍的平衡二叉树。</p>\n<p><strong>平衡二叉树定义：</strong>平衡二叉树（Balanced Binary Tree）又被称为AVL树（有别于AVL算法），且具有以下性质：它是一 棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。平衡二叉树的常用算法有红黑树、AVL树等。在平衡二叉搜索树中，我们可以看到，其高度一般都良好地维持在O(log<sub>2</sub>n)，大大降低了操作的时间复杂度。</p>\n<p>最小二叉平衡树的节点的公式如下：</p>\n<p>F(n)=F(n-1)+F(n-2)+1</p>\n<p>这个类似于一个递归的数列，可以参考Fibonacci数列，1是根节点，F(n-1)是左子树的节点数量，F(n-2)是右子树的节点数量。</p>\n<h2 class=\"First\">3.1 平衡查找树之AVL树</h2>\n<p>有关AVL树的具体实现，可以参考<a href=\"http://www.cppblog.com/cxiaojia/archive/2012/08/20/187776.html\" target=\"_blank\">C小加的博客《一步一步写平衡二叉树（AVL）》</a>。</p>\n<p><strong>AVL树定义：</strong>AVL树是最先发明的自平衡二叉查找树。AVL树得名于它的发明者 G.M. Adelson-Velsky 和 E.M. Landis，他们在 1962 年的论文 “An algorithm for the organization of information” 中发表了它。在AVL中任何节点的两个儿子子树的高度最大差别为1，所以它也被称为高度平衡树，n个结点的AVL树最大深度约1.44log<sub>2</sub>n。查找、插入和删除在平均和最坏情况下都是O(logn)。增加和删除可能需要通过一次或多次树旋转来重新平衡这个树。<strong>这个方案很好的解决了二叉查找树退化成链表的问题，把插入，查找，删除的时间复杂度最好情况和最坏情况都维持在O(logN)。但是频繁旋转会使插入和删除牺牲掉O(logN)左右的时间，不过相对二叉查找树来说，时间上稳定了很多。</strong></p>\n<p><strong>AVL树的自平衡操作——旋转：</strong></p>\n<p>AVL树最关键的也是最难的一步操作就是<strong>旋转</strong>。旋转主要是为了实现AVL树在实施了插入和删除操作以后，树重新回到平衡的方法。下面我们重点研究一下AVL树的旋转。</p>\n<p>对于一个平衡的节点，由于任意节点最多有两个儿子，因此高度不平衡时，此节点的两颗子树的高度差2.容易看出，这种不平衡出现在下面四种情况：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/bbc1d195a4adf1a9cc10bb85b0f1c2c6.jpg\"><img class=\"aligncenter wp-image-111687 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bbc1d195a4adf1a9cc10bb85b0f1c2c6.jpg\" alt=\"2012082016021366\" width=\"785\" height=\"306\"></a></p>\n<p>1) 6节点的左子树3节点高度比右子树7节点大2，左子树3节点的左子树1节点高度大于右子树4节点，这种情况成为左左。</p>\n<p>2) 6节点的左子树2节点高度比右子树7节点大2，左子树2节点的左子树1节点高度小于右子树4节点，这种情况成为左右。</p>\n<p>3) 2节点的左子树1节点高度比右子树5节点小2，右子树5节点的左子树3节点高度大于右子树6节点，这种情况成为右左。</p>\n<p>4) 2节点的左子树1节点高度比右子树4节点小2，右子树4节点的左子树3节点高度小于右子树6节点，这种情况成为右右。</p>\n<p>从图2中可以可以看出，1和4两种情况是对称的，这两种情况的旋转算法是一致的，只需要经过一次旋转就可以达到目标，我们称之为单旋转。2和3两种情况也是对称的，这两种情况的旋转算法也是一致的，需要进行两次旋转，我们称之为双旋转。</p>\n<p><strong>单旋转</strong></p>\n<p>单旋转是针对于左左和右右这两种情况的解决方案，这两种情况是对称的，只要解决了左左这种情况，右右就很好办了。图3是左左情况的解决方案，节点k2不满足平衡特性，因为它的左子树k1比右子树Z深2层，而且k1子树中，更深的一层的是k1的左子树X子树，所以属于左左情况。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/61ee0c83b3783cb05eac2ed3528eae3b.jpg\"><img class=\"aligncenter wp-image-111688 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/61ee0c83b3783cb05eac2ed3528eae3b.jpg\" alt=\"avltree35\" width=\"530\" height=\"229\"></a></p>\n<p>为使树恢复平衡，我们把k2变成这棵树的根节点，因为k2大于k1，把k2置于k1的右子树上，而原本在k1右子树的Y大于k1，小于k2，就把Y置于k2的左子树上，这样既满足了二叉查找树的性质，又满足了平衡二叉树的性质。</p>\n<p>这样的操作只需要一部分指针改变，结果我们得到另外一颗二叉查找树，它是一棵AVL树，因为X向上一移动了一层，Y还停留在原来的层面上，Z向下移动了一层。整棵树的新高度和之前没有在左子树上插入的高度相同，插入操作使得X高度长高了。因此，由于这颗子树高度没有变化，所以通往根节点的路径就不需要继续旋转了。</p>\n<p><strong>双旋转</strong></p>\n<p>对于左右和右左这两种情况，单旋转不能使它达到一个平衡状态，要经过两次旋转。双旋转是针对于这两种情况的解决方案，同样的，这样两种情况也是对称的，只要解决了左右这种情况，右左就很好办了。图4是左右情况的解决方案，节点k3不满足平衡特性，因为它的左子树k1比右子树Z深2层，而且k1子树中，更深的一层的是k1的右子树k2子树，所以属于左右情况。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/2ad609dadbff982036a8e32c792436d7.jpg\"><img class=\"aligncenter wp-image-111690 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2ad609dadbff982036a8e32c792436d7.jpg\" alt=\"2012082016534455\" width=\"785\" height=\"247\"></a></p>\n<p>为使树恢复平衡，我们需要进行两步，第一步，把k1作为根，进行一次右右旋转，旋转之后就变成了左左情况，所以第二步再进行一次左左旋转，最后得到了一棵以k2为根的平衡二叉树。</p>\n<p><strong>AVL树实现源码：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965b441e66bd705489607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//AVL树节点信息\r\ntemplate&lt;class T&gt;\r\nclass TreeNode\r\n{\r\n    public:\r\n        TreeNode():lson(NULL),rson(NULL),freq(1),hgt(0){}\r\n        T data;//值\r\n        int hgt;//高度\r\n        unsigned int freq;//频率\r\n        TreeNode* lson;//指向左儿子的地址\r\n        TreeNode* rson;//指向右儿子的地址\r\n};\r\n//AVL树类的属性和方法声明\r\ntemplate&lt;class T&gt;\r\nclass AVLTree\r\n{\r\n    private:\r\n        TreeNode&lt;T&gt;* root;//根节点\r\n        void insertpri(TreeNode&lt;T&gt;* &amp;node,T x);//插入\r\n        TreeNode&lt;T&gt;* findpri(TreeNode&lt;T&gt;* node,T x);//查找\r\n        void insubtree(TreeNode&lt;T&gt;* node);//中序遍历\r\n        void Deletepri(TreeNode&lt;T&gt;* &amp;node,T x);//删除\r\n        int height(TreeNode&lt;T&gt;* node);//求树的高度\r\n        void SingRotateLeft(TreeNode&lt;T&gt;* &amp;k2);//左左情况下的旋转\r\n        void SingRotateRight(TreeNode&lt;T&gt;* &amp;k2);//右右情况下的旋转\r\n        void DoubleRotateLR(TreeNode&lt;T&gt;* &amp;k3);//左右情况下的旋转\r\n        void DoubleRotateRL(TreeNode&lt;T&gt;* &amp;k3);//右左情况下的旋转\r\n        int Max(int cmpa,int cmpb);//求最大值\r\n\r\n    public:\r\n        AVLTree():root(NULL){}\r\n        void insert(T x);//插入接口\r\n        TreeNode&lt;T&gt;* find(T x);//查找接口\r\n        void Delete(T x);//删除接口\r\n        void traversal();//遍历接口\r\n\r\n};\r\n//计算节点的高度\r\ntemplate&lt;class T&gt;\r\nint AVLTree&lt;T&gt;::height(TreeNode&lt;T&gt;* node)\r\n{\r\n    if(node!=NULL)\r\n        return node-&gt;hgt;\r\n    return -1;\r\n}\r\n//求最大值\r\ntemplate&lt;class T&gt;\r\nint AVLTree&lt;T&gt;::Max(int cmpa,int cmpb)\r\n{\r\n    return cmpa&gt;cmpb?cmpa:cmpb;\r\n}\r\n//左左情况下的旋转\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::SingRotateLeft(TreeNode&lt;T&gt;* &amp;k2)\r\n{\r\n    TreeNode&lt;T&gt;* k1;\r\n    k1=k2-&gt;lson;\r\n    k2-&gt;lson=k1-&gt;rson;\r\n    k1-&gt;rson=k2;\r\n\r\n    k2-&gt;hgt=Max(height(k2-&gt;lson),height(k2-&gt;rson))+1;\r\n    k1-&gt;hgt=Max(height(k1-&gt;lson),k2-&gt;hgt)+1;\r\n}\r\n//右右情况下的旋转\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::SingRotateRight(TreeNode&lt;T&gt;* &amp;k2)\r\n{\r\n    TreeNode&lt;T&gt;* k1;\r\n    k1=k2-&gt;rson;\r\n    k2-&gt;rson=k1-&gt;lson;\r\n    k1-&gt;lson=k2;\r\n\r\n    k2-&gt;hgt=Max(height(k2-&gt;lson),height(k2-&gt;rson))+1;\r\n    k1-&gt;hgt=Max(height(k1-&gt;rson),k2-&gt;hgt)+1;\r\n}\r\n//左右情况的旋转\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::DoubleRotateLR(TreeNode&lt;T&gt;* &amp;k3)\r\n{\r\n    SingRotateRight(k3-&gt;lson);\r\n    SingRotateLeft(k3);\r\n}\r\n//右左情况的旋转\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::DoubleRotateRL(TreeNode&lt;T&gt;* &amp;k3)\r\n{\r\n    SingRotateLeft(k3-&gt;rson);\r\n    SingRotateRight(k3);\r\n}\r\n//插入\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::insertpri(TreeNode&lt;T&gt;* &amp;node,T x)\r\n{\r\n    if(node==NULL)//如果节点为空,就在此节点处加入x信息\r\n    {\r\n        node=new TreeNode&lt;T&gt;();\r\n        node-&gt;data=x;\r\n        return;\r\n    }\r\n    if(node-&gt;data&gt;x)//如果x小于节点的值,就继续在节点的左子树中插入x\r\n    {\r\n        insertpri(node-&gt;lson,x);\r\n        if(2==height(node-&gt;lson)-height(node-&gt;rson))\r\n            if(x&lt;node-&gt;lson-&gt;data)\r\n                SingRotateLeft(node);\r\n            else\r\n                DoubleRotateLR(node);\r\n    }\r\n    else if(node-&gt;data&lt;x)//如果x大于节点的值,就继续在节点的右子树中插入x\r\n    {\r\n        insertpri(node-&gt;rson,x);\r\n        if(2==height(node-&gt;rson)-height(node-&gt;lson))//如果高度之差为2的话就失去了平衡,需要旋转\r\n            if(x&gt;node-&gt;rson-&gt;data)\r\n                SingRotateRight(node);\r\n            else\r\n                DoubleRotateRL(node);\r\n    }\r\n    else ++(node-&gt;freq);//如果相等,就把频率加1\r\n    node-&gt;hgt=Max(height(node-&gt;lson),height(node-&gt;rson));\r\n}\r\n//插入接口\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::insert(T x)\r\n{\r\n    insertpri(root,x);\r\n}\r\n//查找\r\ntemplate&lt;class T&gt;\r\nTreeNode&lt;T&gt;* AVLTree&lt;T&gt;::findpri(TreeNode&lt;T&gt;* node,T x)\r\n{\r\n    if(node==NULL)//如果节点为空说明没找到,返回NULL\r\n    {\r\n        return NULL;\r\n    }\r\n    if(node-&gt;data&gt;x)//如果x小于节点的值,就继续在节点的左子树中查找x\r\n    {\r\n        return findpri(node-&gt;lson,x);\r\n    }\r\n    else if(node-&gt;data&lt;x)//如果x大于节点的值,就继续在节点的左子树中查找x\r\n    {\r\n        return findpri(node-&gt;rson,x);\r\n    }\r\n    else return node;//如果相等,就找到了此节点\r\n}\r\n//查找接口\r\ntemplate&lt;class T&gt;\r\nTreeNode&lt;T&gt;* AVLTree&lt;T&gt;::find(T x)\r\n{\r\n    return findpri(root,x);\r\n}\r\n//删除\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::Deletepri(TreeNode&lt;T&gt;* &amp;node,T x)\r\n{\r\n    if(node==NULL) return ;//没有找到值是x的节点\r\n    if(x &lt; node-&gt;data)\r\n    {\r\n         Deletepri(node-&gt;lson,x);//如果x小于节点的值,就继续在节点的左子树中删除x\r\n         if(2==height(node-&gt;rson)-height(node-&gt;lson))\r\n            if(node-&gt;rson-&gt;lson!=NULL&amp;&amp;(height(node-&gt;rson-&gt;lson)&gt;height(node-&gt;rson-&gt;rson)) )\r\n                DoubleRotateRL(node);\r\n            else\r\n                SingRotateRight(node);\r\n    }\r\n\r\n    else if(x &gt; node-&gt;data)\r\n    {\r\n         Deletepri(node-&gt;rson,x);//如果x大于节点的值,就继续在节点的右子树中删除x\r\n         if(2==height(node-&gt;lson)-height(node-&gt;rson))\r\n            if(node-&gt;lson-&gt;rson!=NULL&amp;&amp; (height(node-&gt;lson-&gt;rson)&gt;height(node-&gt;lson-&gt;lson) ))\r\n                DoubleRotateLR(node);\r\n            else\r\n                SingRotateLeft(node);\r\n    }\r\n\r\n    else//如果相等,此节点就是要删除的节点\r\n    {\r\n        if(node-&gt;lson&amp;&amp;node-&gt;rson)//此节点有两个儿子\r\n        {\r\n            TreeNode&lt;T&gt;* temp=node-&gt;rson;//temp指向节点的右儿子\r\n            while(temp-&gt;lson!=NULL) temp=temp-&gt;lson;//找到右子树中值最小的节点\r\n            //把右子树中最小节点的值赋值给本节点\r\n            node-&gt;data=temp-&gt;data;\r\n            node-&gt;freq=temp-&gt;freq;\r\n            Deletepri(node-&gt;rson,temp-&gt;data);//删除右子树中最小值的节点\r\n            if(2==height(node-&gt;lson)-height(node-&gt;rson))\r\n            {\r\n                if(node-&gt;lson-&gt;rson!=NULL&amp;&amp; (height(node-&gt;lson-&gt;rson)&gt;height(node-&gt;lson-&gt;lson) ))\r\n                    DoubleRotateLR(node);\r\n                else\r\n                    SingRotateLeft(node);\r\n            }\r\n        }\r\n        else//此节点有1个或0个儿子\r\n        {\r\n            TreeNode&lt;T&gt;* temp=node;\r\n            if(node-&gt;lson==NULL)//有右儿子或者没有儿子\r\n            node=node-&gt;rson;\r\n            else if(node-&gt;rson==NULL)//有左儿子\r\n            node=node-&gt;lson;\r\n            delete(temp);\r\n            temp=NULL;\r\n        }\r\n    }\r\n    if(node==NULL) return;\r\n    node-&gt;hgt=Max(height(node-&gt;lson),height(node-&gt;rson))+1;\r\n    return;\r\n}\r\n//删除接口\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::Delete(T x)\r\n{\r\n    Deletepri(root,x);\r\n}\r\n//中序遍历函数\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::insubtree(TreeNode&lt;T&gt;* node)\r\n{\r\n    if(node==NULL) return;\r\n    insubtree(node-&gt;lson);//先遍历左子树\r\n    cout&lt;&lt;node-&gt;data&lt;&lt;\" \";//输出根节点\r\n    insubtree(node-&gt;rson);//再遍历右子树\r\n}\r\n//中序遍历接口\r\ntemplate&lt;class T&gt;\r\nvoid AVLTree&lt;T&gt;::traversal()\r\n{\r\n    insubtree(root);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66bd705489607-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66bd705489607-229\">229</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-1\"><span class=\"crayon-c\">//AVL树节点信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-2\"><span class=\"crayon-e\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TreeNode</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">TreeNode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">lson</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">rson</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">freq</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">hgt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hgt</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//高度</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//频率</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">TreeNode*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//指向左儿子的地址</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">TreeNode*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//指向右儿子的地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-12\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-13\"><span class=\"crayon-c\">//AVL树类的属性和方法声明</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-14\"><span class=\"crayon-e\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-15\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AVLTree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-16\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//根节点</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//插入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//查找</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//中序遍历</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//删除</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//求树的高度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//左左情况下的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//右右情况下的旋转</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//左右情况下的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DoubleRotateRL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//右左情况下的旋转</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpa</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//求最大值</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">AVLTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">root</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//插入接口</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//查找接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//删除接口</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">traversal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//遍历接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-36\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-37\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-38\"><span class=\"crayon-c\">//计算节点的高度</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-39\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-40\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-41\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-45\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-46\"><span class=\"crayon-c\">//求最大值</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-47\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-48\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpa</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-49\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmpa</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">cmpb</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">cmpa</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">cmpb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-51\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-52\"><span class=\"crayon-c\">//左左情况下的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-53\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-54\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-55\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-60\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-63\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-64\"><span class=\"crayon-c\">//右右情况下的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-65\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-66\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-67\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-72\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k1</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">k2</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-75\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-76\"><span class=\"crayon-c\">//左右情况的旋转</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-77\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-78\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-79\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k3</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-82\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-83\"><span class=\"crayon-c\">//右左情况的旋转</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-84\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-85\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">DoubleRotateRL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-86\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-87\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k3</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-89\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-90\"><span class=\"crayon-c\">//插入</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-91\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-92\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-93\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-94\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果节点为空,就在此节点处加入x信息</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-96\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-97\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-98\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-99\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-100\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果x小于节点的值,就继续在节点的左子树中插入x</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-101\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-102\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-103\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-104\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-105\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-106\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-107\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-108\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-109\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果x大于节点的值,就继续在节点的右子树中插入x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-110\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果高度之差为2的话就失去了平衡,需要旋转</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-113\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-114\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-115\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-116\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">DoubleRotateRL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-117\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-118\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//如果相等,就把频率加1</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-119\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-120\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-121\"><span class=\"crayon-c\">//插入接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-122\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-123\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-124\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-125\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">insertpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-126\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-127\"><span class=\"crayon-c\">//查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-128\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-129\"><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-130\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-131\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果节点为空说明没找到,返回NULL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-132\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-133\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-134\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-135\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果x小于节点的值,就继续在节点的左子树中查找x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-136\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-137\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-138\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-139\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//如果x大于节点的值,就继续在节点的左子树中查找x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-140\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-141\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-142\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-143\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//如果相等,就找到了此节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-144\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-145\"><span class=\"crayon-c\">//查找接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-146\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-147\"><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-148\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-149\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">findpri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-150\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-151\"><span class=\"crayon-c\">//删除</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-152\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-153\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-154\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-155\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//没有找到值是x的节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-156\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-157\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-158\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//如果x小于节点的值,就继续在节点的左子树中删除x</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-159\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-160\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-161\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">DoubleRotateRL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-162\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-163\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">SingRotateRight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-164\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-165\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-166\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-167\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-168\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//如果x大于节点的值,就继续在节点的右子树中删除x</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-169\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-170\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-171\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-172\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-173\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-174\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-175\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-176\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-c\">//如果相等,此节点就是要删除的节点</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-177\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-178\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//此节点有两个儿子</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-179\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-180\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//temp指向节点的右儿子</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-181\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//找到右子树中值最小的节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//把右子树中最小节点的值赋值给本节点</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-183\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-184\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">freq</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">freq</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-185\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//删除右子树中最小值的节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-186\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">==</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-187\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-188\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">!=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-189\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">DoubleRotateLR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-190\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-191\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">SingRotateLeft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-192\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-193\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-194\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-c\">//此节点有1个或0个儿子</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-195\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-196\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-197\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//有右儿子或者没有儿子</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-198\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">//有左儿子</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-200\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-201\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-202\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">temp</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-203\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-204\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-205\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-206\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">hgt</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">height</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-207\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-208\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-209\"><span class=\"crayon-c\">//删除接口</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-210\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-211\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-212\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-213\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Deletepri</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-214\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-215\"><span class=\"crayon-c\">//中序遍历函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-216\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-217\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TreeNode</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-218\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-219\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">==</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//先遍历左子树</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-221\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cout</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//输出根节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-222\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rson</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//再遍历右子树</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-223\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-224\"><span class=\"crayon-c\">//中序遍历接口</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-225\"><span class=\"crayon-v\">template</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-226\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AVLTree</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">traversal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-227\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66bd705489607-228\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">insubtree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66bd705489607-229\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0336 seconds] -->\r\n<p></p>\n<h2 class=\"First\">3.2 平衡二叉树之红黑树</h2>\n<p><strong>红黑树的定义：</strong>红黑树是一种自平衡二叉查找树，是在计算机科学中用到的一种数据结构，典型的用途是实现关联数组。它是在1972年由鲁道夫·贝尔发明的，称之为”对称二叉B树”，它现代的名字是在 Leo J. Guibas 和 Robert Sedgewick 于1978年写的一篇论文中获得的。<strong>它是复杂的，但它的操作有着良好的最坏情况运行时间，并且在实践中是高效的: 它可以在O(logn)时间内做查找，插入和删除，这里的n是树中元素的数目。</strong></p>\n<p>红黑树和AVL树一样都对插入时间、删除时间和查找时间提供了最好可能的最坏情况担保。这不只是使它们在时间敏感的应用如实时应用（real time application）中有价值，而且使它们有在提供最坏情况担保的其他数据结构中作为建造板块的价值；例如，在计算几何中使用的很多数据结构都可以基于红黑树。此外，红黑树还是2-3-4树的一种等同，它们的思想是一样的，只不过红黑树是2-3-4树用二叉树的形式表示的。</p>\n<p><strong>红黑树的性质：</strong></p>\n<p>红黑树是每个节点都带有颜色属性的二叉查找树，颜色为红色或黑色。在二叉查找树强制的一般要求以外，对于任何有效的红黑树我们增加了如下的额外要求:</p>\n<p>性质1. 节点是红色或黑色。</p>\n<p>性质2. 根是黑色。</p>\n<p>性质3. 所有叶子都是黑色（叶子是NIL节点）。</p>\n<p>性质4. 每个红色节点必须有两个黑色的子节点。(从每个叶子到根的所有路径上不能有两个连续的红色节点。)</p>\n<p>性质5. 从任一节点到其每个叶子的所有简单路径都包含相同数目的黑色节点。</p>\n<p>下面是一个具体的红黑树的图例：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9fd5e683147961431e0ecfcffbe5805b.png\"><img class=\"aligncenter wp-image-111691 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9fd5e683147961431e0ecfcffbe5805b.png\" alt=\"450px-Red-black_tree_example.svg\" width=\"450\" height=\"217\"></a></p>\n<p>这些约束确保了红黑树的关键特性: 从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。结果是这个树大致上是平衡的。因为操作比如插入、删除和查找某个值的最坏情况时间都要求与树的高度成比例，这个在高度上的理论上限允许红黑树在最坏情况下都是高效的，而不同于普通的二叉查找树。</p>\n<p>要知道为什么这些性质确保了这个结果，注意到性质4导致了路径不能有两个毗连的红色节点就足够了。最短的可能路径都是黑色节点，最长的可能路径有交替的红色和黑色节点。因为根据性质5所有最长的路径都有相同数目的黑色节点，这就表明了没有路径能多于任何其他路径的两倍长。</p>\n<p>以下内容整理自<a href=\"https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91\" target=\"_blank\">wiki百科之红黑树</a>。</p>\n<p><strong>红黑树的自平衡操作：</strong></p>\n<p>因为每一个红黑树也是一个特化的二叉查找树，因此红黑树上的只读操作与普通二叉查找树上的只读操作相同。然而，在红黑树上进行插入操作和删除操作会导致不再符合红黑树的性质。恢复红黑树的性质需要少量(O(logn))的颜色变更(实际是非常快速的)和不超过三次树旋转(对于插入操作是两次)。虽然插入和删除很复杂，但操作时间仍可以保持为O(logn) 次。</p>\n<p><strong>我们首先以二叉查找树的方法增加节点并标记它为红色。如果设为黑色，就会导致根到叶子的路径上有一条路上，多一个额外的黑节点，这个是很难调整的（违背性质5）。</strong>但是设为红色节点后，可能会导致出现两个连续红色节点的冲突，那么可以通过颜色调换（color flips）和树旋转来调整。下面要进行什么操作取决于其他临近节点的颜色。同人类的家族树中一样，我们将使用术语叔父节点来指一个节点的父节点的兄弟节点。注意:</p>\n<ul>\n<li>性质1和性质3总是保持着。</li>\n<li>性质4只在增加红色节点、重绘黑色节点为红色，或做旋转时受到威胁。</li>\n<li>性质5只在增加黑色节点、重绘红色节点为黑色，或做旋转时受到威胁。</li>\n</ul>\n<p><strong>插入操作：</strong></p>\n<p>假设，将要插入的节点标为<strong>N</strong>，N的父节点标为<strong>P</strong>，N的祖父节点标为<strong>G</strong>，N的叔父节点标为<strong>U</strong>。在图中展示的任何颜色要么是由它所处情形这些所作的假定，要么是假定所暗含的。</p>\n<p><strong>情形1: </strong>该树为空树，直接插入根结点的位置，违反性质1，把节点颜色有红改为黑即可。</p>\n<p><strong>情形2:</strong> 插入节点N的父节点P为黑色，不违反任何性质，无需做任何修改。在这种情形下，树仍是有效的。性质5也未受到威胁，尽管新节点N有两个黑色叶子子节点；但由于新节点N是红色，通过它的每个子节点的路径就都有同通过它所取代的黑色的叶子的路径同样数目的黑色节点，所以依然满足这个性质。</p>\n<p>注： 情形1很简单，情形2中P为黑色，一切安然无事，但P为红就不一样了，下边是P为红的各种情况，也是真正难懂的地方。</p>\n<p><strong>情形3: </strong>如果父节点P和叔父节点U二者都是红色，(此时新插入节点N做为P的左子节点或右子节点都属于情形3,这里右图仅显示N做为P左子的情形)则我们可以将它们两个重绘为黑色并重绘祖父节点G为红色(用来保持性质4)。现在我们的新节点N有了一个黑色的父节点P。因为通过父节点P或叔父节点U的任何路径都必定通过祖父节点G，在这些路径上的黑节点数目没有改变。但是，红色的祖父节点G的父节点也有可能是红色的，这就违反了性质4。为了解决这个问题，我们在祖父节点G上递归地进行上述情形的整个过程（把G当成是新加入的节点进行各种情形的检查）。比如，G为根节点，那我们就直接将G变为黑色（情形1）；如果G不是根节点，而它的父节点为黑色，那符合所有的性质，直接插入即可（情形2）；如果G不是根节点，而它的父节点为红色，则递归上述过程（情形3）。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/dc3747336812e9055f958c56ade89eb8.png\"><img class=\"aligncenter wp-image-111692 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dc3747336812e9055f958c56ade89eb8.png\" alt=\"2011120116425251\" width=\"300\" height=\"139\"></a></p>\n<p><strong>情形4:</strong> 父节点P是红色而叔父节点U是黑色或缺少，新节点N是其父节点的左子节点，而父节点P又是其父节点G的左子节点。在这种情形下，我们进行针对祖父节点G的一次右旋转; 在旋转产生的树中，以前的父节点P现在是新节点N和以前的祖父节点G的父节点。我们知道以前的祖父节点G是黑色，否则父节点P就不可能是红色(如果P和G都是红色就违反了性质4，所以G必须是黑色)。我们切换以前的父节点P和祖父节点G的颜色，结果的树满足性质4。性质5也仍然保持满足，因为通过这三个节点中任何一个的所有路径以前都通过祖父节点G，现在它们都通过以前的父节点P。在各自的情形下，这都是三个节点中唯一的黑色节点。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/4986c959603100e41cba2669d9e3ce0c.png\"><img class=\"aligncenter wp-image-111693 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4986c959603100e41cba2669d9e3ce0c.png\" alt=\"Red-black_tree_insert_case_5\" width=\"310\" height=\"138\"></a></p>\n<p><strong>情形5:</strong> 父节点P是红色而叔父节点U是黑色或缺少，并且新节点N是其父节点P的右子节点而父节点P又是其父节点的左子节点。在这种情形下，我们进行一次左旋转调换新节点和其父节点的角色; 接着，我们按<strong>情形4</strong>处理以前的父节点P以解决仍然失效的性质4。注意这个改变会导致某些路径通过它们以前不通过的新节点N（比如图中1号叶子节点）或不通过节点P（比如图中3号叶子节点），但由于这两个节点都是红色的，所以性质5仍有效。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9cfbf62dfdefe5891347de95a976758f.png\"><img class=\"aligncenter wp-image-111694 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9cfbf62dfdefe5891347de95a976758f.png\" alt=\"Red-black_tree_insert_case_5\" width=\"283\" height=\"138\"></a></p>\n<p><strong>注: 插入实际上是原地算法，因为上述所有调用都使用了尾部递归。</strong></p>\n<p><strong>删除操作：</strong></p>\n<p><strong>如果需要删除的节点有两个儿子，那么问题可以被转化成删除另一个只有一个儿子的节点的问题</strong>。对于二叉查找树，在删除带有两个非叶子儿子的节点的时候，我们找到要么在它的左子树中的最大元素、要么在它的右子树中的最小元素，并把它的值转移到要删除的节点中。我们接着删除我们从中复制出值的那个节点，它必定有少于两个非叶子的儿子。因为只是复制了一个值，不违反任何性质，这就把问题简化为如何删除最多有一个儿子的节点的问题。它不关心这个节点是最初要删除的节点还是我们从中复制出值的那个节点。</p>\n<p><strong>我们只需要讨论删除只有一个儿子的节点</strong>(如果它两个儿子都为空，即均为叶子，我们任意将其中一个看作它的儿子)。如果我们删除一个红色节点（此时该节点的儿子将都为叶子节点），它的父亲和儿子一定是黑色的。所以我们可以简单的用它的黑色儿子替换它，并不会破坏性质3和性质4。通过被删除节点的所有路径只是少了一个红色节点，这样可以继续保证性质5。另一种简单情况是在被删除节点是黑色而它的儿子是红色的时候。如果只是去除这个黑色节点，用它的红色儿子顶替上来的话，会破坏性质5，但是如果我们重绘它的儿子为黑色，则曾经通过它的所有路径将通过它的黑色儿子，这样可以继续保持性质5。</p>\n<p><strong>需要进一步讨论的是在要删除的节点和它的儿子二者都是黑色的时候</strong>，这是一种复杂的情况。我们首先把要删除的节点替换为它的儿子。出于方便，称呼这个儿子为<strong>N</strong>(在新的位置上)，称呼它的兄弟(它父亲的另一个儿子)为<strong>S</strong>。在下面的示意图中，我们还是使用<strong>P</strong>称呼N的父亲，<strong>S<sub>L</sub></strong>称呼S的左儿子，<strong>S<sub>R</sub></strong>称呼S的右儿子。</p>\n<p>如果N和它初始的父亲是黑色，则删除它的父亲导致通过N的路径都比不通过它的路径少了一个黑色节点。因为这违反了性质5，树需要被重新平衡。有几种情形需要考虑:</p>\n<p><strong>情形1:</strong> N是新的根。在这种情形下，我们就做完了。我们从所有路径去除了一个黑色节点，而新根是黑色的，所以性质都保持着。</p>\n<p><strong>注意</strong>: 在情形2、5和6下，我们假定N是它父亲的左儿子。如果它是右儿子，则在这些情形下的左和右应当对调。</p>\n<p><strong>情形2:</strong> S是红色。在这种情形下我们在N的父亲上做左旋转，把红色兄弟转换成N的祖父，我们接着对调N的父亲和祖父的颜色。完成这两个操作后，尽管所有路径上黑色节点的数目没有改变，但现在N有了一个黑色的兄弟和一个红色的父亲（它的新兄弟是黑色因为它是红色S的一个儿子），所以我们可以接下去按<strong>情形4</strong>、<strong>情形5</strong>或<strong>情形6</strong>来处理。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/ce86b0e24e64c35067f5d087dc4c90ae.png\"><img class=\"aligncenter wp-image-111695 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ce86b0e24e64c35067f5d087dc4c90ae.png\" alt=\"Red-black_tree_insert_case_5\" width=\"298\" height=\"136\"></a></p>\n<p><strong>情形3:</strong> N的父亲、S和S的儿子都是黑色的。在这种情形下，我们简单的重绘S为红色。结果是通过S的所有路径，它们就是以前<em>不</em>通过N的那些路径，都少了一个黑色节点。因为删除N的初始的父亲使通过N的所有路径少了一个黑色节点，这使事情都平衡了起来。但是，通过P的所有路径现在比不通过P的路径少了一个黑色节点，所以仍然违反性质5。要修正这个问题，我们要从<strong>情形1</strong>开始，在P上做重新平衡处理。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/30759b4136b3cd56ba31eb8d06a434d2.png\"><img class=\"aligncenter wp-image-111696 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/30759b4136b3cd56ba31eb8d06a434d2.png\" alt=\"Red-black_tree_insert_case_5\" width=\"313\" height=\"132\"></a></p>\n<p><strong>情形4:</strong> S和S的儿子都是黑色，但是N的父亲是红色。在这种情形下，我们简单的交换N的兄弟和父亲的颜色。这不影响不通过N的路径的黑色节点的数目，但是它在通过N的路径上对黑色节点数目增加了一，添补了在这些路径上删除的黑色节点。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/61bda9c9a89a3f9ea5f01ed990070a39.png\"><img class=\"aligncenter wp-image-111697 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/61bda9c9a89a3f9ea5f01ed990070a39.png\" alt=\"Red-black_tree_insert_case_5\" width=\"313\" height=\"132\"></a></p>\n<p><strong>情形5:</strong> S是黑色，S的左儿子是红色，S的右儿子是黑色，而N是它父亲的左儿子。在这种情形下我们在S上做右旋转，这样S的左儿子成为S的父亲和N的新兄弟。我们接着交换S和它的新父亲的颜色。所有路径仍有同样数目的黑色节点，但是现在N有了一个黑色兄弟，他的右儿子是红色的，所以我们进入了<strong>情形6</strong>。N和它的父亲都不受这个变换的影响。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/9f411d70951995007ad2a59fb747d160.png\"><img class=\"aligncenter wp-image-111698 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9f411d70951995007ad2a59fb747d160.png\" alt=\"Red-black_tree_insert_case_5\" width=\"247\" height=\"133\"></a></p>\n<p> </p>\n<p><strong>情形6:</strong> S是黑色，S的右儿子是红色，而N是它父亲的左儿子。在这种情形下我们在N的父亲上做左旋转，这样S成为N的父亲（P）和S的右儿子的父亲。我们接着交换N的父亲和S的颜色，并使S的右儿子为黑色。子树在它的根上的仍是同样的颜色，所以性质3没有被违反。但是，N现在增加了一个黑色祖先: 要么N的父亲变成黑色，要么它是黑色而S被增加为一个黑色祖父。所以，通过N的路径都增加了一个黑色节点。</p>\n<p>此时，如果一个路径不通过N，则有两种可能性:</p>\n<ul>\n<li>它通过N的新兄弟。那么它以前和现在都必定通过S和N的父亲，而它们只是交换了颜色。所以路径保持了同样数目的黑色节点。</li>\n<li>它通过N的新叔父，S的右儿子。那么它以前通过S、S的父亲和S的右儿子，但是现在只通过S，它被假定为它以前的父亲的颜色，和S的右儿子，它被从红色改变为黑色。合成效果是这个路径通过了同样数目的黑色节点。</li>\n</ul>\n<p>在任何情况下，在这些路径上的黑色节点数目都没有改变。所以我们恢复了性质4。在示意图中的白色节点可以是红色或黑色，但是在变换前后都必须指定相同的颜色。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/c0ea423eef5e175e0ba92e43ad17270d.png\"><img class=\"aligncenter wp-image-111699 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c0ea423eef5e175e0ba92e43ad17270d.png\" alt=\"Red-black_tree_insert_case_5\" width=\"299\" height=\"143\"></a></p>\n<p><strong>红黑树实现源码：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965b441e66cf452511187\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define BLACK 1\r\n#define RED 0\r\n\r\nusing namespace std;\r\n\r\nclass bst {\r\nprivate:\r\n\r\n    struct Node {\r\n        int value;\r\n        bool color;\r\n        Node *leftTree, *rightTree, *parent;\r\n\r\n        Node() {\r\n            color = RED;\r\n            leftTree = NULL;\r\n            rightTree = NULL;\r\n            parent = NULL;\r\n            value = 0;\r\n        }\r\n\r\n        Node* grandparent() {\r\n            if (parent == NULL) {\r\n                return NULL;\r\n            }\r\n            return parent-&gt;parent;\r\n        }\r\n\r\n        Node* uncle() {\r\n            if (grandparent() == NULL) {\r\n                return NULL;\r\n            }\r\n            if (parent == grandparent()-&gt;rightTree)\r\n                return grandparent()-&gt;leftTree;\r\n            else\r\n                return grandparent()-&gt;rightTree;\r\n        }\r\n\r\n        Node* sibling() {\r\n            if (parent-&gt;leftTree == this)\r\n                return parent-&gt;rightTree;\r\n            else\r\n                return parent-&gt;leftTree;\r\n        }\r\n    };\r\n\r\n    void rotate_right(Node *p) {\r\n        Node *gp = p-&gt;grandparent();\r\n        Node *fa = p-&gt;parent;\r\n        Node *y = p-&gt;rightTree;\r\n\r\n        fa-&gt;leftTree = y;\r\n\r\n        if (y != NIL)\r\n            y-&gt;parent = fa;\r\n        p-&gt;rightTree = fa;\r\n        fa-&gt;parent = p;\r\n\r\n        if (root == fa)\r\n            root = p;\r\n        p-&gt;parent = gp;\r\n\r\n        if (gp != NULL) {\r\n            if (gp-&gt;leftTree == fa)\r\n                gp-&gt;leftTree = p;\r\n            else\r\n                gp-&gt;rightTree = p;\r\n        }\r\n\r\n    }\r\n\r\n    void rotate_left(Node *p) {\r\n        if (p-&gt;parent == NULL) {\r\n            root = p;\r\n            return;\r\n        }\r\n        Node *gp = p-&gt;grandparent();\r\n        Node *fa = p-&gt;parent;\r\n        Node *y = p-&gt;leftTree;\r\n\r\n        fa-&gt;rightTree = y;\r\n\r\n        if (y != NIL)\r\n            y-&gt;parent = fa;\r\n        p-&gt;leftTree = fa;\r\n        fa-&gt;parent = p;\r\n\r\n        if (root == fa)\r\n            root = p;\r\n        p-&gt;parent = gp;\r\n\r\n        if (gp != NULL) {\r\n            if (gp-&gt;leftTree == fa)\r\n                gp-&gt;leftTree = p;\r\n            else\r\n                gp-&gt;rightTree = p;\r\n        }\r\n    }\r\n\r\n    void inorder(Node *p) {\r\n        if (p == NIL)\r\n            return;\r\n\r\n        if (p-&gt;leftTree)\r\n            inorder(p-&gt;leftTree);\r\n\r\n        cout &lt;&lt; p-&gt;value &lt;&lt; \" \";\r\n                \r\n        if (p-&gt;rightTree)\r\n            inorder(p-&gt;rightTree);\r\n    }\r\n\r\n    string outputColor(bool color) {\r\n        return color ? \"BLACK\" : \"RED\";\r\n    }\r\n\r\n    Node* getSmallestChild(Node *p) {\r\n        if (p-&gt;leftTree == NIL)\r\n            return p;\r\n        return getSmallestChild(p-&gt;leftTree);\r\n    }\r\n\r\n    bool delete_child(Node *p, int data) {\r\n        if (p-&gt;value &gt; data) {\r\n            if (p-&gt;leftTree == NIL) {\r\n                return false;\r\n            }\r\n            return delete_child(p-&gt;leftTree, data);\r\n        } else if (p-&gt;value &lt; data) {\r\n            if (p-&gt;rightTree == NIL) {\r\n                return false;\r\n            }\r\n            return delete_child(p-&gt;rightTree, data);\r\n        } else if (p-&gt;value == data) {\r\n            if (p-&gt;rightTree == NIL) {\r\n                delete_one_child(p);\r\n                return true;\r\n            }\r\n            Node *smallest = getSmallestChild(p-&gt;rightTree);\r\n            swap(p-&gt;value, smallest-&gt;value);\r\n            delete_one_child(smallest);\r\n\r\n            return true;\r\n        }\r\n    }\r\n\r\n    void delete_one_child(Node *p) {\r\n        Node *child = p-&gt;leftTree == NIL ? p-&gt;rightTree : p-&gt;leftTree;\r\n        if (p-&gt;parent == NULL &amp;&amp; p-&gt;leftTree == NIL &amp;&amp; p-&gt;rightTree == NIL) {\r\n            p = NULL;\r\n            root = p;\r\n            return;\r\n        }\r\n        \r\n        if (p-&gt;parent == NULL) {\r\n            delete  p;\r\n            child-&gt;parent = NULL;\r\n            root = child;\r\n            root-&gt;color = BLACK;\r\n            return;\r\n        }\r\n        \r\n        if (p-&gt;parent-&gt;leftTree == p) {\r\n            p-&gt;parent-&gt;leftTree = child;\r\n        } else {\r\n            p-&gt;parent-&gt;rightTree = child;\r\n        }\r\n        child-&gt;parent = p-&gt;parent;\r\n\r\n        if (p-&gt;color == BLACK) {\r\n            if (child-&gt;color == RED) {\r\n                child-&gt;color = BLACK;\r\n            } else\r\n                delete_case(child);\r\n        }\r\n\r\n        delete p;\r\n    }\r\n\r\n    void delete_case(Node *p) {\r\n        if (p-&gt;parent == NULL) {\r\n            p-&gt;color = BLACK;\r\n            return;\r\n        }\r\n        if (p-&gt;sibling()-&gt;color == RED) {\r\n            p-&gt;parent-&gt;color = RED;\r\n            p-&gt;sibling()-&gt;color = BLACK;\r\n            if (p == p-&gt;parent-&gt;leftTree)\r\n                rotate_left(p-&gt;sibling());\r\n            else\r\n                rotate_right(p-&gt;sibling());\r\n        }\r\n        if (p-&gt;parent-&gt;color == BLACK &amp;&amp; p-&gt;sibling()-&gt;color == BLACK\r\n                &amp;&amp; p-&gt;sibling()-&gt;leftTree-&gt;color == BLACK &amp;&amp; p-&gt;sibling()-&gt;rightTree-&gt;color == BLACK) {\r\n            p-&gt;sibling()-&gt;color = RED;\r\n            delete_case(p-&gt;parent);\r\n        } else if (p-&gt;parent-&gt;color == RED &amp;&amp; p-&gt;sibling()-&gt;color == BLACK\r\n                &amp;&amp; p-&gt;sibling()-&gt;leftTree-&gt;color == BLACK &amp;&amp; p-&gt;sibling()-&gt;rightTree-&gt;color == BLACK) {\r\n            p-&gt;sibling()-&gt;color = RED;\r\n            p-&gt;parent-&gt;color = BLACK;\r\n        } else {\r\n            if (p-&gt;sibling()-&gt;color == BLACK) {\r\n                if (p == p-&gt;parent-&gt;leftTree &amp;&amp; p-&gt;sibling()-&gt;leftTree-&gt;color == RED\r\n                        &amp;&amp; p-&gt;sibling()-&gt;rightTree-&gt;color == BLACK) {\r\n                    p-&gt;sibling()-&gt;color = RED;\r\n                    p-&gt;sibling()-&gt;leftTree-&gt;color = BLACK;\r\n                    rotate_right(p-&gt;sibling()-&gt;leftTree);\r\n                } else if (p == p-&gt;parent-&gt;rightTree &amp;&amp; p-&gt;sibling()-&gt;leftTree-&gt;color == BLACK\r\n                        &amp;&amp; p-&gt;sibling()-&gt;rightTree-&gt;color == RED) {\r\n                    p-&gt;sibling()-&gt;color = RED;\r\n                    p-&gt;sibling()-&gt;rightTree-&gt;color = BLACK;\r\n                    rotate_left(p-&gt;sibling()-&gt;rightTree);\r\n                }\r\n            }\r\n            p-&gt;sibling()-&gt;color = p-&gt;parent-&gt;color;\r\n            p-&gt;parent-&gt;color = BLACK;\r\n            if (p == p-&gt;parent-&gt;leftTree) {\r\n                p-&gt;sibling()-&gt;rightTree-&gt;color = BLACK;\r\n                rotate_left(p-&gt;sibling());\r\n            } else {\r\n                p-&gt;sibling()-&gt;leftTree-&gt;color = BLACK;\r\n                rotate_right(p-&gt;sibling());\r\n            }\r\n        }\r\n    }\r\n\r\n    void insert(Node *p, int data) {\r\n        if (p-&gt;value &gt;= data) {\r\n            if (p-&gt;leftTree != NIL)\r\n                insert(p-&gt;leftTree, data);\r\n            else {\r\n                Node *tmp = new Node();\r\n                tmp-&gt;value = data;\r\n                tmp-&gt;leftTree = tmp-&gt;rightTree = NIL;\r\n                tmp-&gt;parent = p;\r\n                p-&gt;leftTree = tmp;\r\n                insert_case(tmp);\r\n            }\r\n        } else {\r\n            if (p-&gt;rightTree != NIL)\r\n                insert(p-&gt;rightTree, data);\r\n            else {\r\n                Node *tmp = new Node();\r\n                tmp-&gt;value = data;\r\n                tmp-&gt;leftTree = tmp-&gt;rightTree = NIL;\r\n                tmp-&gt;parent = p;\r\n                p-&gt;rightTree = tmp;\r\n                insert_case(tmp);\r\n            }\r\n        }\r\n    }\r\n\r\n    void insert_case(Node *p) {\r\n        if (p-&gt;parent == NULL) {\r\n            root = p;\r\n            p-&gt;color = BLACK;\r\n            return;\r\n        }\r\n        if (p-&gt;parent-&gt;color == RED) {\r\n            if (p-&gt;uncle()-&gt;color == RED) {\r\n                p-&gt;parent-&gt;color = p-&gt;uncle()-&gt;color = BLACK;\r\n                p-&gt;grandparent()-&gt;color = RED;\r\n                insert_case(p-&gt;grandparent());\r\n            } else {\r\n                if (p-&gt;parent-&gt;rightTree == p &amp;&amp; p-&gt;grandparent()-&gt;leftTree == p-&gt;parent) {\r\n                    rotate_left(p);\r\n                    rotate_right(p);\r\n                    p-&gt;color = BLACK;\r\n                    p-&gt;leftTree-&gt;color = p-&gt;rightTree-&gt;color = RED;\r\n                } else if (p-&gt;parent-&gt;leftTree == p &amp;&amp; p-&gt;grandparent()-&gt;rightTree == p-&gt;parent) {\r\n                    rotate_right(p);\r\n                    rotate_left(p);\r\n                    p-&gt;color = BLACK;\r\n                    p-&gt;leftTree-&gt;color = p-&gt;rightTree-&gt;color = RED;\r\n                } else if (p-&gt;parent-&gt;leftTree == p &amp;&amp; p-&gt;grandparent()-&gt;leftTree == p-&gt;parent) {\r\n                    p-&gt;parent-&gt;color = BLACK;\r\n                    p-&gt;grandparent()-&gt;color = RED;\r\n                    rotate_right(p-&gt;parent);\r\n                } else if (p-&gt;parent-&gt;rightTree == p &amp;&amp; p-&gt;grandparent()-&gt;rightTree == p-&gt;parent) {\r\n                    p-&gt;parent-&gt;color = BLACK;\r\n                    p-&gt;grandparent()-&gt;color = RED;\r\n                    rotate_left(p-&gt;parent);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    void DeleteTree(Node *p) {\r\n        if (!p || p == NIL) {\r\n            return;\r\n        }\r\n        DeleteTree(p-&gt;leftTree);\r\n        DeleteTree(p-&gt;rightTree);\r\n        delete p;\r\n    }\r\npublic:\r\n\r\n    bst() {\r\n        NIL = new Node();\r\n        NIL-&gt;color = BLACK;\r\n        root = NULL;\r\n    }\r\n\r\n    ~bst() {\r\n        if (root)\r\n            DeleteTree(root);\r\n        delete NIL;\r\n    }\r\n\r\n    void inorder() {\r\n        if (root == NULL)\r\n            return;\r\n        inorder(root);\r\n        cout &lt;&lt; endl;\r\n    }\r\n\r\n    void insert(int x) {\r\n        if (root == NULL) {\r\n            root = new Node();\r\n            root-&gt;color = BLACK;\r\n            root-&gt;leftTree = root-&gt;rightTree = NIL;\r\n            root-&gt;value = x;\r\n        } else {\r\n            insert(root, x);\r\n        }\r\n    }\r\n\r\n    bool delete_value(int data) {\r\n        return delete_child(root, data);\r\n    }\r\nprivate:\r\n    Node *root, *NIL;\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-262\">262</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-263\">263</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-264\">264</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-265\">265</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-266\">266</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-267\">267</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-268\">268</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-269\">269</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-270\">270</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-271\">271</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-272\">272</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-273\">273</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-274\">274</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-275\">275</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-276\">276</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-277\">277</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-278\">278</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-279\">279</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-280\">280</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-281\">281</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-282\">282</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-283\">283</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-284\">284</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-285\">285</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-286\">286</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-287\">287</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-288\">288</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-289\">289</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-290\">290</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-291\">291</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-292\">292</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-293\">293</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-294\">294</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-295\">295</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-296\">296</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-297\">297</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-298\">298</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-299\">299</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-300\">300</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-301\">301</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-302\">302</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-303\">303</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-304\">304</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-305\">305</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-306\">306</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-307\">307</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-308\">308</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-309\">309</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-310\">310</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-311\">311</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-312\">312</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-313\">313</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-314\">314</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-315\">315</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-316\">316</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-317\">317</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-318\">318</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-319\">319</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-320\">320</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-321\">321</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-322\">322</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-323\">323</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-324\">324</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-325\">325</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-326\">326</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-327\">327</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-328\">328</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-329\">329</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-330\">330</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-331\">331</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965b441e66cf452511187-332\">332</div><div class=\"crayon-num\" data-line=\"crayon-5965b441e66cf452511187-333\">333</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-1\"><span class=\"crayon-p\">#define BLACK 1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-2\"><span class=\"crayon-p\">#define RED 0</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-4\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bst</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-7\"><span class=\"crayon-m\">private</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-8\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-24\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-28\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uncle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-34\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-36\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-38\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-43\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-46\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">gp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">fa</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fa</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-53\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-55\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fa</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-58\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-60\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-62\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-64\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-65\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-66\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-67\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-71\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-74\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-75\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">gp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-78\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">fa</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-80\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fa</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-82\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-83\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-84\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fa</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-87\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-88\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-89\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-90\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-91\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-93\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fa</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-94\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-95\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-96\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">gp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-97\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-99\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-100\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-101\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-102\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-103\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-104\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-105\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-106\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-107\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-108\"><span class=\"crayon-h\">                </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-109\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-110\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-111\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-112\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-113\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">outputColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-114\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BLACK\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"RED\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-115\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-116\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-117\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">Node*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSmallestChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-118\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-119\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-120\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSmallestChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-121\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-122\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-123\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-125\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-126\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-127\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-128\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-130\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-131\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-132\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-133\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-134\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-135\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-136\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">delete_one_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-137\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-138\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-139\"><span class=\"crayon-h\">            </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">smallest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getSmallestChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-140\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">smallest</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-141\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">delete_one_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">smallest</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-142\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-143\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-144\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-145\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-146\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-147\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_one_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">NIL</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-149\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-150\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-151\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-152\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-153\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-154\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-155\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-156\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">delete</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-157\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-158\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-159\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-160\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-161\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-162\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-163\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-164\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-165\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-166\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-167\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-168\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-169\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-170\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-171\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-172\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">child</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-173\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-174\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">delete_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-175\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-176\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-177\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">delete</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-178\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-179\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-180\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-181\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-183\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-184\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-185\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-186\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-187\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-188\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-189\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-190\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-191\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-192\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-193\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-194\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-195\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-196\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">delete_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-197\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-198\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-200\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-201\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-202\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-203\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-204\"><span class=\"crayon-h\">                        </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-205\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-206\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-207\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-208\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-209\"><span class=\"crayon-h\">                        </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-210\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-211\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-212\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-213\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-214\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-215\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-216\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-217\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-218\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-219\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-220\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-221\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-222\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sibling</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-223\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-224\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-225\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-226\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-227\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-228\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-229\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-230\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-231\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-232\"><span class=\"crayon-h\">                </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-233\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-234\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-235\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-236\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-237\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-238\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-239\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-240\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-241\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-242\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-243\"><span class=\"crayon-h\">                </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-244\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-245\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-246\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-247\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-248\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-249\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-250\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-251\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-252\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-253\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-254\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-255\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-256\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-257\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-258\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-259\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-260\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">uncle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-261\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">uncle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-262\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-263\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">insert_case</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-264\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-265\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-266\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-267\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-268\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-269\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-270\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-271\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-272\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-273\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-274\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-275\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-276\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-277\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-278\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-279\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-280\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-281\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">grandparent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RED</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-282\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">rotate_left</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-r\">parent</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-283\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-284\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-285\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-286\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-287\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-288\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DeleteTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-289\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-290\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-291\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-292\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">DeleteTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-293\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">DeleteTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-294\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">delete</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-295\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-296\"><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-297\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-298\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">bst</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-299\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-300\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-301\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-302\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-303\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-304\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">bst</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-305\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-306\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">DeleteTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-307\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">delete </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-308\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-309\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-310\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-311\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-312\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-313\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">inorder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-314\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endl</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-315\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-316\"> </div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-317\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-318\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-319\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-320\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">color</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BLACK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-321\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">leftTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">rightTree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-322\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">root</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-323\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-324\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-325\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-326\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-327\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-328\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-329\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete_child</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-330\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-331\"><span class=\"crayon-m\">private</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965b441e66cf452511187-332\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">Node *</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">NIL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965b441e66cf452511187-333\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0512 seconds] -->\r\n<p></p>\n<h1 class=\"First\">4. B树</h1>\n<p>B树也是一种用于查找的平衡树，但是它不是二叉树。</p>\n<p><strong>B树的定义：</strong>B树（<span class=\"LangWithName\"><span lang=\"en\" xml:lang=\"en\">B-tree）是一种树状数据结构，能够用来存储排序后的数据。这种数据结构能够让查找数据、循序存取、插入数据及删除的动作，都在对数时间内完成。B树，概括来说是一个一般化的二叉查找树，可以拥有多于2个子节点。与自平衡二叉查找树不同，B-树为系统最优化大块数据的读和写操作。B-tree算法减少定位记录时所经历的中间过程，从而加快存取速度。这种数据结构常被应用在数据库和文件系统的实作上。</span></span></p>\n<p>在B树中查找给定关键字的方法是，首先把根结点取来，在根结点所包含的关键字K1,…,Kn查找给定的关键字（可用顺序查找或二分查找法），若找到等于给定值的关键字，则查找成功；否则，一定可以确定要查找的关键字在Ki与Ki+1之间，Pi为指向子树根节点的指针，此时取指针Pi所指的结点继续查找，直至找到，或指针Pi为空时查找失败。</p>\n<p>B树作为一种多路搜索树（并不是二叉的）：</p>\n<p>1) 定义任意非叶子结点最多只有M个儿子；且M&gt;2；</p>\n<p>2) 根结点的儿子数为[2, M]；</p>\n<p>3) 除根结点以外的非叶子结点的儿子数为[M/2, M]；</p>\n<p>4) 每个结点存放至少M/2-1（取上整）和至多M-1个关键字；（至少2个关键字）</p>\n<p>5) 非叶子结点的关键字个数=指向儿子的指针个数-1；</p>\n<p>6) 非叶子结点的关键字：K[1], K[2], …, K[M-1]；且K[i] &lt; K[i+1]；</p>\n<p>7) 非叶子结点的指针：P[1], P[2], …, P[M]；其中P[1]指向关键字小于K[1]的子树，P[M]指向关键字大于K[M-1]的子树，其它P[i]指向关键字属于(K[i-1], K[i])的子树；</p>\n<p>8) 所有叶子结点位于同一层；</p>\n<p>如下图为一个M=3的B树示例：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0178191b698ab75a98fa1d0bb03cc51f.jpg\"><img class=\"aligncenter wp-image-111700 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0178191b698ab75a98fa1d0bb03cc51f.jpg\" alt=\"4\" width=\"624\" height=\"268\"></a></p>\n<p>B树创建的示意图：</p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fh5p12mz57g20qm06d4qq.gif\" width=\"958\" height=\"229\"></p>\n<h1 class=\"First\">5. B+树</h1>\n<p>B+树是B树的变体，也是一种多路搜索树：</p>\n<p>1) 其定义基本与B-树相同，除了：</p>\n<p>2) 非叶子结点的子树指针与关键字个数相同；</p>\n<p>3) 非叶子结点的子树指针P[i]，指向关键字值属于[K[i], K[i+1])的子树（B-树是开区间）；</p>\n<p>4) 为所有叶子结点增加一个链指针；</p>\n<p>5) 所有关键字都在叶子结点出现；</p>\n<p>下图为M=3的B+树的示意图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/0972ef809f286cc29cd2d94687b2ef2d.jpg\"><img class=\"aligncenter wp-image-111701 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0972ef809f286cc29cd2d94687b2ef2d.jpg\" alt=\"4\" width=\"569\" height=\"345\"></a></p>\n<p>B+树的搜索与B树也基本相同，区别是B+树只有达到叶子结点才命中（B树可以在非叶子结点命中），其性能也等价于在关键字全集做一次二分查找；</p>\n<p><strong>B+的性质：</strong></p>\n<p>1.所有关键字都出现在叶子结点的链表中（稠密索引），且链表中的关键字恰好是有序的；</p>\n<p>2.不可能在非叶子结点命中；</p>\n<p>3.非叶子结点相当于是叶子结点的索引（稀疏索引），叶子结点相当于是存储（关键字）数据的数据层；</p>\n<p>4.更适合文件索引系统。</p>\n<p>下面为一个B+树创建的示意图：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fh5p2ef94jg20rz05i7wi.gif\" width=\"1007\" height=\"198\"></p>\n<h1 class=\"First\">6. B*树</h1>\n<p>B*树是B+树的变体，在B+树的非根和非叶子结点再增加指向兄弟的指针，将结点的最低利用率从1/2提高到2/3。</p>\n<p>B*树如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb5835f421e029240105ccb8e80279ee.jpg\"><img class=\"aligncenter wp-image-111702 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb5835f421e029240105ccb8e80279ee.jpg\" alt=\"4\" width=\"569\" height=\"345\"></a></p>\n<p>B*树定义了非叶子结点关键字个数至少为(2/3)*M，即块的最低使用率为2/3（代替B+树的1/2）；</p>\n<p>B+树的分裂：当一个结点满时，分配一个新的结点，并将原结点中1/2的数据复制到新结点，最后在父结点中增加新结点的指针；B+树的分裂只影响原结点和父结点，而不会影响兄弟结点，所以它不需要指向兄弟的指针；</p>\n<p>B*树的分裂：当一个结点满时，如果它的下一个兄弟结点未满，那么将一部分数据移到兄弟结点中，再在原结点插入关键字，最后修改父结点中兄弟结点的关键字（因为兄弟结点的关键字范围改变了）；如果兄弟也满了，则在原结点与兄弟结点之间增加新结点，并各复制1/3的数据到新结点，最后在父结点增加新结点的指针；</p>\n<p>所以，B*树分配新结点的概率比B+树要低，空间使用率更高。</p>\n<h1 class=\"First\">7. Trie树</h1>\n<p>Tire树称为字典树，又称单词查找树，Trie树，是一种树形结构，是一种哈希树的变种。典型应用是用于统计，排序和保存大量的字符串（但不仅限于字符串），所以经常被搜索引擎系统用于文本词频统计。<strong>它的优点是：利用字符串的公共前缀来减少查询时间，最大限度地减少无谓的字符串比较，查询效率比哈希树高。</strong></p>\n<div class=\"para\"><strong>Tire树的三个基本性质：</strong></div>\n<div class=\"para\">1) 根节点不包含字符，除根节点外每一个节点都只包含一个字符；</div>\n<div class=\"para\">2) 从根节点到某一节点，路径上经过的字符连接起来，为该节点对应的字符串；</div>\n<div class=\"para\">3) 每个节点的所有子节点包含的字符都不相同。</div>\n<p><strong>Tire树的应用：</strong></p>\n<p>1) <span class=\"headline-content\">串的快速检索</span></p>\n<p class=\"para\">给出N个单词组成的熟词表，以及一篇全用小写英文书写的文章，请你按最早出现的顺序写出所有不在熟词表中的生词。在这道题中，我们可以用数组枚举，用哈希，用字典树，先把熟词建一棵树，然后读入文章进行比较，这种方法效率是比较高的。</p>\n<p class=\"para\"><span class=\"headline-content\">2) “串”排序</span></p>\n<p class=\"para\">给定N个互不相同的仅由一个单词构成的英文名，让你将他们按字典序从小到大输出。用字典树进行排序，采用数组的方式创建字典树，这棵树的每个结点的所有儿子很显然地按照其字母大小排序。对这棵树进行先序遍历即可。</p>\n<p class=\"para\"><span class=\"headline-content\">3) 最长公共前缀</span></p>\n<p class=\"para\">对所有串建立字典树，对于两个串的最长公共前缀的长度即他们所在的结点的公共祖先个数，于是，问题就转化为求公共祖先的问题。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111680\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111680votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111680\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "38cc12ee297c4f23c14ac3da6f7a65ce", "praise_num": 1, "tags": "创业", "fav_nums": 1, "title": "为何不用担心大公司偷你的绝世创业点子", "comments_num": 0, "create_date": "2017/07/04", "front_image_url": ["http://wx1.sinaimg.cn/mw690/63918611gy1fhc6vu9yuej20oq0e4772.jpg"], "front_image_path": "full/80ab850be768ae7a65c51623fb321921ff892d2c.jpg", "url": "http://blog.jobbole.com/111721/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/TJQ\">佟大冬</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://timhampson.quora.com/Startups-Why-Google-Facebook-Apple-SalesForce-probably-wont-steal-your-lunch-money\">Tim Hampson</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：并非所有人都认为你的创业idea是值得做的。且大公司并非拥有无限人力财力，再加上内部各山头的政治斗争，中层干部只求升职加薪安安稳稳，底层年轻员工空有理想但说话没分量。</p>\n<p style=\"text-align: center\"><strong>为何不用担心 GG/FB/苹果等大公司偷你的绝世创业点子<img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fhc6vu9yuej20oq0e4772.jpg\" width=\"690\" height=\"394\"></strong></p>\n<p>创业公司经常被问到这样一个问题——为什么大公司不实现你的创业 idea，从而把你踢除这个市场？</p>\n<p>因为相比于典型创业公司的资源，大公司拥有数十亿美元的资金和成千上万个工程师，所以这个问题听起来似乎非常合理。</p>\n<p>其实比起创业公司，大公司的优势实际比你想象的要少。为什么？这个问题的原因值得列出来。</p>\n<h3>1.创新是件全凭运气的事儿</h3>\n<p>只有当你的点子（idea）开始盈利了，别人才会发现你的 idea 到底有多好，在此之前没人真的了解。然而到那个时候，你也将顺利地成为下一代执牛耳者。风投不会投资公司，他们投资市场和人（尤其是 CEO）。因为他们明白，在一个热门市场，他们尝试投资一位出类拔萃的人，他有望成为市场领导者，而且很有可能（50% ~ 80% 的可能性）带来回报，这些回报足以让有限的合伙人安心。如果这个市场足够热门，即使失败了，你也不会失去一切。失败被遗忘，历史被重写，只有其中 1-2 个带来回报的大项目被人们记住，以强调投资人有远见。而 20-30 个失败投资就这样被遗忘了（在大多数人看来，这些失败投资中，有些可能还是很成功的）。</p>\n<p>创业是一项投资组合业务，而且在这项业务中，大部分风投公司的投资规模在 1~5 亿美元之间。你不能在 2004 年左右，只是简单地将 1000 万美元投资给 Facebook，虽然这也不那么容易。你应该采取广泛的组合投资，而这需要大量的资金。因此，即使市场领导人试着实施他们自己的创新项目时也犹豫不决。</p>\n<p>这种投资组合模式也需要优胜劣汰机制，这一点风投们可以轻松做到，因为他们所要做的只是在资金用完时停止续投。对一个大公司而言，要解散一个表现不佳的研发团队无论从心理上还是实际行动上都困难得多。Google 因为终止项目非常果决，所以经常被做为反例。但实际上 Google 在 Google+ 上展示了它比任何风投都多的耐心。大公司对待新项目就像哺乳动物对待自己的孩子，风投则像鱼，虽然冷血（无双关），但它更有效。</p>\n<p>大公司无意和一个 500 万美元的创业公司竞争，他们竞争的是一个数十亿美元的生态系统，这就是为什么创业公司总能克敌制胜。大公司不能像风投那样对项目进行组合投资。</p>\n<h3>2. 每个人都不愿亏损</h3>\n<p>没人想影响正常稳定的收入。创业公司没有什么收入，所以他们不用担心收入受影响。从稳定的、可预测的（即使是下降的）收入形势中走出来不容易。相比之下，一款最新的小工具能不能在市场投放，大公司不关心，他们更倾向于投资升级成熟的主线产品……</p>\n<p> </p>\n<h3>3. 大公司是受过程约束的</h3>\n<p>每个人都可以说不，没有人可以拍板。或者往好了说，整个公司都需要“买进”，“整个”可以是公司遍布全球的各个部门。中层管理者更关注于管理自己的养老金，这是他们固有的惰性。上层管理者往往对现实市场鞭长莫及，不能辨别后起之秀。而对于公司底层人员，别人说什么他们就做什么，要不然就离开公司自己去创业……</p>\n<h3>4. 大公司需要大项目</h3>\n<p>所有的大公司基本都成为了集团。如果你已经是市场的引领者了，那么唯一的发展方向就是进入另一个市场。如果你想每季度收入几十亿美元，那么只有大项目能够做到。当然，创业公司 100 % 的增长看起来很漂亮，而额外的 100 万美元收入，大公司收入四舍五入带来的错误就有这么多。</p>\n<p>大公司注重创新之处都是大量资本密集投注的地方（比如 Google 街景），这是创业公司难以匹敌的事情。</p>\n<p>这还会影响大公司的发展战略。从 90 年代初期开始，Oracle 公司就不再满足于做一家数据库公司，现在已转型为 IT 供应商，为企业提供全套服务，包括硬件、软件和服务。SalesForce 是 CRM 市场的占尽先机者，所以人们经常还会以为 SalesForce 仍然是一家 CRM 公司。事实上，SalesForce 如今已发展为一个 PaaS 公司，希望通过大数据等来扩展其业务。在云服务方面，SalesForce 像 Oracle 看齐。SalesForce 85% 的 IT 支出是用于企业客户的，Marc Benioff （SalesForce 创始人）根本不在乎小客户，更别说想赶上类似 SalesForce 的 CRM 创业公司。这就像 Oracle 根本不在乎 MongoDB 一样。</p>\n<h3>5. 非本公司原创（即不愿意用别人发明的东西）</h3>\n<p>在 1999 年，Google 主动提出仅以 1 百万美元出售给 Excite，但是被 Excite 嗤之以鼻，因为 Excite 仅靠自己可以很容易实现搜索引擎。有趣的是，虽说他们是正确的，但他们从未找到足够的时间去做。正如他们所说，遗留的是历史。</p>\n<p>作为一个手下数百名开发人员的大公司的产品经理，很难接受这个事实：他们可能已经错过了，几个极客在资源紧缺的条件下，成功完成的某个项目。所以他们通常不会（使用创业公司的 idea）。</p>\n<h3>6. 大公司并不大</h3>\n<p>大公司有很多部门，其中有些可能并不大。“<strong>但他们还是有大量资源</strong>”，没错，但是他们都有事情在做。而对于所需的实际技能，他们并没有。</p>\n<p>90 年代，我离开 IBM（当时已有 30 万名员工），加入了 Sybase（当时有 1500 名员工）。令我惊讶的是，后起之秀 Sybase（只做数据库）专注于数据库开发的员工数量是 IBM 的两倍，那时 IBM 还有除数据库之外的各种业务，甚至包括管理军用直升机的交付项目。之后，当我加入创业公司 Illustra（不到 80 名员工）时，我并不惊讶，而至今我们所拥有的 web 数据库专业知识，比 Informix、Oracle 和 Sybase 加起来都多。最后 Informix 付给了 Illustra 4 亿美元。</p>\n<h3>7. 时间就是金钱</h3>\n<p>究竟为什么 Facebook 不简单地复制 Instagram 的 24 人月的工作量，而是支付令人瞠目的 10 亿美元来收购呢？</p>\n<p>这不是对 13 名员工的人才收购。由于 Instragram 的 3000 万用户也都是 Facebook 的用户（那时有 8.45 亿用户），所以和市场份额也没关系。当然这更不是获得多少收入，因为 Instagram 没有钱，完全没有！</p>\n<p>原因是 Facebook 确信这是图片分享的未来，并且会使自家业务面临风险（因为简单来说，Facebook 实际上是和照片相关的应用）。对于以上列出的所有原因，他们明白至少需要 12 个月才能复制出来，到那时，占尽先机的大公司和初创企业之间的财富可能会有很大的逆转。购买而非构造意味着额外的收入，但是相当于并购公司现有的销售和营销渠道的水平，而不是创业公司的。这可以很容易地证明愚蠢的营收倍数，因为重点不是 Instagram 现在在做什么，而是 Facebook 会错过什么，你说是不是？当 Facebook 在 14 年第三季度几乎投了 30 亿美元时，却只为 Instagram 投了一个月的收入。鉴于现在 Instagram 对于 Facebook 价值主张的重要性，这看起来似乎赚到了。</p>\n<h2>专注于客户，而不是竞争</h2>\n<p>你不能指望一颗橡子就能长成一颗橡树。你首先需要准备一盘完整的幼苗，然后筛选剔除一些，最后专心培育其余的幼苗，期待至少有一颗苗子最后能长成橡树。这实际上正是 VC 模式的整个前提，这也是为什么大公司通常不会压制创业公司的原因，因为他们不知道哪个最终会超过他们，并且也不可能把那么多初创公司都扼杀。</p>\n<p>如同商业中所有的普遍规律一样，也有例外存在。总想着成为市场领导者一向不会有什么好结果，但应该明白以上这些规律。虽然总体规则很明确。几乎没有哪家初创公司会因为试图取代占尽先机者而面临风险，更大的风险是：<strong>你的产品在市场上是否有容身之处</strong>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111721\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111721votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111721\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/TJQ\">佟大冬</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/TJQ\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/5f8b3a74725397a8f5033c9ac0afeefb.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            live and learn.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/TJQ\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/tjq/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/TJQ/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"QQ：601591123\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "9098565e7972c6d0a1a0f5f75c2f05cb", "praise_num": 1, "tags": "IT技术", "fav_nums": 1, "title": "减轻服务器负载的建议和技巧", "comments_num": 0, "create_date": "2017/07/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/06/48bf315aeeae9f3a7ce0b11b7c6ce31e.png"], "front_image_path": "full/b115c033c502899f0a878f54b5a62805b0d233b4.jpg", "url": "http://blog.jobbole.com/111725/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/haowang1989\">王浩</a> 翻译，<a href=\"http://www.jobbole.com/members/8zjl8\">周进林</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.lucidchart.com/techblog/2017/06/02/tips-tricks-for-reducing-server-load/\">lucidchart</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>我们公司有个面向服务的架构。其中一个服务是字体服务，字体体系和 unicode 编码范围（unicode range）提供字体数据，为用户上传的字体验证权限。我们没想到这个字体服务会有很高的负载<sup>1</sup>（负载是指线程消耗和 CPU 等待的平均值）。但是去年我们注意到字体服务出人意料地出现高负载，尤其是晚上我们没什么流量的时候。幸运的是，我们发现了这一问题的根本原因，并大幅提升了字体服务的性能和系统整体的稳定性。以下内容是我们的优化过程。</p>\n<figure><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/48bf315aeeae9f3a7ce0b11b7c6ce31e.png\"><img class=\" wp-image-64903 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/48bf315aeeae9f3a7ce0b11b7c6ce31e.png\" alt=\"Figure 1: Server load before and after change. (Fix was released Dec 21.)\" width=\"661\" height=\"191\"></a><br>\n<figcaption style=\"text-align: center;\">图1：修改前后系统复制（12 月 21 日发布修复版本）</figcaption>\n</figure>\n<h3>用火焰图调试</h3>\n<p>我一个同事从 Netflix 公司的 Brendan Gregg 那里发现并部署了一个小巧的火焰图工具。这个工具可以把多个性能检测工具的数据结合起来，生成一张本地方法和 JVM 方法资源使用情况的图象。图里每一个矩形都代表一个栈帧，矩形的宽度代表资源的使用情况，如 CPU 时间，y 轴代表调用栈。你可以简单地通过找出比较宽的矩形来定位出问题所在。这个工具对于调试字体服务的性能是非常宝贵的。</p>\n<figure><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/092148cc9b6180af009d4a106022a936.png\"><img class=\"wp-image-64904 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/092148cc9b6180af009d4a106022a936.png\" alt=\"Figure 2: A flame graph from a font server during high load.\" width=\"556\" height=\"485\"></a><br>\n<figcaption style=\"text-align: center;\">图2：字体服务器高负载情况下的一张火焰图</figcaption>\n</figure>\n<p>我们收集了几张字体服务高负载状态下的火焰图。下面展示了其中一张，图里有一处 JVM 部分几乎到顶。我们很快注意到这些图的规律。绝大部分时间都是消耗在 libz.so（用于 gzip 压缩和解压）上，而 JVM 里的绝大部分时间都是消耗在 XML 转义和 UTF-8 编码上。</p>\n<figure><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/00be5bb53f79bfbbc30d7eebd570113a.png\"><img class=\"wp-image-64905 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/00be5bb53f79bfbbc30d7eebd570113a.png\" alt=\"Figure 3: A flame graph zoomed in to the JVM portion.\" width=\"555\" height=\"485\"></a><br>\n<figcaption style=\"text-align: center;\">图3：在 JVM 部分放大的火焰图</figcaption>\n</figure>\n<h3>为什么这么慢</h3>\n<p>首先，介绍一点关于我们字体服务如何工作的背景。我们将字体数据保存在 Amazon S3 容器中，每一种字体的每一 unicode 编码范围（unicode range）是一个独立的对象。其他服务会为字体体系、一系列 unicode 编码范围（unicode range）或者用户来请求字体数据。字体服务会下载用户请求的字体体系中特定 unicode 编码范围（unicode range）的数据，并返回包含这所有数据的 XML。</p>\n<p>这一功能非常简单，并没有什么明显密集计算的东西。然而，我们遇到了高负载。我们在火焰图的帮助下发现 libz、XML 转义和 UTF8 编码占用了 CPU 大量资源。但是为什么我们花了这么多时间在编码和压缩上呢？记得我刚才说的，晚上负载最高吗？我们的晚上（美国山区标准时）在亚洲是白天。每当晚上我们本地没什么流量的时候，大量其他地区的用户正在用亚洲语言的 unicode 编码范围（unicode range），比如中文、日语和韩语。事实上，相比起来这些类别的字体数据是非常庞大的。这些数据通过 gzip 解压、UTF-8 解码然后 XML 转义、UTF-8 编码最后 gzip 压缩。对于体积很小的基本拉丁文类别，这一过程没什么。然而，CJK 类别比基本拉丁文类别大了两个数量级（1MB 对比 60KB）。对于这些体积大的字体类别，这所有的转换都使得 CPU 吃不消。Gzip 压缩和解压相对很耗资源，XML 转义也没有那么快。</p>\n<h3>怎样加速</h3>\n<p>字体服务响应的内容本质上只是来自 S3 的原始数据。字体服务的确做了其他重要的工作，比如权限验证，查找字体关键字。但是没有理由必须让字体服务从 S3 转发字体数据。我们的解决方案非常简单粗暴，直接返回一系列包含字体数据的 S3 对象的链接，而不是通过字体服务下载然后重新编码字体数据。</p>\n<p>这一修改几乎将字体服务器的负载降为 0（见图1）。客户端服务器也察觉不到任何影响。尽管我们第一次尝试非常成功，但我也应该记住，我们部署的同时增加了功能发布控制，它可以让我们在 100% 启用前，先启用一定比例的请求来测试它能够正常工作。</p>\n<h3>结论</h3>\n<p>通过对生产环境服务器的监控，我们能够定位并删除服务器上没必要的功能。下面是我们这次经历中几个关键的步骤：</p>\n<ol>\n<li>用火焰图等性能检测工具定位那些霸占 CPU 的功能方法。</li>\n<li>压缩和其他编码也会非常耗资源。</li>\n<li>如果客户端能够直接获取到数据，那么直接发给它一个连接而非转发数据会提升整体的性能。（声明：这并不是灵丹妙药，有些情况下会对客户端性能造成损失，因为它必须要做二次请求）。</li>\n</ol>\n<p>#1: 负载是指线程消耗和 CPU 等待的平均值。见 <a href=\"https://en.wikipedia.org/wiki/Load_%28computing%29\">Wikipedia</a>。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/19b948cb00fa062128f45b2b53fa09e2.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/d327bdec80a27c733bd7b9edb35d30f4.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111725\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111725votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111725\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/haowang1989\">王浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/haowang1989\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/47586e0af10336a9ced0cb16d851200f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            phper @深圳        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/haowang1989\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/haowang1989/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/haowang1989/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 13</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/ontheroads\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "a6d7be3180bc17350825a84d5e402c60", "praise_num": 5, "tags": "职场", "fav_nums": 7, "title": "程序员生涯第一生存法则", "comments_num": 3, "create_date": "2017/07/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/08/programmer-developer-at-work.jpg"], "front_image_path": "full/bb38d11fb4038702790e0370ed966c50f186ff40.jpg", "url": "http://blog.jobbole.com/111627/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://mp.weixin.qq.com/s/deP25x394QP0lSItHFWs4Q\">世相微语</a>   </div><p><strong>程序员的职业生涯，第一生存法则是什么？</strong></p>\n<p>追求理想、兴趣与爱好？ 不免有点奢侈。坚守道德、信仰与纯粹？ 也许太高尚了。</p>\n<p>平衡生活与工作、兼顾家庭与公司、妥善处理人际关系、熟练掌握沟通能力与谈判能力、扩大社交圈、耐得住寂寞、熬得了夜、活到老充电充到老、懂得取舍与妥协、低调做人高调做事… <strong>本文暂不打算灌输这类心灵鸡汤。</strong></p>\n<p>打开格局、扩大视野、开阔眼界、看准趋势、远见卓识，成为华尔街的宽客、CEO、CTO、首席科学家、首席架构师… 不幸的是，<strong>90%的量产程序员穷极一生，也注定无缘赖此生存，因为这个领域，天赋与机遇缺一不可。</strong></p>\n<p>数据结构、设计模式、算法架构、模型抽象、操作系统原理、编译器原理、概率统计、数论、代数、几何、微分… 相信我，<strong>90%的量产程序员编程10年，赖此生存的时间也不超过10天。</strong></p>\n<hr>\n<p>那程序员生涯的第一生存法则是什么？</p>\n<p><strong>很简单，拥抱开源，拥抱变化。</strong><strong>远离远离开源的公司，远离技术落伍许久的团队。</strong></p>\n<p><strong>职业生涯，无论做什么，第一要务是生存，而且应该是越过越舒适的生存。</strong><strong>譬如律师、医生，程序员亦是如此。</strong></p>\n<p>程序员，到 34 岁了，被公司直接或变相辞退了，是挺悲催的。</p>\n<p>但更悲催的是，离开这里，居然无法找到（至少）和之前同水平待遇的工作…</p>\n<hr>\n<p><strong>原因何在？</strong></p>\n<p>因为不少程序员都固执的认为自己所在的公司、所在的部门、所在的团队会基业长青，自己只需要埋头苦干，耕耘好自己的一亩三分地就能安享太平。</p>\n<p><strong>可现实是，你的工作并不是你想象的那样不可替代，你的业务代码也许一个初出茅庐的毕业生就可以接手，你的团队、部门、甚至公司也可能会在你想象不到的时刻宣布解散。</strong></p>\n<p>如果你的工作只是基于公司内部的闭源框架或陈旧的架构体系，调用一下接口，写写业务代码，修复一下bug，离开这里，还剩多少竞争力呢？</p>\n<p>试想一下，同样是业务系统开发，一个基于Spring（称得上Java第一开源框架）、Spark（大数据开源框架）、Kafka（消息中间件）开发的程序员，和一个基于Spriii、Spaaa、Kafff（泛指公司内部专用的框架）开发的程序员，能力相当，走出这家公司谁更吃香？</p>\n<p>再试想一下，同样是应用开发，一个玩转 Spring、Struts、Hibernate（Java开源老三样）的程序员，和一个玩转 Spring、SpringMVC、Mybatis （Java开源新三样）或 Spring Boot 的程序员，水平相当，出去面试谁更可受欢迎？</p>\n<p><strong>即使只是一颗螺丝钉，也要做一颗技术领先，在外界受欢迎的螺丝钉。去哪都能如鱼得水、畅快优游。</strong></p>\n<p><strong>这也是90%的普通程序员，首要应该思考的问题。</strong></p>\n<p>当然，这不是让你心猿意马，而是要时刻保持危机感，否则一不小心就走入了职场死胡同。</p>\n<hr>\n<p><strong>职场上，最好的生存保障是，走出这家公司，我依然能过得很好，或更好。</strong></p>\n<p>公司实行成本优化，开始清退 34+ 的程序员了？挺好，对面那家公司正想双薪挖人。</p>\n<p>项目市场反馈不行，团队面临解散？没事，另外团队的 Leader 前几日刚找我聊了，正希望我加入。</p>\n<p>Salesforce 来推销他们的 SaaS（企业软件即服务）服务了，IT部门又可以优化几个人员了。正好，那家18薪出国游的公司正在招人，技术要求很匹配…</p>\n<hr>\n<p><strong>在一家远离开源的公司，或技术落伍许久的团队，即使你是首席架构、技术总监，熟练掌握公司或团队内部的各种框架，配置和接口倒背如流，还能一一填埋这些框架的各种坑，那又如何？</strong></p>\n<p><strong>35岁了，换了一家公司，也许你又归零成了小白，因为别人不玩你这一套。</strong></p>\n<p>诺基亚塞班系统的专家，别说去微软了，即使去诺西（诺基亚西门子通信的简称），很多都得从头再来。</p>\n<p>百度 Pyramid（细节自行百度）项目组的大拿，还不如一个精通 Hadoop 配置的工程师更有市场。</p>\n<p>SAP、Oracle EBS 开发的资深工程师，选择公司的余地远比不上一个初级 React 工程师。</p>\n<p>之前参加过一些创业项目的路演，遇到过一个项目，创始人是两位博士，号称研发了最先进的深度学习算法，用于医学扫描成像的癌症诊断。</p>\n<p>但是，TensorFlow（谷歌）、CNTK（微软）等深度学习开源框架的图像识别算法，在癌症检测方面也许可以碾压小创业团队所谓的绝门秘笈。挺替他们的投资人担心的…</p>\n<hr>\n<p><strong>目前为止，只说了 90% 的普通程序员，那还有 10% 精英程序员呢？</strong></p>\n<p><strong>毫无疑问，精英程序员更应该拥抱开源，因为那才是实现个人价值，提升个人影响力的最佳途径。</strong></p>\n<p>如果 Spring 没有开源，就不可能获得如此广泛的应用，Rod Johnson（Spring 之父）的影响力也会大打折扣。</p>\n<p>如果 Lucene、Hadoop 没有开源，很多人可能都不知道 Doug Cutting（Lucene、Hadoop 之父）为何许人也。</p>\n<p>如果 Linux、Git 没有开源，也许就没有 Linus Torvalds（Linux、Git 之父）的享誉世界。更重要的是，这个世界可能会被更多的蝗虫入侵。</p>\n<p><em>注：“突然间，到处都是微软的产品了，被蝗虫入侵了似的。我并不是说蝗虫是坏蛋，我喜欢所有的动物和昆虫。” —— 摘自 Linus Torvalds 语录：</em></p>\n<p><strong>诚然，如上的大神毕竟凤毛麟角。但大牛级别的程序员走向开源，带来的个人影响力、声誉、技术伙伴、收入、成就感等，都是实实在在的。</strong></p>\n<hr>\n<p><strong>说了这么多，也许你也挺无奈的，因为你所在的项目所用的技术体系，刚好是公司专有且闭源的，那怎么办？</strong></p>\n<p>你可以默默的把这篇文章转给你们技术领导看看，看他有没有这个思想觉悟。</p>\n<p>如果领导悟性不够，半晌没有回应，你可以提点他一下：无论实习码农，还是技术大牛，现在优秀的人才都拥抱开源去了，我们再这样下去，会招不到优秀的人才的…</p>\n<hr>\n<p><strong>如果非常不幸，你从事的是银行、基金、保险、电信、电力、石油等领域的业务，而且还是古董级别的项目，领导说稳定才是第一位的。那你也有三条路可以走：</strong></p>\n<p>1、祈祷自己早日实现财务自由（据年初的胡润报告，一线城市财富自由门槛是 2.9亿）</p>\n<p>2、祈祷所在的公司（部门）能够基业长青</p>\n<p>3、更新一下简历，准备跳槽吧~</p>\n<p><strong>那这种古董级别的项目怎么办？总得有人维护吧？</strong></p>\n<p><strong>加薪！加薪！加薪！不能给予锦绣未来，就给予更猛烈的薪水吧！</strong></p>\n<hr>\n<p><strong>最后，即使是第一生存法则，也不是金科玉律。因为世上总存在一些奇葩的人，码农这个群体也不例外。</strong></p>\n<p>譬如我找人，最关注的还是逻辑思考能力。写一个新算法，学一门新语言，用一套新框架，不过几周的事情，何必那么纠结。</p>\n<p>不过，玩过 Tensorflow 图像识别与目标检测，跑过 ResNet、Inception 等网络的优先…</p>\n<hr>\n<p><strong>题外话</strong></p>\n<p>本文通篇都是从务实的角度来谈开源的好处，事物都有两面性，那开源的坏处在哪里？</p>\n<p>其实前面也提到了一点，TensorFlow、CNTK 等开源框架的算法，完全可以碾压大多数人工智能创业团队所研发的所谓独门秘诀，特别是通用算法领域。</p>\n<p><strong>也就是说，不少创业团队、研究院、实验室里，一门心思研究底层算法（包括图像识别、语音识别、翻译、NLP等前沿领域）造轮子的精英程序员、研究员可能会因此荒废多年的心血…</strong></p>\n<p>譬如，两个月前，百度推出阿波罗计划，将自家的自动驾驶平台开放。这同时意味着，国内自动驾驶领域的不少创业团队可能会面临被洗牌、解散。如果今后谷歌也来这么一出，行业震荡可想而知。</p>\n<p>前些日子，还听我一位在某大厂研究院视觉识别组的同学说：谷歌物体检测与图像识别的API一开放，他们视觉组辛苦了3、4年的研发心血又白费了…</p>\n<p><strong>可开源是人类社会进化的最优选择，因为只有开源，才能实现人类顶级智慧的充分共享与协作。</strong>除了谷歌、脸书，连一贯封闭的微软、苹果两大巨头都已走向开放。</p>\n<p><strong>开源大潮，浩浩荡荡，顺之者势如破竹，逆之者举步维艰。</strong></p>\n<p>也许自然规律如此，人类宿命如此吧。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111627\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111627votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111627\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "2b13e3e5df22fd0e812a87b4e135b363", "praise_num": 1, "tags": "其他", "fav_nums": 0, "title": "如何做到“恰好一次”地传递数十亿条消息", "comments_num": 0, "create_date": "2017/07/12", "front_image_url": ["http://dl2.iteye.com/upload/attachment/0125/9374/0805a15e-51e6-3eb3-b3dc-4a687849ed1c.png"], "front_image_path": "full/857f271a3adaff2d5c4056118f165d5851466b8a.jpg", "url": "http://blog.jobbole.com/111809/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://segment.com/blog/exactly-once-delivery/\">Amir Abu Shareb</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32533\">ITeye-雁惊寒</a>   </div><p><em>译者注：在分布式领域中存在着三种类型的消息投递语义，分别是：最多一次（at-most-once）、至少一次（at-least-once）和恰好一次（exactly-once）。本文作者介绍了一个利用Kafka和RocksDB来构建的“恰好一次”消息去重系统的实现原理。以下是译文。</em></p>\n<p>对任何一个数据流水线的唯一要求就是不能丢失数据。数据通常可以被延迟或重新排序，但不能丢失。</p>\n<p>为了满足这一要求，大多数的分布式系统都能够保证“<a href=\"http://www.cloudcomputingpatterns.org/at_least_once_delivery/\" target=\"_blank\">至少一次</a>”的投递消息技术。实现“至少一次”的投递技术通常就是：“重试、重试、再重试”。在你收到消费者的确认消息之前，你永远不要认为消息已经投递过去。</p>\n<p>但“至少一次”的投递并不是用户想要的。用户希望消息被投递一次，并且仅有一次。</p>\n<p>然而，<a href=\"http://bravenewgeek.com/you-cannot-have-exactly-once-delivery/\" target=\"_blank\">实现“恰好一次”的投递需要完美的设计</a>。每种投递失败的情况都必须认真考虑，并设计到架构中去，因此它不能在事后“挂到”现有的实现上去。即使这样，“只有一次”的投递消息几乎是不可能的。</p>\n<p>在过去的三个月里，我们构建了一个全新的去重系统，以便在面对各种故障时能让系统尽可能实现“恰好一次”的投递。</p>\n<p>新系统能够跟踪旧系统100倍的消息数量，并且可靠性也得到了提高，而付出的代价却只有一点点。下面我们就开始介绍这个新系统。</p>\n<p><strong>问题所在</strong></p>\n<p>Segment内部的大部分系统都是通过重试、消息重新投递、锁定和<a href=\"https://en.wikipedia.org/wiki/Two-phase_commit_protocol\" target=\"_blank\">两阶段提交</a>来优雅地处理故障。但是，有一个特例，那就是将数据直接发送到公共API的客户端程序。</p>\n<p>客户端（特别是移动客户端）经常会发生网络问题，有时候发送了数据，却没有收到API的响应。</p>\n<p>想象一下，某天你乘坐公共汽车，在iPhone上使用HotelTonight软件预订房间。该应用程序将数据上传到了Segment的服务器上，但汽车突然进入了隧道并失去了网络连接。你发送的某些数据在服务器上已经被处理，但客户端却无法收到服务器的响应消息。</p>\n<p>在这种情况下，即使服务器在技术上已经收到了这些确切的消息，但客户端也会进行重试并将相同的消息重新发送给Segment的API。</p>\n<p>从我们服务器的统计数据来看，在四个星期的窗口时间内，大约有0.6％的消息似乎是我们已经收到过的重复消息。</p>\n<p>这个错误率听起来可能并不是很高。但是，对于一个能创造数十亿美元效益的电子商务应用程序来说，0.6％的出入可能意味着盈利和数百万美元损失之间的差别。</p>\n<p><strong>对消息进行去重</strong></p>\n<p>现在，我们认识到问题的症结了，我们必须删除发送到API的重复消息。但是，该怎么做呢？</p>\n<p>最简单的思路就是使用针对任何类型的去重系统的高级API。在Python中，我们可以将其表示为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59661c32d1d60636072504\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef dedupe(stream):  \r\n  for message in stream:  \r\n    if has_seen(message.id):   \r\n      discard(message)  \r\n    else:  \r\n      publish_and_commit(message)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d60636072504-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d60636072504-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d60636072504-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d60636072504-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d60636072504-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d60636072504-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661c32d1d60636072504-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">dedupe</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d60636072504-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">message </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stream</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d60636072504-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">has_seen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d60636072504-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">discard</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d60636072504-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d60636072504-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">publish_and_commit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>对于数据流中的每个消息，首先要把他的id（假设是唯一的）作为主键，检查是否曾经见过这个特定的消息。如果以前见过这个消息，则丢弃它。如果没有，则是新的，我们应重新发布这个消息并以原子的方式提交消息。</p>\n<p>为了避免存储所有的消息，我们会设置“去重窗口”这个参数，这个参数定义了在消息过期之前key存储的时长。只要消息落在窗口时间之外，我们就认为它已过期失效。我们要保证在窗口时间内某个给定ID的消息只发送一次。</p>\n<p>这个行为很容易描述，但有两个方面需要特别注意：读/写性能和正确性。</p>\n<p>我们希望系统能够低延迟和低成本的对通过流水线的数十亿个事件进行去重。更重要的是，我们要确保所有的事件都能够被持久化，以便可以从崩溃中恢复出来，并且不会输出重复的消息。</p>\n<p><strong>架构</strong></p>\n<p>为了实现这一点，我们创建了一个“两阶段”架构，它读入Kafka的数据，并且在四个星期的时间窗口内对接收到的所有事件进行去重。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9374/0805a15e-51e6-3eb3-b3dc-4a687849ed1c.png\" width=\"649\" height=\"363\"></div>\n<div style=\"text-align: center\">去重系统的高级架构图</div>\n<div style=\"text-align: center\"></div>\n<p><strong>Kafka的拓扑结构</strong></p>\n<p>要了解其工作原理，首先看一下<a href=\"https://kafka.apache.org/\" target=\"_blank\">Kafka</a>的流拓扑结构。所有传入消息的API调用都将作为单独的消息进行分离，并读入到Kafka输入主题（input topic）中。</p>\n<p>首先，每个传入的消息都有一个由客户端生成的具有唯一性的messageId标记。在大多数情况下，这是一个UUIDv4（我们考虑切换到<a href=\"https://segment.com/blog/a-brief-history-of-the-uuid/\" target=\"_blank\">ksuids</a>）。 如果客户端不提供messageId，我们会在API层自动分配一个。</p>\n<p>我们不使用矢量时钟或序列号，因为我们希望能降低客户端的复杂性。使用UUID可以让任何人轻松地将数据发送到我们的API上来，因为几乎所有的主要语言都支持它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59661c32d1d6b787320202\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{  \r\n  \"messageId\": \"ajs-65707fcf61352427e8f1666f0e7f6090\",  \r\n  \"anonymousId\": \"e7bd0e18-57e9-4ef4-928a-4ccc0b189d18\",  \r\n  \"timestamp\": \"2017-06-26T14:38:23.264Z\",  \r\n  \"type\": \"page\"  \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d6b787320202-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d6b787320202-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d6b787320202-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d6b787320202-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d6b787320202-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d6b787320202-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661c32d1d6b787320202-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d6b787320202-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"messageId\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ajs-65707fcf61352427e8f1666f0e7f6090\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d6b787320202-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"anonymousId\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"e7bd0e18-57e9-4ef4-928a-4ccc0b189d18\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d6b787320202-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"timestamp\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2017-06-26T14:38:23.264Z\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d6b787320202-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"page\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d6b787320202-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>为了能够将消息持久化，并能够重新发送，一个个的消息被保存到Kafka中。消息以messageId进行分区，这样就可以保证具有相同messageId的消息能够始终由同一个消费者处理。</p>\n<p>这对于数据处理来说是一件很重要的事情。我们可以通过路由到正确的分区来查找键值，而不是在整个中央数据库的数百亿条消息中查找，这种方法极大地缩小了查找范围。</p>\n<p>去重“worker”（worker：工人。译者注，这里表示的是某个进程。为防止引起歧义，下文将直接使用worker）是一个Go程序，它的功能是从Kafka输入分区中读入数据，检查消息是否有重复，如果是新的消息，则发送到Kafka输出主题中。</p>\n<p>根据我们的经验，worker和Kafka拓扑结构都非常容易掌握。我们无需使用一组遇到故障时需要切换到副本的庞大的<a href=\"https://memcached.org/\" target=\"_blank\">Memcached</a>实例。相反，我们只需使用零协同的嵌入式<a href=\"http://rocksdb.org/\" target=\"_blank\">RocksDB</a>数据库，并以非常低的成本来获得持久化存储。</p>\n<p><strong>RocksDB的worker进程</strong></p>\n<p>每一个worker都会在本地EBS硬盘上存放了一个RocksDB数据库。 RocksDB是由<a href=\"https://www.facebook.com/notes/facebook-engineering/under-the-hood-building-and-open-sourcing-rocksdb/10151822347683920/\" target=\"_blank\">Facebook开发的嵌入式键值存储系统</a>，它的性能非常高。</p>\n<p>每当从输入主题中过来的消息被消费时，消费者通过查询RocksDB来确定我们之前是否见过该事件的messageId。</p>\n<p>如果RocksDB中不存在该消息，我们就将其添加到RocksDB中，然后将消息发布到Kafka输出主题。</p>\n<p>如果消息已存在于RocksDB，则worker不会将其发布到输出主题，而是更新输入分区的偏移，确认已处理过该消息。</p>\n<p><strong>性能</strong></p>\n<p>为了让我们的数据库获得高性能，我们必须对过来的每个事件满足三种查询模式：</p>\n<ul>\n<li>检测随机key的存在性，这可能不存在于我们的数据库中，但会在key空间中的任何地方找到。</li>\n<li>高速写入新的key</li>\n<li>老化那些超出了“去重窗口”的旧的key</li>\n</ul>\n<p>实际上，我们必须不断地检索整个数据库，追加新的key，老化旧的key。在理想情况下，这些发生在同一数据模型中。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9376/72903fab-cccf-3cad-865c-1ff55f16cc47.png\" width=\"650\" height=\"346\"></div>\n<div style=\"text-align: center\">我们的数据库必须满足三种独立的查询模式</div>\n<div style=\"text-align: center\"></div>\n<p>一般来说，这些性能大部分取决于我们数据库的性能，所以应该了解一下RocksDB的内部机制来提高它的性能。</p>\n<p>RocksDB是一个<a href=\"https://en.wikipedia.org/wiki/Log-structured_merge-tree\" target=\"_blank\">日志结构合并树（log-structured-merge-tree， 简称LSM）</a>数据库，这意味着它会不断地将新的key附加到磁盘上的预写日志（write-ahead-log）中，并把排序过的key存放在内存中作为memtable的一部分。</p>\n<div style=\"text-align: center\"><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9378/c8ba4f20-2a19-3d7d-9757-35a21939ad9b.png\" width=\"650\" height=\"316\"><br>\nkey存放在内存中作为memtable的一部分</div>\n<div></div>\n<div>写入key是一个非常快速的过程。新的消息以追加的方式直接保存到磁盘上，并且数据条目在内存中进行排序，以提供快速的搜索和批量写入。</div>\n<div>每当写入到memtable的条目达到一定数量时，这些条目就会被作为SSTable（排序的字符串表）持久化到磁盘上。由于字符串已经在内存中排过序了，所以可以将它们直接写入磁盘。</div>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9380/51764a44-a86b-3b2b-a51f-e3d76fb99e0d.png\" width=\"650\" height=\"442\"></div>\n<div style=\"text-align: center\">当前的memtable零级写入磁盘</div>\n<div style=\"text-align: center\"></div>\n<p>以下是在我们的生产日志中写入的示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59661c32d1d72243811615\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[JOB 40] Syncing log #655020  \r\n[default] [JOB 40] Flushing memtable with next log file: 655022  \r\n[default] [JOB 40] Level-0 flush table #655023: started  \r\n[default] [JOB 40] Level-0 flush table #655023: 15153564 bytes OK  \r\n[JOB 40] Try to delete WAL files size 12238598, prev total WAL file size 24346413, number of live WAL files 3.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d72243811615-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d72243811615-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d72243811615-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d72243811615-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d72243811615-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661c32d1d72243811615-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Syncing </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655020  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d72243811615-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flushing </span><span class=\"crayon-e\">memtable </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">next </span><span class=\"crayon-e\">log </span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">655022</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d72243811615-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Level</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flush </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655023: started  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d72243811615-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Level</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flush </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655023: 15153564 bytes OK  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d72243811615-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Try</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete </span><span class=\"crayon-e\">WAL </span><span class=\"crayon-e\">files </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12238598</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">prev </span><span class=\"crayon-e\">total </span><span class=\"crayon-e\">WAL </span><span class=\"crayon-e\">file </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24346413</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">live </span><span class=\"crayon-e\">WAL </span><span class=\"crayon-i\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>每个SSTable是不可变的，一旦创建，永远不会改变。这是什么写入新的键这么快的原因。无需更新文件，无需写入扩展。相反，在带外压缩阶段，同一级别的多个SSTable可以合并成一个新的文件。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9382/50bf7dc4-1153-30fb-b263-d3d887451cec.png\" width=\"650\" height=\"422\"></div>\n<p> </p>\n<p>当在同一级别的SSTables压缩时，它们的key会合并在一起，然后将新的文件升级到下一个更高的级别。</p>\n<p>看一下我们生产的日志，可以看到这些压缩作业的示例。在这种情况下，作业41正在压缩4个0级文件，并将它们合并为单个较大的1级文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59661c32d1d77829091625\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/data/dedupe.db$ head -1000 LOG | grep \"JOB 41\"  \r\n[JOB 41] Compacting 4@0 + 4&lt;a href=\"http://www.jobbole.com/members/yaowei729\"&gt;@1&lt;/a&gt; files to L1, score 1.00  \r\n[default] [JOB 41] Generated table #655024: 1550991 keys, 69310820 bytes  \r\n[default] [JOB 41] Generated table #655025: 1556181 keys, 69315779 bytes  \r\n[default] [JOB 41] Generated table #655026: 797409 keys, 35651472 bytes  \r\n[default] [JOB 41] Generated table #655027: 1612608 keys, 69391908 bytes  \r\n[default] [JOB 41] Generated table #655028: 462217 keys, 19957191 bytes  \r\n[default] [JOB 41] Compacted 4@0 + 4&lt;a href=\"http://www.jobbole.com/members/yaowei729\"&gt;@1&lt;/a&gt; files to L1 =&gt; 263627170 bytes</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d77829091625-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d77829091625-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d77829091625-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d77829091625-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d77829091625-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d77829091625-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d77829091625-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d77829091625-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661c32d1d77829091625-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dedupe</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">head</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOG</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"JOB 41\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d77829091625-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Compacting</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/yaowei729\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">files </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">L1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.00</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d77829091625-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655024: 1550991 keys, 69310820 bytes  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d77829091625-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655025: 1556181 keys, 69315779 bytes  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d77829091625-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655026: 797409 keys, 35651472 bytes  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d77829091625-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655027: 1612608 keys, 69391908 bytes  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d77829091625-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Generated </span><span class=\"crayon-v\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#655028: 462217 keys, 19957191 bytes  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d77829091625-8\"><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">JOB</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Compacted</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/yaowei729\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">files </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">L1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">263627170</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>压缩完成后，新合并的SSTables将成为最终的数据库记录集，旧的SSTables将被取消链接。</p>\n<p>如果我们登录到生产实例，我们可以看到正在更新的预写日志以及正在写入、读取和合并的单个SSTable。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9384/58c26daf-e386-397d-a70d-e0b929f02bb5.jpg\" width=\"650\" height=\"425\"></div>\n<div style=\"text-align: center\">日志和最近占用I/O的SSTable</div>\n<div style=\"text-align: center\"></div>\n<p>下面生产的SSTable统计数据中，可以看到一共有四个“级别”的文件，并且一个级别比一个级别的文件大。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9386/be0b7a4d-2501-3a32-8767-29ebfffb90ae.png\" width=\"650\" height=\"243\"></div>\n<p>RocksDB保存了索引和存储在SSTable的特定SSTables的<a href=\"https://en.wikipedia.org/wiki/Bloom_filter\" target=\"_blank\">布隆过滤器</a>，并将这些加载到内存中。通过查询这些过滤器和索引可以找到特定的key，然后将完整的SSTable作为LRU基础的一部分加载到内存中。</p>\n<p>在绝大多数情况下，我们就可以看到新的消息了，这使得我们的去重系统成为教科书中的布隆过滤器案例。</p>\n<p>布隆过滤器会告诉我们某个键“可能在集合中”，或者“绝对在集合中”。要做到这一点，布隆过滤器保存了已经见过的任何元素的多种哈希函数的设置位。如果设置了散列函数的所有位，则过滤器将返回消息“可能在集合中”。</p>\n<div><img class=\"magplus aligncenter\" title=\"点击查看原始大小图片\" src=\"http://dl2.iteye.com/upload/attachment/0125/9388/865a6b99-4181-3dc8-8400-5c9afab2d7b5.png\" width=\"650\" height=\"225\"></div>\n<p> </p>\n<p>我们的集合包含{x，y，z}，在布隆过滤器中查询w，则布隆过滤器会返回“不在集合中”，因为其中有一位没有设置。</p>\n<p>如果返回“可能在集合中”，则RocksDB可以从SSTables中查询到原始数据，以确定该项是否在该集合中实际存在。但在大多数情况下，我们不需查询任何SSTables，因为过滤器将返回“绝对不在集合”的响应。</p>\n<p>在我们查询RocksDB时，我们会为所有要查询的相关的messageId发出一个MultiGet。基于性能考虑，我们会批量地发布出去，以避免太多的并发锁定操作。它还允许我们批量处理来自Kafka的数据，这是为了实现顺序写入，而不是随机写入。</p>\n<p>以上回答了为什么读/写工作负载性能这么好的问题，但仍然存在如何老化数据这个问题。</p>\n<p><strong>删除：按大小来限制，而不是按时间来限制</strong></p>\n<p>在我们的去重过程中，我们必须要确定是否要将我们的系统限制在严格的“去重窗口”内，或者是通过磁盘上的总数据库大小来限制。</p>\n<p>为了避免系统突然崩溃导致去重系统接收到所有客户端的消息，我们决定按照大小来限制接收到消息数量，而不是按照设定的时间窗口来限制。这允许我们为每个RocksDB实例设置最大的大小，以能够处理突然的负载增加。但是其副作用是可能会将去重窗口降低到24小时以下。</p>\n<p>我们会定期在RocksDB中老化旧的key，使其不会增长到无限大小。为此，我们根据序列号保留key的第二个索引，以便我们可以先删除最早接收到的key。</p>\n<p>我们使用每个插入的key的序列号来删除对象，而不是使用RocksDB TTL（这需要在打开数据库的时候设置一个固定的TTL值）来删除。</p>\n<p>因为序列号是第二索引，所以我们可以快速地查询，并将其标记为已删除。下面是根据序列号进行删除的示例代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59661c32d1d7e602656950\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunc (d *DB) delete(n int) error {  \r\n        // open a connection to RocksDB  \r\n        ro := rocksdb.NewDefaultReadOptions()  \r\n        defer ro.Destroy()  \r\n  \r\n        // find our offset to seek through for writing deletes  \r\n        hint, err := d.GetBytes(ro, []byte(\"seek_hint\"))  \r\n        if err != nil {  \r\n                return err  \r\n        }  \r\n  \r\n        it := d.NewIteratorCF(ro, d.seq)  \r\n        defer it.Close()  \r\n  \r\n        // seek to the first key, this is a small  \r\n        // optimization to ensure we don't use `.SeekToFirst()`  \r\n        // since it has to skip through a lot of tombstones.  \r\n        if len(hint) &gt; 0 {  \r\n                it.Seek(hint)  \r\n        } else {  \r\n                it.SeekToFirst()  \r\n        }  \r\n  \r\n        seqs := make([][]byte, 0, n)  \r\n        keys := make([][]byte, 0, n)  \r\n  \r\n        // look through our sequence numbers, counting up  \r\n        // append any data keys that we find to our set to be  \r\n        // deleted  \r\n        for it.Valid() &amp;&amp; len(seqs) &lt; n {  \r\n                k, v := it.Key(), it.Value()  \r\n                key := make([]byte, len(k.Data()))  \r\n                val := make([]byte, len(v.Data()))  \r\n  \r\n                copy(key, k.Data())  \r\n                copy(val, v.Data())  \r\n                seqs = append(seqs, key)  \r\n                keys = append(keys, val)  \r\n  \r\n                it.Next()  \r\n                k.Free()  \r\n                v.Free()  \r\n        }  \r\n  \r\n        wb := rocksdb.NewWriteBatch()  \r\n        wo := rocksdb.NewDefaultWriteOptions()  \r\n        defer wb.Destroy()  \r\n        defer wo.Destroy()  \r\n  \r\n        // preserve next sequence to be deleted.  \r\n        // this is an optimization so we can use `.Seek()`  \r\n        // instead of letting `.SeekToFirst()` skip through lots of tombstones.  \r\n        if len(seqs) &gt; 0 {  \r\n                hint, err := strconv.ParseUint(string(seqs[len(seqs)-1]), 10, 64)  \r\n                if err != nil {  \r\n                        return err  \r\n                }  \r\n  \r\n                buf := []byte(strconv.FormatUint(hint+1, 10))  \r\n                wb.Put([]byte(\"seek_hint\"), buf)  \r\n        }  \r\n  \r\n        // we not only purge the keys, but the sequence numbers as well  \r\n        for i := range seqs {  \r\n                wb.DeleteCF(d.seq, seqs[i])  \r\n                wb.Delete(keys[i])  \r\n        }  \r\n  \r\n        // finally, we persist the deletions to our database  \r\n        err = d.Write(wo, wb)  \r\n        if err != nil {  \r\n                return err  \r\n        }  \r\n  \r\n        return it.Err()  \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59661c32d1d7e602656950-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59661c32d1d7e602656950-76\">76</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-1\"><span class=\"crayon-e\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">d *</span><span class=\"crayon-v\">DB</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// open a connection to RocksDB  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ro</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rocksdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewDefaultReadOptions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">ro</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Destroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-5\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// find our offset to seek through for writing deletes  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">GetBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ro</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"seek_hint\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-11\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewIteratorCF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ro</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-14\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// seek to the first key, this is a small  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// optimization to ensure we don't use `.SeekToFirst()`  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// since it has to skip through a lot of tombstones.  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-19\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Seek</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-21\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SeekToFirst</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-23\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">seqs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-26\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// look through our sequence numbers, counting up  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// append any data keys that we find to our set to be  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// deleted  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Valid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Key</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-34\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-35\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-36\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">seqs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keys</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-39\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-42\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-44\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rocksdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewWriteBatch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rocksdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">NewDefaultWriteOptions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Destroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">defer </span><span class=\"crayon-v\">wo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Destroy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-49\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// preserve next sequence to be deleted.  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// this is an optimization so we can use `.Seek()`  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// instead of letting `.SeekToFirst()` skip through lots of tombstones.  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-54\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">hint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ParseUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-55\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-56\"><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-57\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-58\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-59\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">buf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strconv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">FormatUint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hint</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-60\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"seek_hint\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-62\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// we not only purge the keys, but the sequence numbers as well  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">seqs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-65\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DeleteCF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seqs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-66\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keys</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-68\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// finally, we persist the deletions to our database  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">err</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-72\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">err</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-74\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59661c32d1d7e602656950-75\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Err</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59661c32d1d7e602656950-76\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0123 seconds] -->\r\n<p>为了保证写入速度，RocksDB不会立即返回并删除一个键（记住，这些SSTable是不可变的！）。相反，RocksDB将添加一个“墓碑”，等到压缩时再进行删除。因此，我们可以通过顺序写入来快速地老化，避免因为删除旧项而破坏内存数据。</p>\n<p><strong>确保正确性</strong></p>\n<p>我们已经讨论了如何确保数十亿条消息投递的速度、规模和低成本的搜索。最后一个部分将讲述各种故障情况下我们如何确保数据的正确性。</p>\n<p><strong>EBS快照和附件</strong></p>\n<p>为了确保RocksDB实例不会因为错误的代码推送或潜在的EBS停机而损坏，我们会定期保存每个硬盘驱动器的快照。虽然EBS已经在底层进行了复制，但是这一步可以防止数据库受到某些底层机制的破坏。</p>\n<p>如果我们想要启用一个新实例，则可以先暂停消费者，将相关联的EBS驱动器分开，然后重新附加到新的实例上去。只要我们保证分区ID相同，重新分配磁盘是一个轻松的过程，而且也能保证数据的正确性。</p>\n<p>如果worker发生崩溃，我们依靠RocksDB内置的预写日志来确保不会丢失消息。消息不会从输入主题提交，除非RocksDB已经将消息持久化在日志中。</p>\n<p><strong>读取输出主题</strong></p>\n<p>你可能会注意到，本文直到这里都没有提到“原子”步骤，以使我们能够确保只投递一次消息。我们的worker有可能在任何时候崩溃，不如：写入RocksDB时、发布到输出主题时，或确认输入消息时。</p>\n<p>我们需要一个原子的“提交”点，并覆盖所有这些独立系统的事务。对于输入的数据，需要某个“事实来源”：输出主题。</p>\n<p>如果去重worker因为某些原因发生崩溃，或者遇到Kafka的某个错误，则系统在重新启动时，会首先查阅这个“事实来源”，输出主题，来判断事件是否已经发布出去。</p>\n<p>如果在输出主题中找到消息，而不是RocksDB（反之亦然），则去重worker将进行必要的修复工作以保持数据库和RocksDB之间的同步。实际上，我们使用输出主题作为我们的预写入日志和最终的事实来源，让RocksDB进行检查和校验。</p>\n<p><strong>在生产环境中</strong></p>\n<p>我们的去重系统已经在生产运行了3个月，对其运行的结果我们感到非常满意。我们有以下这些数据：</p>\n<ul>\n<li>在RocksDB中，有1.5TB的key存储在磁盘上</li>\n<li>在老化旧的key之前，有一个四个星期的去重窗口</li>\n<li>RocksDB实例中存储了大约600亿个key</li>\n<li>通过去重系统的消息达到2000亿条</li>\n</ul>\n<p>该系统快速、高效、容错性强，也非常容易理解。</p>\n<p>特别是我们的v2版本系统相比旧的去重系统有很多优点。</p>\n<p>以前我们将所有的key存储在Memcached中，并使用Memcached的原子CAS（check-and-set）操作来设置key。 Memcached起到了提交点和“原子”地发布key的作用。</p>\n<p>虽然这个功能很好，但它需要有大量的内存来支撑所有的key。此外，我们必须能够接受偶尔的Memcached故障，或者将用于高速内存故障切换的支出加倍。</p>\n<p>Kafka/RocksDB的组合相比旧系统有如下几个优势：</p>\n<p><strong>数据存储在磁盘上</strong>：在内存中保存所有的key或完整的索引，其代价是非常昂贵的。通过将更多的数据转移到磁盘，并利用多种不同级别的文件和索引，能够大幅削减成本。对于故障切换，我们能够使用冷备（EBS），而不用运行其他的热备实例。</p>\n<p><strong>分区</strong>：为了缩小key的搜索范围，避免在内存中加载太多的索引，我们需要保证某个消息能够路由到正确的worker。在Kafka中对上游进行分区可以对这些消息进行路由，从而更有效地缓存和查询。</p>\n<p><strong>显式地进行老化处理</strong>：在使用Memcached的时候，我们在每个key上设置一个TTL来标记是否超时，然后依靠Memcached进程来对超时的key进行处理。这使得我们在面对大量数据时，可能会耗尽内存，并且在丢弃大量超时消息时，Memcached的CPU使用率会飙升。而通过让客户端来处理key的删除，使得我们可以通过缩短去重窗口来优雅地处理。</p>\n<p><strong>将Kafka作为事实来源</strong>：为了真正地避免对多个提交点进行消息去重，我们必须使用所有下游消费者都常见的事实来源。使用Kafka作为“事实来源”是最合适的。在大多数失败的情况下（除了Kafka失败之外），消息要么会被写入Kafka，要么不会。使用Kafka可以确保按顺序投递消息，并在多台计算机之间进行磁盘复制，而不需要在内存中保留大量的数据。</p>\n<p><strong>批量读写</strong>：通过Kafka和RocksDB的批量I/O调用，我们可以通过利用顺序读写来获得更好的性能。与之前在Memcached中使用的随机访问不同，我们能够依靠磁盘的性能来达到更高的吞吐量，并只在内存中保留索引。</p>\n<p>总的来说，我们对自己构建的去重系统非常满意。使用Kafka和RocksDB作为流媒体应用的原语开始变得越来越普遍。我们很高兴能继续在这些原语之上构建新的分布式应用程序。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111809\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111809votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111809\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "ba6118e0816d19137e375492919002d7", "praise_num": 1, "tags": "职场", "fav_nums": 0, "title": "无我编程的 10 条戒律", "comments_num": 0, "create_date": "2017/07/12", "front_image_url": ["http://wx2.sinaimg.cn/large/7cc829d3gy1fhh7jbexxkj20fa0akwjc.jpg"], "front_image_path": "full/a01ba8722479a3c05e927ef40ac381fcf60c6f35.jpg", "url": "http://blog.jobbole.com/111796/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/tecla\">tecla</a> 翻译，<a href=\"http://www.jobbole.com/members/upanblack\">Panblack</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://blog.codinghorror.com/the-ten-commandments-of-egoless-programming/\">Jeff Atwood</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：无我编程（Egoless Programming）是一种编程风格，不是代码规范，旨在把代码评审中的人为因素最小化，应当在一个友好、合议方式进行，个人感情放一边，从而提高代码质量。</p>\n<p>在《<a href=\"https://www.amazon.cn/gp/product/B00Z7D9GYG/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B00Z7D9GYG&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">The Psychology of Computer Programming | 程序开发心理学</a>》书中，温伯格首次提出了无我编程十诫。本文则是 Stack Overflow 联合创始人 Jeff Atwood 对这十诫的注解。程序员普遍很自我（ego），都应该看看本文，时刻提醒自己。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhh7jbexxkj20fa0akwjc.jpg\"></p>\n<h3>1. 理解并接受这个事实：人都会犯错</h3>\n<p>关键是在错误引入到产品前，尽早发现。幸运的是，在我们的行业中，除了那些在喷气推进实验室（JPL）开发火箭导航软件的人来说，大多数错误并不要命，所以我们可以并且应该从错误中学习，一笑了之然后向前看。</p>\n<h3>2. 你和你的代码是两回事</h3>\n<p>切记，审查代码是为了找出问题，问题当然会被发现。当发现问题时，别有情绪，别往心里去。</p>\n<h3>3. 天外有天，人外有人</h3>\n<p>三人行必有我师焉。寻求并且接受其他人的意见，特别是当你认为不必要的时候。</p>\n<h3>4. 不要盲目地重写代码</h3>\n<p>修改代码和重写代码，两者有明确的界限。搞清楚区别，通过代码审查，改变代码风格，而不是做一个孤独的执行者。</p>\n<h3>5. 以尊重、敬意、耐心对待非技术人员</h3>\n<p>经常和程序员打交道的非技术人员普遍认为程序员充其量不过是一群自负的人，还是爱哭的娇气包。不要用生气和不耐烦强化这种偏见。</p>\n<h3>6. 惟有改变方永恒</h3>\n<p>以开放的态度对待改变并用微笑接受改变。将每一次需求、平台、工具的改变看作一个新挑战，而不是一些要反对的麻烦。</p>\n<h3>7. 真正且唯一的权威来自知识，不是地位</h3>\n<p>知识带来权威，权威带来尊敬。所以如果想在无我的环境里获得尊敬，那么请增长知识。</p>\n<h3>8. 为信仰战斗，但也要优雅地接受失败</h3>\n<p>要清楚，有时候你的想法会被否定。即使结果证明你是对的，不要报复，或者最多说几次‘我早就告诉过你’，不要让你过去的想法成为殉道者或者战斗口号。</p>\n<h3>9. 不要做个死宅</h3>\n<p>不要成为一直在小黑屋里编程，只在买可乐时出现的人。这样的人不与人接触，不被重视，不受控制并且不能融入开放合作的环境。</p>\n<h3>10. 对事不对人</h3>\n<p>要批评的是代码，不是写代码的人。尽可能让评论正面，并且只关注于提升代码。评论只涉及内部标准、编程规范、提升性能等等方面。</p>\n<p> </p>\n<p>软件的人性标准是永不过时的，《<a href=\"https://www.amazon.cn/gp/product/B00Z7D9GYG/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B00Z7D9GYG&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">The Psychology of Computer Programming | 程序开发心理学</a>》英文版早在 1971 年出版了，正好是我出生后第二年。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111796\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111796votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111796\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/tecla\">tecla</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/tecla\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/e7e39d569b983a82c96dbebcc426da0f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢逻辑，虽然不是很精通，喜欢英语，虽然不是都能完全理解。不是聪明人，但是希望能成为快乐的奋斗人。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/tecla\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/tecla/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/tecla/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"QQ：1942295950\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：ting-lyu\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/xiangshang\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "b7afdd1e2e7420b9ab8f1ad96f32df50", "praise_num": 1, "tags": "C/C++", "fav_nums": 2, "title": "用 C 语言写一个简单的 Unix Shell（1）", "comments_num": 0, "create_date": "2017/07/06", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/746b03c66c6e4568ab9770632e5c69e9.jpg"], "front_image_path": "full/6a97cfe7f7f14e4e38447a57e0284a25fe3ecdad.jpg", "url": "http://blog.jobbole.com/111738/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/qdoverture\">效楚</a> 翻译，<a href=\"http://www.jobbole.com/members/upanblack\">Panblack</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://indradhanush.github.io/blog/writing-a-unix-shell-part-1/\">Indradhanush Gupta</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：作者用 C 语言实现了一个简易的unix shell，通过本文可加深对 shell 和 Unix 系统原理的理解。</p>\n<hr>\n<p>写 Unix shell 是我正在 RC 研究的一个项目。这是第一部分，后续会有一系列的文章。</p>\n<p><strong>免责声明：我不是编写 shell 这个课题的专家，我是一边自学一边分享我的发现。</strong></p>\n<h2>shell 是什么？</h2>\n<p>关于这一点已经有很多书面资料，所以对于它的定义我不会探讨太多细节。只用一句话说明：</p>\n<blockquote><p>shell 是允许你与操作系统的核心作交互的一个界面（interface）。</p></blockquote>\n<h2 id=\"how-does-a-shell-work\">shell 是怎样工作的？</h2>\n<p>shell解析用户输入的命令并执行它。为了能做到这一点，shell的工作流程看起来像这样：</p>\n<ol>\n<li style=\"padding-left: 30px;\">启动shell</li>\n<li style=\"padding-left: 30px;\">等待用户输入</li>\n<li style=\"padding-left: 30px;\">解析用户输入</li>\n<li style=\"padding-left: 30px;\">执行命令并返回结果</li>\n<li style=\"padding-left: 30px;\">回到<span style=\"color: #808080;\">第 2 步</span>。</li>\n</ol>\n<p>但在这整个流程中有一个重要的部分：<strong>进程</strong>。shell是父进程。这是我们的程序的<span style=\"color: #808080;\">主</span>线程，它等待用户输入。然而，由于以下原因，我们不能在<span style=\"color: #808080;\">主</span>线程自身中执行命令：</p>\n<ol>\n<li style=\"padding-left: 30px;\">一个错误的命令会导致整个shell停止工作。我们要避免此情况。</li>\n<li style=\"padding-left: 30px;\">独立的命令应该有他们自己的进程块。这被称为隔离，属于容错（机制）。</li>\n</ol>\n<h2 id=\"fork\">Fork</h2>\n<p>为了能避免此情况，我们使用系统调用 <span style=\"color: #808080;\">fork</span>。我曾以为我理解了 <span style=\"color: #808080;\">fork</span>，直到我用它写了大约4行代码（才发现我没有理解）。</p>\n<p><code class=\"highlighter-rouge\"></code><span style=\"color: #808080;\">fork</span> 创建当前进程的一份拷贝。这份拷贝被称为<span style=\"color: #808080;\">“子进程”</span>，系统中的每个进程都有与它联系在一起的唯一的进程 id（pid）。让我们看以下代码片段：</p>\n<p><a href=\"https://indradhanush.github.io/code/shell-part-1/fork.c\"><i>fork.c</i></a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-596572af05a80654847056\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;unistd.h&gt;\r\n\r\nint\r\nmain() {\r\n    pid_t child_pid = fork();\r\n        \r\n    // The child process\r\n    if (child_pid == 0) {\r\n        printf(\"### Child ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    } else {\r\n        printf(\"### Parent ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    }\r\n \r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a80654847056-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a80654847056-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a80654847056-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a80654847056-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a80654847056-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a80654847056-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a80654847056-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a80654847056-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a80654847056-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a80654847056-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a80654847056-2\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-3\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a80654847056-4\"> </div><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-5\"><span class=\"crayon-t\">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a80654847056-6\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a80654847056-8\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// The child process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a80654847056-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Child ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a80654847056-12\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a80654847056-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Parent ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-15\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a80654847056-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-17\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a80654847056-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a80654847056-19\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p><span style=\"color: #808080;\">fork</span> 系统调用返回两次，每个进程一次。这一开始听起来是反直觉的。但让我们看一下在底层发生了什么。</p>\n<ol>\n<li style=\"padding-left: 30px;\">通过调用 <span style=\"color: #808080;\">fork</span>，我们在程序中创建了一个新的分支。这与传统的 <span style=\"color: #808080;\">if-else</span> 分支不同。<span style=\"color: #808080;\">fork</span> 对当前进程创建一份拷贝并从中创建了一个新的进程。最终系统调用返回子进程的进程 id。</li>\n<li style=\"padding-left: 30px;\">一旦 <span style=\"color: #808080;\">fork</span> 调用成功，子进程和父进程（我们的代码的主线程）会同时运行。</li>\n</ol>\n<p>为了让你更好理解程序流程，看这个图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/309a7a84764a07033c28b6ce5511c45c.jpg\"><img class=\"alignnone wp-image-65028 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/309a7a84764a07033c28b6ce5511c45c.jpg\" alt=\"fork\" width=\"594\" height=\"442\"></a></p>\n<p><span style=\"color: #808080;\">fork()</span> 创建了一个新的子进程，但与此同时，父进程的执行并没有停止。子进程执行的开始和结束独立于父进程，反之亦然。</p>\n<p>更进一步讨论以前，先说明一点：<span style=\"color: #808080;\">getpid</span> 系统调用返回当前的进程 id。</p>\n<p>如果你编译并执行这段代码，会得到类似于下面的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-596572af05a8b701340687\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### Parent ###\r\nCurrent PID: 85247 and Child PID: 85248\r\n### Child ###\r\nCurrent PID: 85248 and Child PID: 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596572af05a8b701340687-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a8b701340687-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a8b701340687-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a8b701340687-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596572af05a8b701340687-1\"><span class=\"crayon-p\">### Parent ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a8b701340687-2\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85247</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85248</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a8b701340687-3\"><span class=\"crayon-p\">### Child ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a8b701340687-4\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85248</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在 <span style=\"color: #808080;\">### Parent ###</span> 下面的片段中，当前进程 ID 是 <span style=\"color: #808080;\">85247</span>，子进程 ID 是 <span style=\"color: #808080;\">85248</span>。注意，子进程的 pid 比父进程的大，表明子进程是在父进程之后创建的。（更新：正如某人在 <a href=\"https://news.ycombinator.com/item?id=14439781\">Hacker News</a> 上正确指出的，这并不是确定的，虽然往往是这样。原因在于，操作系统可能回收无用的老进程 id。）</p>\n<p>在 <span style=\"color: #808080;\">### Child ###</span> 下面的片段中，当前进程 ID 是 <span style=\"color: #808080;\">85248</span>，这与前面片段中子进程的 pid 相同。然而，这里的子进程 pid 为 <span style=\"color: #808080;\">0</span>。</p>\n<p>实际的数字会随着每一次执行而变化。</p>\n<p>你可能在想，我们已经在<span style=\"color: #808080;\">第 9 行</span>明确的给 child_pid 赋了一个值<span style=\"color: #808080;\">（译者注：应该是第7行）</span>，那么 <span style=\"color: #808080;\">child_pid</span> 怎么会在同一个执行流程中呈现两个不同的值，这种想法值得原谅。但是，回想一下，调用 <span style=\"color: #808080;\">fork</span> 创建了一个新进程，这个新进程与当前进程相同。因此，在父进程中，<span style=\"color: #808080;\">child_pid</span> 是刚创建的子进程的实际值，而子进程本身没有自己的子进程，所以 <span style=\"color: #808080;\">child_pid</span> 的值为 <span style=\"color: #808080;\">0</span>。</p>\n<p>因此，为了控制哪些代码在子进程中执行，哪些又在父进程中执行，需要我们在 12 到 16 行定义的 <span style=\"color: #808080;\">if-else</span> 块<span style=\"color: #0000ff;\">（译者注：应该是 10 到 16 行）</span>。当 <span style=\"color: #808080;\">child_pid</span> 为 <span style=\"color: #808080;\">0</span> 时，代码块将在子进程下执行，而 else 块却会在父进程下执行。这些块被执行的顺序是不确定的，取决于操作系统的调度程序。</p>\n<h2>引入确定性</h2>\n<p>让我向你介绍系统调用 <span style=\"color: #808080;\">sleep</span>。引用 linux man 页面的话：</p>\n<blockquote><p>sleep – 暂停执行一段时间</p></blockquote>\n<p>时间间隔以秒为单位。</p>\n<p>让我们给父进程，即我们代码中的 else 块，加一个 sleep(1) 调用：</p>\n<p><a href=\"https://indradhanush.github.io/code/shell-part-1/sleep_parent.c\"><i>sleep_parent.c</i></a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-596572af05a91566973636\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;unistd.h&gt;\r\n\r\nint\r\nmain() {\r\n    pid_t child_pid = fork();\r\n\r\n    // The child process\r\n    if (child_pid == 0) {\r\n        printf(\"### Child ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    } else {\r\n        sleep(1); // Sleep for one second\r\n        printf(\"### Parent ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    }\r\n \r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a91566973636-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a91566973636-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-2\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-3\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-4\"> </div><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-5\"><span class=\"crayon-t\">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-6\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-8\"> </div><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// The child process</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Child ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-12\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Sleep for one second</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Parent ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-16\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-18\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-596572af05a91566973636-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a91566973636-20\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>当你执行这段代码时，输出将类似这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-596572af05a95463662559\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### Child ###\r\nCurrent PID: 89743 and Child PID: 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596572af05a95463662559-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a95463662559-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596572af05a95463662559-1\"><span class=\"crayon-p\">### Child ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a95463662559-2\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">89743</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>1秒钟以后，你将看到</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-596572af05a98375009232\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### Parent ###\r\nCurrent PID: 89742 and Child PID: 89743</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596572af05a98375009232-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a98375009232-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596572af05a98375009232-1\"><span class=\"crayon-p\">### Parent ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a98375009232-2\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">89742</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">89743</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>每次执行这段代码时你会看到同样的表现。这是因为：我们在父进程中做了一个阻塞性的 <span style=\"color: #808080;\">sleep</span> 调用，与此同时，操作系统调度程序发现有空闲的 CPU 时间可以给子进程执行。</p>\n<p>类似的，如果你反过来，把 <span style=\"color: #808080;\">sleep(1)</span> 调用加到子进程，也就是我们代码中的 <span style=\"color: #808080;\">if</span> 块里面，你会发现父进程块立刻输出到控制台上。但你也会发现程序终止了。子进程块的输出被转存到<span style=\"color: #808080;\">标准输出</span>。看起来是这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-596572af05a9b149548579\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ gcc -lreadline blog/sleep_child.c -o sleep_child &amp;&amp; ./sleep_child\r\n### Parent ###\r\nCurrent PID: 23011 and Child PID: 23012\r\n$ ### Child ###\r\nCurrent PID: 23012 and Child PID: 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596572af05a9b149548579-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a9b149548579-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a9b149548579-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05a9b149548579-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596572af05a9b149548579-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596572af05a9b149548579-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">lreadline </span><span class=\"crayon-v\">blog</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sleep_child</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sleep_child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sleep_child</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a9b149548579-2\"><span class=\"crayon-p\">### Parent ###</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a9b149548579-3\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23011</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23012</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05a9b149548579-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">### Child ###</span></div><div class=\"crayon-line\" id=\"crayon-596572af05a9b149548579-5\"><span class=\"crayon-e\">Current </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23012</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">Child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>这段源代码可在 <a href=\"https://indradhanush.github.io/code/shell-part-1/sleep_child.c\">sleep_child.c</a> 获取。</p>\n<p>这是因为父进程在 <span style=\"color: #808080;\">printf</span> 语句之后无事可做，被终止了。然而，子进程在 <span style=\"color: #808080;\">sleep</span> 调用处被阻塞了 1 秒钟，之后才执行 <span style=\"color: #808080;\">printf</span> 语句。</p>\n<h2>正确实现的确定性</h2>\n<p>然而，使用 <span style=\"color: #808080;\">sleep</span> 来控制进程的执行流程不是最好的方法，因为你做了一个 <span style=\"color: #808080;\">n 秒</span>的 <span style=\"color: #808080;\">sleep</span> 调用：</p>\n<ol>\n<li style=\"padding-left: 30px;\">你怎么确保不管你等待的是什么，都会在 <span style=\"color: #808080;\">n 秒</span>内完成执行呢？</li>\n<li style=\"padding-left: 30px;\">不管你等待的是什么，要是它在远远早于 <span style=\"color: #808080;\">n 秒</span>时就结束了呢？在此情况下你不必要地闲置了。</li>\n</ol>\n<p>有一种更好的方法是，使用 <span style=\"color: #808080;\">wait</span> 系统调用（或一种变体）来代替。我们将使用 <span style=\"color: #808080;\">waitpid</span> 系统调用。它带有以下参数：</p>\n<ol>\n<li style=\"padding-left: 30px;\">你想要程序等待的进程的进程 ID。</li>\n<li style=\"padding-left: 30px;\">一个变量，用来保存进程如何终止的相关信息。</li>\n<li style=\"padding-left: 30px;\">选项标志，用来定制 <span style=\"color: #808080;\">waitpid</span> 的行为</li>\n</ol>\n<p><a href=\"https://indradhanush.github.io/code/shell-part-1/wait.c\"><i>wait.c</i></a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-596572af05aa0837383335\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;unistd.h&gt;\r\n#include &lt;sys/wait.h&gt;\r\n\r\nint\r\nmain() {\r\n    pid_t child_pid;\r\n    pid_t wait_result;\r\n    int stat_loc;\r\n\r\n    child_pid = fork();\r\n        \r\n    // The child process\r\n    if (child_pid == 0) {\r\n        printf(\"### Child ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n        sleep(1); // Sleep for one second\r\n    } else {\r\n        wait_result = waitpid(child_pid, &amp;stat_loc, WUNTRACED);\r\n        printf(\"### Parent ###nCurrent PID: %d and Child PID: %dn\",\r\n               getpid(), child_pid);\r\n    }\r\n \r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-596572af05aa0837383335-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-596572af05aa0837383335-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-2\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-3\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-4\"><span class=\"crayon-p\">#include &lt;sys/wait.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-6\"><span class=\"crayon-t\">int</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-7\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">wait_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat_loc</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-13\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// The child process</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Child ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-17\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Sleep for one second</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wait_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">waitpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">stat_loc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WUNTRACED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"### Parent ###nCurrent PID: %d and Child PID: %dn\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-22\"><span class=\"crayon-h\">               </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-24\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-596572af05aa0837383335-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-596572af05aa0837383335-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>当你执行这段代码，你会发现子进程块立刻被打印，然后等待很短的一段时间（这里我们在 <span style=\"color: #808080;\">printf</span> 后面加了 <span style=\"color: #808080;\">sleep</span>）。父进程等待子进程执行结束，之后就有空执行它自己的命令。</p>\n<p>第一部分到此结束。这篇博客中的所有代码示例可以在<a href=\"https://github.com/indradhanush/indradhanush.github.io/tree/master/code/shell-part-1/\">这里</a>获取。在<a href=\"https://indradhanush.github.io/blog/writing-a-unix-shell-part-2/\">下一篇</a>中，我们将研究怎样在用户输入时接受命令并执行它。敬请期待。</p>\n<p><strong>致谢</strong></p>\n<p>谢谢 <a href=\"https://github.com/saulpw\">Saul Pwanson</a> 帮助我理解 <span style=\"color: #808080;\">fork</span> 的表现方式，谢谢 <a href=\"https://github.com/jaseemabid\">Jaseem Abid</a> 阅读草稿并提出编辑建议。</p>\n<p id=\"resources\"><strong>参考资料</strong></p>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=k6TTj4C0LF0\">EnthusiastiCon – Stefanie Schirmer：《天哪！在 10 分中内构建一个 shell”</a>》</li>\n<li><a href=\"https://linux.die.net/man/\">Linux man 页面</a></li>\n</ul>\n<p>99e05c43dc61c56cbc182203.jpeg”&gt;</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/8204a635b9f0335c5b2e27498c3d5c97.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/0fbc02d33dc26bbfebc27f81bea9cdf9.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111738\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111738votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111738\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture\">效楚</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/72a13d3690f7c6edc018286f0ae732f6.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            本职工作是IC设计，工作中也经常做脚本编写、嵌入式编程等，对软件和文字翻译亦有浓厚的兴趣。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/qdoverture\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/qdoverture/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "fac35b12c02fb27f44780851ac24f152", "praise_num": 2, "tags": "IT技术", "fav_nums": 3, "title": "每个程序员都需要知道一些游戏网络知识", "comments_num": 0, "create_date": "2017/07/03", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/c39de1bb884eaa81287bd08dab06403d.jpg"], "front_image_path": "full/41b4657e9821155bd3325ef1334ebce10189b7f6.jpg", "url": "http://blog.jobbole.com/111711/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://gafferongames.com/networking-for-game-programmers/what-every-programmer-needs-to-know-about-game-networking/\">GLENN FIEDLER</a>   译文出处：<a target=\"_blank\" href=\"https://my.oschina.net/u/1859679/blog/911474\">wier</a>   </div><p>这是一篇翻译文章，主要针对游戏的网络设计，目前主流的网络游戏实现方案都有讲解，如果对英文更感兴趣，请查看原文地址，你若是觉得有翻译不妥的地方，欢迎留言指正。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/c39de1bb884eaa81287bd08dab06403d.jpg\"><img class=\"aligncenter wp-image-111712 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/c39de1bb884eaa81287bd08dab06403d.jpg\" alt=\"084635_zdwT_1859679\" width=\"900\" height=\"500\"></a></p>\n<p>作为一个程序员，你有没有想象过多人游戏是如何实现的？</p>\n<p>在外行人看来游戏很神奇：两个或者更多的玩家在网络上分享共同的经历，就像他们真实的存在于相同的虚拟的世界一样。游戏看起来犹如一个巨大的魔术，奇妙而又刺激，但作为一个开发人员我们知道，真实的情况和我们所看到的并不一样，那只是一种错觉。你感受到的共享现实，实际上是在那个时刻内，由你自己的独特视角和位置所感知的近似情况。</p>\n<h1 id=\"h1_0\"><strong>Peer-to-Peer 帧同步</strong></h1>\n<p>最初的游戏是通过peer-to-peer来联网的，每个计算机通过网状拓扑的结构的彼此连接并交换信息。你仍然可以看到这种模型存在于RTS游戏中，而且基于某些原因它还很有趣，也许是因为它是大多数人认为游戏网络工作方式的第一种方式。</p>\n<p>处理游戏信息的基本思想就是把游戏的数据抽象并转换成一系列命令消息，当处理每个转换的时候就直接演变为游戏的状态。比如:移动单位、攻击物体、建造建筑。这一切都需要在线的每个玩家机器，从一个初始化命令开始之后，都运行完全相同的命令和转换数据。</p>\n<p>当然了，这只是一个过于简单的解释，同时也隐去了很多细节，不过我们通过这个基本的思路可以知道RTS游戏的网络是如何工作的。如果你想知道更多网络模型，请点击:<a href=\"http://www.gamasutra.com/view/feature/3094/1500_archers_on_a_288_network_.php\" target=\"_blank\" rel=\"nofollow\">1500 Archers on a 28.8: Network Programming in Age of Empires and Beyond</a>.</p>\n<p>这些看起来是如此简单和优雅，但不幸的它们有几个因素限制者我们。</p>\n<p>第一个限制，要保证游戏状态完全确定一致的是异常困难，特别是保持每台机器上每个转换输出都保持相同。比如，一个单位在两台机器上有略微不同的路径，在一台机器上早一些到达并开始了战斗，结果反败为胜，而在另一台机器上，由于稍微晚一些到达而失败。就像一只蝴蝶扇动了翅膀，然后在世界的另一边导致了飓风的出现，随着时间的推移，一个微小的区别就会导致两边完全的不同步。</p>\n<p>第二个限制，为了保证游戏的所有玩家输出一致，这就需要等到所有玩家的当前回合数据都到达之后才可以模拟播放这一回合动作。这就意味着游戏中的每一个玩家都需要等待网络延迟最高的那个玩家。RTS游戏通常代表性地通过立即提供音频反馈与（或是）播放吟唱（过渡）动画来掩盖这段延迟，但是最终真正影响游戏的动作要在这段延迟过去之后才能进行。</p>\n<p>第三个限制，因为游戏中状态改变的同步是通过发送命令信息来同步的。所以为了游戏中玩家状态都一致，需要所有的玩家都要从相同的初始状态来开始游戏。这意味着每个玩家必须在开始游戏之前先加入房间然后一起开始游戏，尽管理论上也可以支持让某些玩家晚些加入游戏，但是在一场进行中的游戏中获得一个完全确定的起始点的难度相当大，所以这种情况并不常见。</p>\n<p>尽管有这些因素限制困扰者我们，不过这个模型还是很适合RTS游戏的，并且它仍然存在于今天的游戏当中，例如“<strong>Command and Conquer</strong>”、“<strong>Age of Empires</strong>”与“<strong>Starcraft</strong>”等。原因就是在RTS游戏中，里面包含了上千多的单位，这些单位都有自己的状态需要同步，而且他们数据量都太大了，很难用来在玩家之间交换。别无选择，我们只能通过这些游戏状态改变的命令来同步。</p>\n<p>所以以上这些就是 peer-to-peer 帧同步的网路游戏模型的介绍了，对于其他类型的游戏，最先进的技术已经开始出现了。让我们现在从<strong>Doom</strong>, <strong>Quake </strong>以及 <strong>Unreal</strong>经典游戏中开始一起观察动作游戏的技术演化。</p>\n<h1 id=\"h1_1\"><strong>客户端/服务器（c/s架构）</strong></h1>\n<p>在动作游戏的时代，以上帧同步的限制在<strong>Doom </strong>游戏中变得更加明显，尽管在局域网中体验还不错，但在对于互联网的用户来说它体验太糟糕了：</p>\n<p>尽管可以使用一个猫（调制解调器）把两个<strong>Doom </strong>机器通过互联网连接在一起，但他们一起游戏会异常缓慢。范围从无法游戏（例如:14.4Kbps PPP 连接)到稍微可以玩(例如 ：28.8Kbps 猫运行一个被SLIP驱动压缩的数据)之间游戏联机都异常缓慢。由于这些连接方式只是边际效用，本文将仅关注直接的网络连接。</p>\n<p>这个问题是因为Doom网络部分本来就是只为局域网而设计的，并且使用了前面介绍的peer-to-peer 帧同步模型。每一回合每个玩家的输入的信息（比如关键按键等）都与其他人进行同步通知，并且任何玩家在播放这一帧动画之前，必须得等到所有其他玩家的关键按键信息都被接收到，才可以去模拟播放。</p>\n<p>也就是说，在你可以转身（转换），移动或者射击之前，你必须等待延迟最大的猫（调制调解器）玩家的输入。只是想想上述那个人所写的“这些连接方式只是边际效用”就会让人咬牙切齿和沮丧了。</p>\n<p>为了改变这种现状，只能在局域网以及大学网络和大型企业才能获得良好连接而进行游戏，是需要改变这种网络模型了。在1996年，这变成了现实并被实现了，John Carmack当时 发布雷神之锤，他采用客户端/服务器（C/S）架构代替了P2P模型。</p>\n<p>如今游戏中的玩家可以不必再运行相同的代码以及直接相互通信，每个玩家的机器是都是一个“客户端”，他们都通过一台叫做“服务器”的机器进行通信交互。游戏的最终状态确定不再依赖于每台客户端机器来共同确认，而是由服务器来确定最终结果。每个客户端如同一个哑终端，用来展示一个近似值的表演，真是的游戏状态是运行于服务器之上。</p>\n<p>在一个纯粹的c/s架构中，你不必在本地运行游戏代码，而是把一些例如按键、鼠标移动，点击等输入信息发送到服务器。服务器会在游戏世界中更新你的玩家状态，然后再封包一个包含你角色信息以及临近玩家数据的包回复给你的客户端。所有的客户端在每个消息更新的间隙做一个插值预测，以改善在每个状态更新期间，物体可以平滑的移动，如此，你就有一个可以联网的客户端/服务器架构的游戏了。</p>\n<p>这已经是向前迈出了极大的一步。游戏的体验依赖于客户端和服务器的连接，而不是游戏中延迟最大的那个玩家。如此可以支持玩家在游戏中自由的进入和退出，同时由于客户端/服务器降低了平均每位玩家的带宽，从而可以增加更多的在线玩家。</p>\n<p>但是这里仍然有一些问题存在于 c/s 架构中:</p>\n<p>我记得我交代了所有从DOO到Quake中关于网络的决策，但是重要的是我正在使用错误的假设来做一个好的网络游戏。我原先设计的目标是网络延迟&lt;200ｍs。人们通过一个好的网络供应商连接互联网，从而可以获得一个好的游戏体验。但事与愿违，世界上99%的用户使用猫(调制调解器)通过 slip或者ppp 进行连接，而他们常常都会通过槽糕而又拥挤的ISP。这会带来最低300+ms 的 网络延迟。一个消息要经过，客户端&gt;用户猫&gt;ISP猫&gt;服务器&gt;ISP猫&gt;用户猫&gt;客户端。上帝，这太逊了。</p>\n<p>OK,我做了一个错误的设定。我在家里使用T1 宽带，所以我只是不了解在PPP网络下的生活。我现在就解决它。</p>\n<p>这个问题当然是延迟。</p>\n<p>接下来John在他发布QuakeWorld的时候将改变这个行业。</p>\n<h1 id=\"h1_2\"><strong>客户端预测（<strong>Client-Side Prediction</strong>）</strong></h1>\n<p>在原来的Quake游戏中，你会感觉到电脑与服务器之间的延迟。比如，你按键向前移动，在你真正移动之前，你需要等到数据包发送服务器然后再回复到你的客户端，你才可以真正的移动。按键开火，在你的射击之前同样需要相同的等待。</p>\n<p>如果你玩过任何FPS游戏，比如:Modern Warfar,你会发现并没有延迟发生。那么fps游戏是如何做到在多人情况下，你的动作看起来并没有延迟？</p>\n<p>这个问题被分为两个部分来解决。第一个部分是客户端移动预测，这事John Carmack 为 QuakeWorld游戏多开发的，后来被合并到了Tim Sweeney的虚幻网络模块。第二个部分就是延迟补偿，它是有Valve公司的Yahn Bernier在Counterstrike所开发。那么在这个章节，我们把焦点放在第一部分——隐藏用户移动的延迟。</p>\n<p>当写到关于他即将发布的QuakeWorld计划的时候，John Carmack 讲到:</p>\n<p>我现在允许客户端可以预测用户的移动，直到服务器的权威信息回复之前。这是一个重大的结构变更。客户端需要知道关于对象的硬度、摩擦力、重力等一系列基础属性。我很伤心的看到，客户端仅作为一个终端存在将会离开，但作为一个实用主义者，我必须超越这种理想情怀。</p>\n<p>那么现在我们为了消除延迟，客户端需要运行更多的代码。它现在不再是一个只把输入发送给服务器然后再把返回信息进行插入的哑终端。现在客户端的机器可以运行一部分游戏代码，它可以在本地预测你的角色移动并且可以即时响应你的输入。</p>\n<p>现在当你即刻按键向前，你的游戏会立刻向前移动，不会再去等待数据往返一次客户端和服务器之间才来回应你的操作。</p>\n<p>这种方式的难点不在于预测，这种预测工作，就像正常的游戏代码一样 —— 根据玩家的输入，及时地更新游戏角色的状态。而难点在于，当客户端和服务器对于玩家角色所做的事情（动作）核检不一致的时候，客户端如何基于服务器信息进行更正。</p>\n<p>现在你会想，hey，如果代码运行在客户端——为何不以客户端的信息为准？客户端可以自己的为角色模拟运行代码，并且只需要在每次发送数据包时告知服务器这些信息。如果每个客户端都对服务器发送相同的信息，告诉服务器“这是我现在的位置信息”，那么将会带来这样的问题。客户端会很容易被黑客攻击并控制，这样在RPG游戏中，一个作弊便可以立即躲避对方技能击中，或者当你射击的时候瞬间移动到你的身后。</p>\n<p>所以在FPS游戏中，尽快每个玩家的客户端可以预测他们自己的角色进行操作移动，但最终每个玩家的角色状态绝对以服务器为准。就像Tim Sweeney 在所写的文章<a href=\"http://unreal.epicgames.com/Network.htm\" target=\"_blank\" rel=\"nofollow\">The Unreal Networking Architecture</a>中描述的一样：“服务器才是主人”。</p>\n<p>这就是有趣的地方。如果客户端和服务器产生了不一致，客户端必须基于服务器的信息为准并更新，但是由于客户端和服务器之前有延迟，服务器的修正必然是过去的动作。比如，如果信息从客户端到服务器耗时100ms，然后返回又耗时100ms，那么任何服务器的的修正都是客户端200ms之前的行为动作，这个时间正好是客户端预测角色移动的时间。</p>\n<p>如果客户端每个动作都会被服务器修正，那么你将会看客户端被拉回了原先的位置，如此客户端将做不了任何预先预测的运算。那么我们如何解决这个问题，依然可以保持客户端提前预测？</p>\n<p>解决方案就是在客户端创建一个buffer，然后用来循环保持角色的状态以及本来玩家的输入。当客户端收到了服务器的更正信息时候，它首先丢弃掉buffer里面比（服务器回复的）更正状态要老的状态信息，然后基于（更正的）正确的状态重放存储在buffer里面的输入信息，重发的这些输入信息的范围是从正确状态到当前预测时间之间。如此实际上，客户端只是看似无形中“倒带和重放”当地玩家角色运动的最后n帧，同时保持世界其他地方没有变化。</p>\n<p>这种方法可以让玩家感觉在控制游戏的时候没有延迟，同时也改善了客户端和服务器之间代码运行的一致性——在同等输入的情况下保持一致的结果。当然了，修正的情况很少发生，Tim Sweeney 如此描述:</p>\n<p>…对于客户端和服务器最好的是：所有情况下，服务器都是权威的。几乎所有的时间，客户端模拟的和服务器的数据都是一致，所以客户端的位置很少被修正。只有的少数罕见的情况下，例如一个玩家被火箭击中，或者和一个敌人（怪物）碰撞上，那么客户端本地的情况有可能需要被修正。</p>\n<p>也就是说，只有当玩家的角色被一些外部事件影响玩家的输入，并且这些不能被客户端预测时，玩家的位置（行为）需要被服务器修正。当然，如果玩家试图作弊，必然会被服务器修正。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111711\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111711votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111711\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "345014f87e74ee252ce7be279d54c7b4", "praise_num": 1, "tags": "IT技术", "fav_nums": 1, "title": "LevelDB 实现分析", "comments_num": 0, "create_date": "2017/07/10", "front_image_url": ["https://gw.alicdn.com/tfs/TB1R1S4SXXXXXaRXpXXXXXXXXXX-900-500.jpg"], "front_image_path": "full/80cecbf79a5f06eb7460152bae80cab5d6f499f7.jpg", "url": "http://blog.jobbole.com/111792/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://taobaofed.org/blog/2017/07/04/leveldb-analysis/\">胡帅</a>   </div><p><img class=\"aligncenter\" src=\"https://gw.alicdn.com/tfs/TB1R1S4SXXXXXaRXpXXXXXXXXXX-900-500.jpg\" alt=\"LevelDB 实现分析\"></p>\n<h3 id=\"LevelDB-介绍\">LevelDB 介绍</h3>\n<p>LevelDB 是由 Google 开发的 key-value 非关系型数据库存储系统，是基于 LSM(Log-Structured-Merge Tree) 的典型实现，LSM 的原理是：当读写数据库时，首先纪录读写操作到 Op log 文件中，然后再操作内存数据库，当达到 checkpoint 时，则写入磁盘，同时删除相应的 Op log 文件，后续重新生成新的内存文件和 Op log 文件。</p>\n<p>LevelDB 内部采用了内存缓存机制，也就是在写数据库时，首先会存储在内存中，内存的存储结构采用了 skip list 结构，待达到 checkpoint 时，才进行落盘操作，保证了数据库的高效运转。</p>\n<h3 id=\"LevelDB-总体架构\">LevelDB 总体架构</h3>\n<p><img class=\"aligncenter\" src=\"https://gw.alicdn.com/tfs/TB1AMqNSXXXXXczXFXXXXXXXXXX-851-479.png\" alt=\"resources structure\"></p>\n<p>如上图所示，整个 LevelDB 由以下几部分组成：</p>\n<ol>\n<li>Write(k,v)，对外的接口</li>\n<li>Op log，操作日志记录文件</li>\n<li>memtable，数据库存储的内存结构</li>\n<li>Immutable memtable，待落盘的数据库内存数据</li>\n<li>sstable，落盘后的磁盘存储结构</li>\n<li>manifest，LevelDB 元信息清单，包括数据库的配置信息和中间使用的文件列表</li>\n<li>current，当前正在使用的文件清单</li>\n</ol>\n<p>整体结构清晰紧凑，非常容易理解。</p>\n<h3 id=\"对外接口\">对外接口</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f5b5e1a2c897218273\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDB() { };\r\nvirtual ~DB();\r\nstatic Status Open(const Options&amp; options,\r\n                   const std::string&amp; name,\r\n                   DB** dbptr);\r\nvirtual Status Put(const WriteOptions&amp; options,\r\n                   const Slice&amp; key,\r\n                   const Slice&amp; value) = 0;\r\nvirtual Status Delete(const WriteOptions&amp; options, const Slice&amp; key) = 0;\r\nvirtual Status Write(const WriteOptions&amp; options, WriteBatch* updates) = 0;\r\nvirtual Status Get(const ReadOptions&amp; options,\r\n                   const Slice&amp; key, std::string* value) = 0;\r\nvirtual Iterator* NewIterator(const ReadOptions&amp; options) = 0;\r\nvirtual const Snapshot* GetSnapshot() = 0;\r\nvirtual void ReleaseSnapshot(const Snapshot* snapshot) = 0;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a2c897218273-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a2c897218273-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a2c897218273-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a2c897218273-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a2c897218273-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a2c897218273-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a2c897218273-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a2c897218273-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a2c897218273-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a2c897218273-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a2c897218273-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a2c897218273-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a2c897218273-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a2c897218273-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a2c897218273-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a2c897218273-1\"><span class=\"crayon-e\">DB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a2c897218273-2\"><span class=\"crayon-v\">virtual</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">DB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a2c897218273-3\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Options</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a2c897218273-4\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a2c897218273-5\"><span class=\"crayon-h\">                   </span><span class=\"crayon-e \">DB*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dbptr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a2c897218273-6\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a2c897218273-7\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a2c897218273-8\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a2c897218273-9\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a2c897218273-10\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">WriteBatch*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">updates</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a2c897218273-11\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReadOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a2c897218273-12\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a2c897218273-13\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e \">Iterator*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewIterator</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReadOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a2c897218273-14\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">Snapshot*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetSnapshot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a2c897218273-15\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ReleaseSnapshot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">Snapshot*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snapshot</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>整体接口分为：</p>\n<p>数据库创建和删除</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f5b5e1a38292164402\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDB() { };\r\nvirtual ~DB();</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a38292164402-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a38292164402-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a38292164402-1\"><span class=\"crayon-e\">DB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a38292164402-2\"><span class=\"crayon-v\">virtual</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-e\">DB</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>数据库打开</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f5b5e1a40032347325\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic Status Open(const Options&amp; options,\r\n                   const std::string&amp; name,\r\n                   DB** dbptr);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a40032347325-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a40032347325-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a40032347325-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a40032347325-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Options</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a40032347325-2\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a40032347325-3\"><span class=\"crayon-h\">                   </span><span class=\"crayon-e \">DB*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dbptr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>数据库读写删除操作</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f5b5e1a44085897879\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvirtual Status Put(const WriteOptions&amp; options,\r\n                   const Slice&amp; key,\r\n                   const Slice&amp; value) = 0;\r\nvirtual Status Delete(const WriteOptions&amp; options, const Slice&amp; key) = 0;\r\nvirtual Status Get(const ReadOptions&amp; options,\r\n                   const Slice&amp; key, std::string* value) = 0;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a44085897879-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a44085897879-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a44085897879-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a44085897879-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a44085897879-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a44085897879-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a44085897879-1\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a44085897879-2\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a44085897879-3\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a44085897879-4\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a44085897879-5\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReadOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a44085897879-6\"><span class=\"crayon-h\">                   </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Slice</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-o\">::</span><span class=\"crayon-t\">string</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>数据库批处理操作</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f5b5e1a47275617524\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvirtual Status Write(const WriteOptions&amp; options, WriteBatch* updates) = 0;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a47275617524-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a47275617524-1\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e\">Status </span><span class=\"crayon-e\">Write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WriteOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">WriteBatch*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">updates</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>数据库遍历操作</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f5b5e1a4a241308009\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvirtual Iterator* NewIterator(const ReadOptions&amp; options) = 0;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a4a241308009-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a4a241308009-1\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-e \">Iterator*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewIterator</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ReadOptions</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>获取快照操作</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f5b5e1a4d456528962\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvirtual const Snapshot* GetSnapshot() = 0;\r\nvirtual void ReleaseSnapshot(const Snapshot* snapshot) = 0;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f5b5e1a4d456528962-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f5b5e1a4d456528962-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f5b5e1a4d456528962-1\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">Snapshot*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetSnapshot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f5b5e1a4d456528962-2\"><span class=\"crayon-e\">virtual </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ReleaseSnapshot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">Snapshot*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snapshot</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h4 id=\"Op-log结构分析\">Op log结构分析</h4>\n<p>LevelDB 使用的 Op log 日志采用了文件记录的方式，且文件使用了 mmap 方式操作，以提高效率。</p>\n<p>Op log 存储切分为 32KB 大小的数据块，每个 32KB 数据块存储着 Op log，每 个Op log 格式如下：</p>\n<p><img src=\"https://gw.alicdn.com/tfs/TB1IRGFSXXXXXbsXVXXXXXXXXXX-405-79.png\" alt=\"resources structure\"></p>\n<p>其中：</p>\n<ol>\n<li>CRC32 为 crc 校验码，保证数据的完整性</li>\n<li>Length，为 Op log 的数据长度</li>\n<li>Log Type，Op log 的类型，之所以会有类型，是由于 32KB 可能存不下一条 Op log，Op log 有可能跨数据块，类型分为：\n<ul>\n<li>FULL：代表 Data 包含了所有的数据</li>\n<li>FIRST：代表该 Data 是 Op log 的开始数据</li>\n<li>MIDDLE：代表该 Data 是 Op log 的中间数据</li>\n<li>LAST: 代表该 Data 是 Op log 的结束数据</li>\n</ul>\n</li>\n<li>Data，为 Op log 的实际数据</li>\n</ol>\n<h4 id=\"memtable-结构分析\">memtable 结构分析</h4>\n<p>memtable 是 LevelDB 数据库的内存存储结构，采用了 skip list 结构存储，如下图所示：</p>\n<blockquote><p>skip list 是一种可以代替平衡树的存储结构，它采用概率的方式来保证平衡，而平衡树则是采用严格的旋转树结构来保证平衡，复杂度会高一些。<br>\n对于 skip list，会有 n 层链表，其中 0 层保存所有的值，越往上层，保存的值越少。每当插入一个值时，会通过概率计算该值需要插入的最高层级 k，然后从 0~k-1 层，分别插入该值。</p></blockquote>\n<p><img src=\"https://gw.alicdn.com/tfs/TB1aoiISXXXXXX4XVXXXXXXXXXX-941-359.png\" alt=\"resources structure\"></p>\n<p>其中每个表项的存储结构如下：</p>\n<p>key_size | key_value | sequence_num&amp;type | value_size | value</p>\n<p>其中：</p>\n<p>sequence_num：表示操作的序列号，每一个数据项都会带有一个序列号，用以表示数据的新旧程度。</p>\n<p>type：表示数据的类型，分为：</p>\n<ul>\n<li>kTypeValue：表明数据有效</li>\n<li>kTypeDeletion：表明数据已经失效，在数据进行 delete 操作时会打上该标识</li>\n</ul>\n<h4 id=\"sstable-结构分析\">sstable 结构分析</h4>\n<p>sstable 作为落盘的存储结构，每个 sstable 最大 2MB，从宏观来看，它属于分层的结构，即：</p>\n<ul>\n<li>level 0：最多存储 4 个 sstable</li>\n<li>level 1：存储不超过 10MB 大小的 sstable</li>\n<li>level 2：存储不超过 100MB 大小的 sstable</li>\n</ul>\n<p>level 3 及之后：存储大小不超过上一级大小的 10 倍</p>\n<p>之所以这样分层，是为了提高查找效率，也是 LevelDB 名称的由来。当每一层超过限制时，会进行 compaction 操作，合并到上一层，递归进行。</p>\n<p>从微观的角度看，每个 sstable 文件结构入下图所示：</p>\n<p><img src=\"https://gw.alicdn.com/tfs/TB1n.yuSXXXXXacaXXXXXXXXXXX-345-228.png\" alt=\"resources structure\"></p>\n<p>其中：</p>\n<ul>\n<li>Data Block 存储具体的 k-v 数据</li>\n<li>Meta Block 存储索引过滤信息，用于快速定位 key 是否存在于 Data Block 中</li>\n<li>Meta Index Block 存储 Meta Block 的偏移位置及大小</li>\n<li>Index Block 存储 Data Block 的偏移位置及大小</li>\n<li>Footer 则存储 Meta Index Block 和 Index Block 的偏移位置及大小，相当于二级索引，Footer 的结构如下：<br>\n<img src=\"https://gw.alicdn.com/tfs/TB1C9DXSXXXXXcyXXXXXXXXXXXX-197-140.png\" alt=\"resources structure\"></li>\n</ul>\n<p>另外 Data Block 及 Meta Block 的存储格式是统一的，都是如下格式：</p>\n<p><img src=\"https://gw.alicdn.com/tfs/TB1X9qPSXXXXXbwXFXXXXXXXXXX-435-67.png\" alt=\"resources structure\"></p>\n<p>其中 type 表示是否是压缩存储，目前 LevelDB 支持 key 值的 snappy 压缩或者不压缩。</p>\n<p>而上图中的 Block data 的格式则为：</p>\n<p><img src=\"https://gw.alicdn.com/tfs/TB11UGqSXXXXXaEaXXXXXXXXXXX-819-359.png\" alt=\"resources structure\"></p>\n<p>上图有几点要说明：</p>\n<ol>\n<li>对于 Block data 中的第一项总是不压缩存储的，不压缩存储的项称为 restarts，会被记录在上图的最尾部，同时每隔 k 个值（k 值可定制），都会存储一个不压缩的项，这些都称为 restarts，都会被记录在最尾部。</li>\n<li>每个 restarts 表项会作为索引项存储。</li>\n<li>除了 restarts 表项以外，其它的表项则基于该 restarts 项，计算跟他相同部分和不同部分，上图中的 shared_bytes 和 unshared_bytes 记录了相同部分长度和不同部分的长度，key_delta 则记录了不同的部分的值，value_length 和 value 则记录了 value 部分的值。</li>\n<li>压不压缩是可选的，默认会进行 snappy 压缩。</li>\n</ol>\n<p>对于 Meta Block 来说，它保存了用于快速定位 key 是否在 Data Block 中的信息，具体方法是：</p>\n<ol>\n<li>采用了 bloom filter 的过滤机制，bloom filter 是一种 hash 机制，它对每一个 key，会计算 k 个 hash 值，然后在 k 个 bit 位记录为 1。当查找时，相应计算出 k 个 hash 值，然后比对 k 个 bit 位是否为 1，只要有一个不为 1，则不存在。</li>\n<li>对于每一个 Data Block，所有的 key 值会传入进行 bloom filter 的 hash 计算，每个 key 存储 k 个 bit 位值。</li>\n</ol>\n<h4 id=\"版本管理\">版本管理</h4>\n<p>对于 LevelDB 来说，它采用了简单的 sequence num 机制来管理，具体为：</p>\n<ol>\n<li>对于 Op log 文件，每一个 Op log 文件名中会包含一个唯一的 sequence num，每创建一个新的 Op log 文件，sequence num 则加 1，sequence num 越大，则表示文件越新，同时最新的 sequence num 会记录下来。</li>\n<li>对于每个 key-value 对，也会对应一个 sequence num，对于同一个 key，如果后续更新值时，sequence num 也会相应更新，这样就可以根据 sequence num 的大小，找到最新的 key-value 对</li>\n</ol>\n<h4 id=\"新增特性\">新增特性</h4>\n<ol>\n<li>支持模糊查询该功能支持 key 以模糊规则匹配的方式进行数据库查询，支持＊和？两种模糊规则查询。</li>\n<li>支持 JSON 格式数据存储该功能支持 k-v 中，v以json格式传入，后续可以通过关键字，查询json里面的数据。</li>\n</ol>\n<h4 id=\"结束语\">结束语</h4>\n<p>LevelDB 短小精悍，代码运行效率高效，且通俗易懂，是一个非常不错的 k-v 存储系统。</p>\n<p>注：图片来源于网络</p>\n<blockquote><p>题图：<a href=\"https://unsplash.com/photos/9wwF-VmSOrY\" target=\"_blank\" rel=\"external\">https://unsplash.com/photos/9wwF-VmSOrY</a> By @eberhard grossgasteiger</p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111792\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111792votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111792\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "a59acd84141cd48da7828b24421ff6cb", "praise_num": 3, "tags": "IT技术", "fav_nums": 5, "title": "性能优化知多少", "comments_num": 0, "create_date": "2017/07/05", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/7e8f770aaadb755d790b921b68fb2214.png"], "front_image_path": "full/5b48951660a3dd574009dd9dfb69981fce68b26a.jpg", "url": "http://blog.jobbole.com/111734/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/sheng-jie/p/7109385.html\">『圣杰』</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7e8f770aaadb755d790b921b68fb2214.png\"></p>\n<div id=\"cnblogs_post_body\">\n<h1 id=\"引言\">1. 引言</h1>\n<p>最近一段时间，系统新版本要发布，在beta客户测试期间，暴露了很多问题，除了一些业务和异常问题外，其他都集中在性能上。有幸接触到这些性能调优的机会，当然要学习总结了。</p>\n<p>性能优化是一个老生常谈的问题了，典型的性能问题如页面响应慢、接口超时，服务器负载高、并发数低，数据库频繁死锁等。而造成性能问题又有很多种，比如磁盘I/O、内存、网络、算法、大数据量等等。我们可以大致把性能问题分为四个层次：代码层次、数据库层次、算法层次、架构层次。<br>\n所以下面我会结合实际性能优化案例，和大家分享下性能调优的工具、方法和技巧。</p>\n<h1 id=\"先说心态\">2. 先说心态</h1>\n<p>说到性能问题，你可能首先就想到的是麻烦或者头大，因为一般性能问题都比较紧急，轻则影响客户体验，重则宕机导致财务损失，而且性能问题比较隐蔽，不易发现。因此一时间无从下手，而这时我们就很容易从心底开始去排斥它，不愿接这烫手的山芋。</p>\n<p>而恰巧，性能调优是体现程序员水平的一个重要指标。</p>\n<blockquote><p>因为处理bug、崩溃、调优、入侵等突发事件比编程本身更能体现平庸程序员与理想程序员的差距。当面对一个未知的问题时，如何定位复杂条件下的核心问题、如何抽丝剥茧地分析问题的潜在原因、如何排除干扰还原一个最小的可验证场景、如何抓住关键数据验证自己的猜测与实验，都是体现程序员思考力的最好场景。是的，在衡量理想程序员的标准上，思考力比经验更加重要。</p></blockquote>\n<p>所以，若你不甘平庸，请拥抱性能调优的每一个机会。当你拥有一个正确的心态，你所面对的性能问题就已经解决了一半。</p>\n<h1 id=\"再说技巧\">3. 再说技巧</h1>\n<p>拿到一个性能问题，不要忙着先上工具，先了解问题出现的背景，问题的严重程度。然后大致根据自己的经验积累作出预估。比如客户来了个性能问题说系统宕机了，已经造成资金损失了。这种涉及到钱的问题，大家都比较敏感，根据自己的level，决定是否要接这个锅。这不是逃避，而是自知之明。</p>\n<p>了解问题背景之后，下一步就来尝试问题重现。如果在测试环境能够重现，那这种问题就很好跟踪分析。如果问题不能稳定重现或仅能在生产环境重现，那问题就相对比较棘手，这时要立刻收集现场证据，包括但不限于抓dump、收集应用程序以及系统日志、关注CPU内存情况、数据库备份等等，之后不妨再尝试重现，比如恢复客户数据库到测试环境重现。</p>\n<p>不管问题能否重现，下一步，我们就要大致对问题进行分类，是代码层次的业务逻辑问题还是数据库层次的操作耗时问题，又或是系统架构的吞吐量问题。那如何确定呢？而我倾向于先从数据库动手。我的习惯做法是，使用数据库监控工具，先跟踪下Sql耗时情况。如果监控到耗时较长的SQL语句，那基本上就是数据库层次的问题，否则就是代码层次。若为代码层次，再研究完代码后，再细化为算法或架构层次问题。</p>\n<p>确定问题种类后，是时候上工具来精准定位问题点了：</p>\n<ul>\n<li>Sql耗时问题，推荐使用免费的<a href=\"https://www.sentryone.com/plan-explorer\">Plan Explorer</a>分析执行计划。</li>\n<li>代码问题定位，优先推荐使用VS自带的Performance Analysis，其次是RedGate的性能分析套件<a href=\"http://www.red-gate.com/products/dotnet-development/dotnet-developer-bundle/\">.NET Developer Bundle</a>；然后还有Jet Brains的<a href=\"http://www.jetbrains.com/profiler/?fromMenu\">dotTrace — .NET performance profiler</a>，<a href=\"http://www.jetbrains.com/dotmemory/?fromMenu\">dotMemory– .NET memory profiler</a>；再然后就是反人类的Windbg；等等。</li>\n</ul>\n<p>精准定位问题点后，就是着手优化了。相信到这一步，就是优化策略的选择了，这里就不展开了。</p>\n<p>优化后，最后当然要进行测试了，毕竟优化了多少，我们也要做到心里有谱才行。</p>\n<p>以上啰啰嗦嗦有点多，下面我们直接上案例。</p>\n<h1 id=\"案例分享\">4. 案例分享</h1>\n<p>下面就分享下我针对代码层面、数据库层面和算法层面的优化案例。</p>\n<h1 id=\"sql优化案例\">4.1. SQL优化案例</h1>\n<blockquote><p>案例1：客户反馈某结算报表统计十天内的数据耗时10mins左右。</p></blockquote>\n<p>由于前几天刚学会用RedGate的分析工具，拿到这个问题，本地尝试重现后，就直接想使用工具分析。然而，这工具在使用webdev模式起站点时，总是报错，而当时时一根筋，老是想解决这个工具的报错问题。结果，白白搞了半天也没搞定。最后不得已放弃工具，转而选择使用sql server profiler去监控sql语句耗时。一跟踪不要紧，问题就直接暴露了，整个全屏的重复sql语句，如下图。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/06c352459b736d66075fe293d43e97f3.png\" alt=\"Sql Profiler监控结果\"></p>\n<p>这下问题就很明显了，八成是代码在循环拼接sql执行语句。根据抓取到sql关键字往代码中去搜索，果然如此。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f4c5ab11b529282791\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#region更新三张表数据结合的中间临时表数据，有上游单据的直接调拨单分多次下推时，只计算一次的调拨数量和价税合计\r\nstring sSql = string.Format(@\r\n\"SELECT FENTRYID FROM {0} GROUP BY FENTRYID HAVING COUNT(FENTRYID) &gt; 1\", sJoinDataTempTable);\r\nusing(IDataReader reader = DBUtils.ExecuteReader(this.Context, sSql)) {\r\n    while (reader.Read()) {\r\n        sbSql.AppendFormat(@\"\r\nUPDATE {0} SET FDIRECTQTY = 0,FALLAMOUNT = 0 \r\nWHERE FSEQ NOT IN (\r\nSELECT TOP 1 FSEQ FROM {0} WHERE FENTRYID = {1}) AND FENTRYID = ({1});\"\r\n, sJoinDataTempTable, Convert.ToInt32(reader[\"FENTRYID\"]));\r\n        listSqlObj.Add(new SqlObject(sbSql.ToString(), new List &lt; SqlParam &gt; ()));\r\n        sbSql.Clear();\r\n    }\r\n}\r\n#endregion</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab11b529282791-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab11b529282791-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab11b529282791-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab11b529282791-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab11b529282791-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab11b529282791-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab11b529282791-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab11b529282791-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab11b529282791-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab11b529282791-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab11b529282791-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab11b529282791-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab11b529282791-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab11b529282791-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab11b529282791-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f4c5ab11b529282791-1\"><span class=\"crayon-p\">#region更新三张表数据结合的中间临时表数据，有上游单据的直接调拨单分多次下推时，只计算一次的调拨数量和价税合计</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab11b529282791-2\"><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sSql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab11b529282791-3\"><span class=\"crayon-s\">\"SELECT FENTRYID FROM {0} GROUP BY FENTRYID HAVING COUNT(FENTRYID) &gt; 1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sJoinDataTempTable</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab11b529282791-4\"><span class=\"crayon-e\">using</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">IDataReader </span><span class=\"crayon-v\">reader</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DBUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ExecuteReader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sSql</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab11b529282791-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">reader</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab11b529282791-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sbSql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">AppendFormat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab11b529282791-7\"><span class=\"crayon-s\">UPDATE {0} SET FDIRECTQTY = 0,FALLAMOUNT = 0 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab11b529282791-8\"><span class=\"crayon-s\">WHERE FSEQ NOT IN (</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab11b529282791-9\"><span class=\"crayon-s\">SELECT TOP 1 FSEQ FROM {0} WHERE FENTRYID = {1}) AND FENTRYID = ({1});\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab11b529282791-10\"><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sJoinDataTempTable</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Convert</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ToInt32</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">reader</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"FENTRYID\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab11b529282791-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">listSqlObj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SqlObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sbSql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ToString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SqlParam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab11b529282791-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sbSql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab11b529282791-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab11b529282791-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab11b529282791-15\"><span class=\"crayon-p\">#endregion</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>看到这段代码，咱先不评判这段代码的优劣，因为毕竟代码注释清晰，省了我们理清业务的功夫。这段sql主要是想做去重处理，很显然选用了错误的方案。改后代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f4c5ab128612498509\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstring sqlMerge = string.Format(@\"\r\nmerge into {0} t1\r\nusing(\r\nselect min(Fseq) fseq,Fentryid from {0} t2 group by fentryid\r\n) t3 on (t1.fentryid = t3.fentryid and t1.fseq &lt;&gt; t3.fseq)\r\nwhen matched then\r\nupdate set t1.FDIRECTQTY = 0, t1.FALLAMOUNT = 0\r\n\", sJoinDataTempTable);\r\n\r\nlistSqlObj.Add(new SqlObject(sqlMerge, new List &lt; SqlParam &gt; ()));\r\nsbSql.Clear();</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab128612498509-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab128612498509-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab128612498509-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab128612498509-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab128612498509-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab128612498509-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab128612498509-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab128612498509-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab128612498509-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab128612498509-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab128612498509-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f4c5ab128612498509-1\"><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sqlMerge</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab128612498509-2\"><span class=\"crayon-s\">merge into {0} t1</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab128612498509-3\"><span class=\"crayon-s\">using(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab128612498509-4\"><span class=\"crayon-s\">select min(Fseq) fseq,Fentryid from {0} t2 group by fentryid</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab128612498509-5\"><span class=\"crayon-s\">) t3 on (t1.fentryid = t3.fentryid and t1.fseq &lt;&gt; t3.fseq)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab128612498509-6\"><span class=\"crayon-s\">when matched then</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab128612498509-7\"><span class=\"crayon-s\">update set t1.FDIRECTQTY = 0, t1.FALLAMOUNT = 0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab128612498509-8\"><span class=\"crayon-s\">\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sJoinDataTempTable</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab128612498509-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab128612498509-10\"><span class=\"crayon-v\">listSqlObj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SqlObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sqlMerge</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SqlParam</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab128612498509-11\"><span class=\"crayon-v\">sbSql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>改后测试相同数据量，耗时由10mins降到10s左右。</p>\n<h1 id=\"代码优化案例\">4.2. 代码优化案例</h1>\n<blockquote><p>案例2：客户反馈销售订单100条分录行，保存进行可发量校验时，耗时7mins左右。</p></blockquote>\n<p>拿到这个问题后，本地重现后，监控sql耗时没有异常，那就着重分析代码了。因为可发量校验的业务逻辑极其复杂，又加上又直接再一个类文件实现该功能，3500+行的代码，加上零星注释，真是让人避之不及。逃避不是办法，还是上工具分析一把。<br>\n这次我选用的时VS自带的<strong><a href=\"https://msdn.microsoft.com/en-us/library/ms182372.aspx\">Performance Profiler</a></strong>，开发环境下极其强大的性能调优工具。针对我们当前案例，我们仅需要跟踪指定服务对应的dll即可，使用步骤如下：</p>\n<ol>\n<li>Analyze–&gt;Profiler–&gt;New Performance Session</li>\n<li>打开Performance Explorer</li>\n<li>找到新添加的Performance Session，右键Targets，然后选择Add Target Binary，添加要跟踪的dll文件即可</li>\n<li>将应用跑起来</li>\n<li>选中Performance Session，右键Attach对应进程即可跟踪分析性能了</li>\n<li>在跟踪过程中，可随时暂停跟踪和停止跟踪</li>\n</ol>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/864dcb9eca7c345f430a8da89eac5fd1.png\" alt=\"图示步骤\"></p>\n<p>跟踪结束后本案例跟踪到的采样结果如下图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9647efb1b254108019ea972563dc630f.png\" alt=\"VS Performance Profiler分析报告\"></p>\n<p>同时Performance Profiler也给出了问题的建议，如下图：<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/88c42b11fa5d0dd0e4471c3d0bccaf10.png\" alt=\"VS Performance Profiler分析提示\"></p>\n<p>其中第1、4条大致说明程序I/O消耗大，第一代的GC上存在未及时释放的垃圾占比过高。而根据上图的采样结果，我们可以直接看出是由于再代码中频繁操作DataTable引起的性能瓶颈。走读代码发现的确如此，所有的数量统计都是在代码中循环遍历DataTable进行处理的。而最终的优化策略，就相当于一次大的重构，将所有代码中通过遍历DataTable的计算逻辑全部挪到SQL中去做。由于代码过多，就不再放出。</p>\n<blockquote><p>案例3：客户反馈批量引入1000张订单，耗时40mins左右，且容易中断。</p></blockquote>\n<p>同样，我们还是先尝试本地重写。经测试批量引入101张单据，就耗时5mins左右。下一步打开Sql监控工具也未发现耗时语句。但考虑到是批量导入操作，虽然单个耗时不多，但乘以100这个基数，就明显了。下面我们就使用RedGate的<a href=\"http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/\">Ants Performance Profiler</a>跟踪一下。</p>\n<p>该工具比较直观，可以同时监控代码和SQL执行情况。第一步，New Profiler Session，第二步进行设置，如下图。根据自己的应用程序类别，选择相应的跟踪方式。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/12d765271a5c2637c6242b6a4df95256.png\" alt=\"跟踪设置\"></p>\n<p>针对这个问题，我们跟踪到的调用堆栈和SQL耗时结果如下图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9610679af9557a4ae695b8b1c675c787.png\" alt=\"调用堆栈监控结果\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/754712efddfa3eb40a7eb32b192db06c.png\" alt=\"SQL监控结果\"></p>\n<p>首先从调用堆栈中的Hit Count，我们可以首先看出它是一个批量过程，因为入口函数仅调用一次；第二个我们可以代码中是循环处理每一个单据，因为Hit Count与我们批量引入的单据数量相符；第三个，突然来了个10201，如果有一定的数字敏感性的话，这次性能问题的原因就被你找到了。这里就不卖关子了，101 x 101 = 10201。<br>\n是不是明白了什么，存在循环嵌套循环的情况。我们走读代码确定一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5965f4c5ab12e832364111\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//Save.cs\r\npublic override void EndOperationTransaction(EndOperationTransactionArgs e) {\r\n    //省略其他代码\r\n    foreach(DynamicObject dyItem in e.DataEntitys) {\r\n        //反写收款单\r\n        WriteBackReceiveBill wb = new WriteBackReceiveBill();\r\n        wb.WriteBackForSave(e, this.Context);\r\n    }\r\n}\r\n\r\n//WriteBackReceiveBill .cs\r\npublic void WriteBackForSave(EndOperationTransactionArgs e, Context contx) {\r\n    //省略其他代码：\r\n    foreach(DynamicObject item in e.DataEntitys) {\r\n        //do something \r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab12e832364111-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab12e832364111-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab12e832364111-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab12e832364111-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab12e832364111-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab12e832364111-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab12e832364111-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab12e832364111-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab12e832364111-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab12e832364111-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab12e832364111-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab12e832364111-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab12e832364111-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab12e832364111-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab12e832364111-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5965f4c5ab12e832364111-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5965f4c5ab12e832364111-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5965f4c5ab12e832364111-1\"><span class=\"crayon-c\">//Save.cs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab12e832364111-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">override </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EndOperationTransaction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">EndOperationTransactionArgs</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab12e832364111-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//省略其他代码</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab12e832364111-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">DynamicObject </span><span class=\"crayon-e\">dyItem </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataEntitys</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab12e832364111-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//反写收款单</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab12e832364111-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">WriteBackReceiveBill </span><span class=\"crayon-v\">wb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WriteBackReceiveBill</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab12e832364111-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">WriteBackForSave</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab12e832364111-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab12e832364111-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab12e832364111-10\"> </div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab12e832364111-11\"><span class=\"crayon-c\">//WriteBackReceiveBill .cs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab12e832364111-12\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WriteBackForSave</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">EndOperationTransactionArgs</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Context </span><span class=\"crayon-v\">contx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab12e832364111-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//省略其他代码：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab12e832364111-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">DynamicObject </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataEntitys</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab12e832364111-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//do something </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5965f4c5ab12e832364111-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5965f4c5ab12e832364111-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>好嘛，外层套了一个空循环却什么也没做。修改就很简单了，删除无效外层循环即可。</p>\n<h1 id=\"算法优化案例\">4.3. 算法优化案例</h1>\n<blockquote><p>案例4：某全流程跟踪报表超时。</p></blockquote>\n<p>这个报表是用来跟踪所有单据从下单到出库的业务流程数据流转情况。而所有的流程数据都是按照树形结果存储在数据库表中的，类似这样：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1a5f6eb8189dc0b3c9fa092e00488f2e.png\" alt=\"流程树表\"></p>\n<p>图中的流程为：<br>\n销售合同–&gt;销售订单–&gt;发货通知单–&gt;销售出库单</p>\n<p>为了构造流程图，之前的处理方法是把流程数据取回来，通过代码构造流程图。这也就是性能差的原因。</p>\n<p>而针对这种情况，就是考验我们平时经验积累了。对于树形结构的表，我们也是可以通过SQL来进行直接查询的，这就要用到了SQL Server的CTE语法来进行递归查询。关于递归查询，可参考我这篇文章：<a href=\"http://www.jianshu.com/p/ab9d268aa54c\">SQL递归查询知多少</a>。这里就不展开了。</p>\n<h1 id=\"总结\">5.总结</h1>\n<p>性能调优是一个循序渐进的过程，不可能一蹴而就，重在平时的点滴积累。关于工具的选择和使用，本文并未展开，也希望读者也不要纠结与此。当你真正想解决一个问题的时候，相信工具的使用是难不住你的。</p>\n<p>最后就大致总结下我的调优思路：</p>\n<ol>\n<li>调整心态，积极应对</li>\n<li>了解性能背景， 收集证据， 尝试重现</li>\n<li>问题分类，先监控SQL耗时，大致确定是SQL或是代码层次原因</li>\n<li>使用性能分析工具，确定问题点</li>\n<li>调优测试</li>\n</ol>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111734\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111734votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111734\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "22720e0ebb8efa08e36bb42b57357be2", "praise_num": 3, "tags": "职场", "fav_nums": 3, "title": "累到想删库，程序员职业倦怠的真实现状", "comments_num": 1, "create_date": "2017/07/10", "front_image_url": ["https://static1.squarespace.com/static/533ad9bde4b098d084a846b1/t/534f6e1ce4b09b70f38ee6c1/1432265542589/DSCF3147.jpg?format=500w"], "front_image_path": "full/5e8775a4506c4ad37e2e965d436efb7888507510.jpg", "url": "http://blog.jobbole.com/111762/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.kennethreitz.org/essays/the-reality-of-developer-burnout\">kennethreitz</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：Kenneth Reitz 是一个知名的程序员，特别是在 Python 圈，他编写了 Requests / Records / Maya 等著名 Python 库，出过书《The Hitchhiker’s Guide to Python》。他在从 2001 年起就职于 Heroku，同时还是 Python 软件基金会董事会成员。对了，他以前还是个大胖子，2016 年后来减肥成功。他喜欢街拍，并且还是一个电子音乐制作人。</p>\n<p><img class=\"aligncenter\" src=\"https://static1.squarespace.com/static/533ad9bde4b098d084a846b1/t/534f6e1ce4b09b70f38ee6c1/1432265542589/DSCF3147.jpg?format=500w\" width=\"500\" height=\"333\"></p>\n<p>很不幸，倦怠在软件开发中是一个非常真实的现象，尤其是创立并维护一个具有大量用户的开源项目。就这个话题，我深有体会。所以我来分析我的个人经验。</p>\n<p>即使软件编程是你在这世上最喜欢的活动之一，每个整天写代码的人都会经历这样的事情，突然感觉“我想做别的事情，而不是坐在这写代码”。</p>\n<blockquote><p>你突然意识到，你已把冰激凌当成三餐，持续吃了好几年。你已厌倦了冰淇淋，不想再看到它。但偶尔吃冰淇淋的人不明白这一点，他们会想：你怎么会不想要冰淇淋了呢？—— Gary Bernhardt</p></blockquote>\n<p>我对软件开发的倦怠情况有一些个人经验，还有几个如何正视、防范和简单应对的小窍门。</p>\n<h3>目标的必然衰败</h3>\n<p>在 2011 年，我为自己设定了一些开源社区的目标后，我很努力地为此工作，有着好运相伴，我取得了成功（特别是 Requests 项目）。随着项目的人气不断攀升，我对继续创建新项目的动力下降了。同时，为了满足成功项目带来的大量用户群所提出的要求，我的负担越来越重，而维护项目的压力也在不断增加。</p>\n<p>这是我想要的，是吗？</p>\n<blockquote><p>倦怠十分狡猾，它悄然而至。它慢慢地折磨你，直到你认为这种感觉已经成为了新常态，这时你再也无法轻易跳出自己挖的坑了。—— Zach Holman</p></blockquote>\n<h3>410 GONE 网络失踪</h3>\n<p>我记得曾经有一次，我躺在沙发上，也就是我现在坐的地方，一边解决新出现的慢性偏头痛 (NDPH)，一边回顾我的生活。就像看推文一样，我不断地刷新并思考过当时软件世界中的一些政治问题，我发现自己对这些事情非常紧张，这本身就是一个问题。不仅如此，而且我过于在意我在推特上关注的人提出的公开观点，</p>\n<p>一旦我认识到这一点，我立刻意识到这是一个很严重的问题，必须立即停止它。我的第一个想法是提出所谓的“410 错误”情况。当然，我没有这样做，但是我很重视这个问题。</p>\n<blockquote><p>410 GONE 是 Mark Pilgrim 的一个沸沸扬扬的举动，他作为 Python 的开发者以及一个普通人，因为一些未知的原因，选择将自己从开发者社区隔离。我认为这可能是因为他感受到了来自开源“领导者”地位的压力，想要保持自己的身份认同。他突然从互联网上删除了所有的公共代码，这样所有的用户只能重新定向，访问其他非官方镜像。</p>\n<p>伯乐在线补注：Mark Pilgrim 是《Dive into Python | 深入 Python》的作者。他不仅删代码，并且他的社交账号 GitHub、Google+、Reddit、Twitter，也全部清空了。</p></blockquote>\n<p>在我看来，这是倦怠周期的缩影以及最坏的情况。我差一点就从 GitHub 上删除所有的项目，从 SpeakerDeck 上删除所有演讲的幻灯片，搞掉我自己的网站，然后在平静的生活中继续前进。</p>\n<p>但最后我没有这样做，为什么？因为这些是世界上对我最重要的事情。为什么我要破坏那些我努力创造、引以为傲的东西？</p>\n<h3>“只发布”模式</h3>\n<p>所以，我决定找到问题的根源，并解决它们。我意识到，我的世界已经挤入太多人，没有委派足够的人手，并且需要他人的帮助来维持我的项目。我不想失去我在社区中珍视的位置，它能够影响这个我极其重视的世界。</p>\n<p>所以，我选择取消关注推特上的所有人。我停止关注科技趋势，也不再阅读 Hacker News。我进入了“只发布”模式。</p>\n<p>这是一个重大的举措，就和我见过的很多其他开发者一样（一般比较隐晦，并不明确），这是一个从开源软件开发中，缓解压力的好方法。远离喧嚣，善待自己。</p>\n<p>今天，我在社交媒体上关注了一些人，人数不多，但足以让我处于一个相对较忙的状态，而过去很长一段时间我都过于忙碌了。这一切很容易就能实现。</p>\n<h3>委派</h3>\n<p>当成千上万的活跃用户使用你的软件，或即使只有你的同事时，你很容易感到懈怠，因为你是项目的唯一联系人。所以，我已经学会以新的方式委托并加强合作。</p>\n<p>针对 Requests 项目，我有两个合作维护者，他们帮忙处理收到的问题（issues），并解决诸如安全更新的事情。这大大降低了项目施加在我身上的压力，也帮助他们成为了 Python 社区的活跃分子。</p>\n<h3>我今天的平衡生活</h3>\n<p>所有的这些都是许多年前的事了，如今我的生活已经取得了一个良好的平衡。我在个人的兴趣爱好，如音乐制作、摄影上花费了大量的空闲时间（我甚至今年要出一张专辑）。我今年出版了一本书，另一个人花了大量的时间与精力参与其中，这本书的出版离不开他/她的鼎力相助。</p>\n<p><span style=\"color: #ff0000;\">有着写代码以外的爱好，实在是太重要了。</span></p>\n<p>我没有和往常那样，将编程作为一项娱乐消遣的工作，但我将再一次重新出发。我不觉得现在缺少了什么，但我的夜生活已经不同往昔，不再 100% 被代码完全占据了。</p>\n<p>开源的本质就是合作/协作。如果你发现自己倦怠了，累了，也许你需要找到一种与他人协作的新方式，来帮助你做最好的事情。你会发现，其他人可以通过做他们擅长的事，来帮助你做自己擅长的事。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111762\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111762votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111762\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 26</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "da181fa9746cff2a3a3ca3f1b082c055", "praise_num": 5, "tags": "职场", "fav_nums": 4, "title": "程序员偷偷自动化，每周才工作几小时却拿全薪，这样道德么？", "comments_num": 7, "create_date": "2017/07/06", "front_image_url": ["http://ww2.sinaimg.cn/mw690/63918611gw1f5idukigfrj20fw07yt9o.jpg"], "front_image_path": "full/55b1132af682daa4944e35728414d9d865d4670f.jpg", "url": "http://blog.jobbole.com/111742/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.sciencealert.com/programmers-are-secretly-automating-their-jobs-and-only-working-a-few-hours-a-week\">Julie Bort</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>就在上周，程序员们在 StackExchange 上有<a href=\"https://workplace.stackexchange.com/questions/93696/is-it-unethical-for-me-to-not-tell-my-employer-i-ve-automated-my-job/94099#94099\" target=\"_blank\">激烈的讨论</a>，如果偷偷把自己的工作自动化，是不是不道德？</p>\n<p><img class=\"alignnone\" src=\"http://ww2.sinaimg.cn/mw690/63918611gw1f5idukigfrj20fw07yt9o.jpg\" width=\"572\" height=\"286\"></p>\n<p>这次讨论的源于 Etherable 于 6 月 27 日在 StackExchange 上发的一个帖子，全文翻译如下：</p>\n<blockquote><p>我目前在给一家公司的遗留系统工作。这个系统真的是很老了，尽管我的角色是程序员，但我大部分工作却是美化数据。总结一下，我有一堆需求，实际上是每月电子表格中的大量数据，我必须把系统配置好，保证运行。这工作基本就是编写一大堆的 SQL 脚本。</p>\n<p>不过这并不是一份很简单的活，因为最初开发这个系统的人写反了。实际上，创建电子表单的分析师要花很多时间来验证我的工作。原因是我这活太繁杂，易出错。</p>\n<p>正如你猜到的，这活非常枯燥。然而，这份全职工作薪水可观，并且允许远程，我还可以陪儿子。</p>\n<p>这份工作我做到大概 18 个月的时候，我基本摸清了所有套路，然后我编写了一个自动化程序，并且我过去 6 个月的活，都是交给它了。所以，过去要 1 人做 1 个月的事，现在可能 10 分钟就可以了。</p>\n<p>现在的问题是，我是否应该告诉公司？如果我告诉他们了，他们或许采纳自动化程序，然后不要我了。这并不像是一个有着大量 IT 工作的公司，他们是有一个遗留系统，一直来保存所有的客户数据，他们只是需要有人来维护这个系统。</p>\n<p>同时，我也觉得自己做的不对。我的意思是，现在只要我拿到了（公司下发的）规范（spec），然后大约每周运行一次自动化程序。再上报我做完了一部分工作，让他们测试验证。我甚至插入了一些 Bugs，以便让结果看起来更像是人做出来的。</p>\n<p>虽然有时候规范需要修改，加上邮件来回沟通的时间，我每周的实际工作时间约 1-2 小时，但我拿的却是全薪。</p>\n<p>虽然我真的很享受多出来的自由时间，但如果这样不打招呼，继续这样偷偷地做下去，是不是不道德？ 这不比我在欺骗公司。公司从来没有表示他们对我的表现不满意，事实上，他们从雇用我中得到了他们想要的。</p></blockquote>\n<p>这位程序员（Etherable）说，他写了一些脚本，悄悄把原本一周的工作用不到两个小时就做完了，他开始感到有些愧疚了。</p>\n<p>公司雇他做的工作都完成了，但是由于是远程工作，也没告诉他老板脚本的事，因此他基本上整天都在陪儿子。他担心公司发现这些脚本然后解雇他，并非是出于道德原因，而是公司有了脚本以后就不再需要他了。</p>\n<p>他写道：</p>\n<blockquote><p>“不告诉我老板自动化工作的事，不道德吗？……</p>\n<p>你能想象，这大概是世界上最无聊的工作了。但是这也是一份薪水颇丰的全职工作，而且我可以远程工作，在家里陪我的儿子。</p>\n<p>所以我已经做了 18 个月了，在这期间，我差不多发现了所有的套路，在过去的六个月里写了一个程序来帮我完成全部工作。以前别人需要用一个月的时间来清理电子表格，用这个程序大概十分钟就能完成。</p>\n<p>现在的问题是，我要不要告诉他们？如果我说了，他们大概会拿走我的程序然后解雇我。”</p></blockquote>\n<p>还有一件事是：这位程序员也坦白，他会通过故意加一些错误来掩盖自动化的痕迹，“让它看起来像是人工完成的。”</p>\n<p>这个问题也发在了<a href=\"https://news.ycombinator.com/item?id=14656945\"> Hacker News</a> 上，引起了激烈的讨论。</p>\n<p>有趣的是，在参与评论的这几十个程序员中，人们分成了两大阵营：<strong>该行为道德和不道德</strong>。</p>\n<h3>你这不道德</h3>\n<p>Stack Overflow 上的人普遍倾向于这种情况不道德。一个叫 <a href=\"https://workplace.stackexchange.com/questions/93696/is-it-unethical-for-me-to-not-tell-my-employer-i-ve-automated-my-job#comment279618_93700\">Magisch</a> 的用户甚至说这位程序员在“诈骗你的老板”。</p>\n<p><a href=\"https://workplace.stackexchange.com/a/93704\">Joe Strazzere</a> 很好地总结了这一派的观点：</p>\n<ul>\n<li><strong>你用每周 1-2 个小时在家里工作（陪儿子），但是却拿着 40 个小时的工资</strong></li>\n<li><strong>你 6 个月前写的这个程序，但是到现在都没告知你的老板</strong></li>\n<li><strong>几乎每周你都在对你的工作成果撒谎</strong></li>\n<li><strong>你故意在程序里插入错误来挽救你的骗局</strong></li>\n<li><strong>你还要让创建表格的分析师花费相当多的时间来检查你的工作</strong></li>\n<li><strong>你承认“感觉自己做了错事”</strong></li>\n</ul>\n<blockquote><p>即使答案在我看来已经很明显了，但是你个人的道德标准让你得出了这样并没什么问题的结论。尽管我怀疑你知道真相……”</p></blockquote>\n<p>另一个<a href=\"https://workplace.stackexchange.com/a/94099\">程序员 SSight3</a> 承认他曾经也自动化做过类似的工作，但是他说自己不属于不道德的原因是，他告诉了他的老板：</p>\n<blockquote><p>“我的情况是，我本来是要做半年的无脑输入数据的工作，但是我自动化了这个过程并且把方法公开给了我的老板。我现在被分配到一个更适合我的天赋和能力的部门。”</p></blockquote>\n<p>他说这个自动化的工作最终使他免于部门的后期裁员。</p>\n<p>大多数站在认为此行为不道德的阵营的人坚信，即使他不能承认已经用这个脚本多久，以及他的工作时间有多短，他仍有义务告诉他的老板关于脚本的事。</p>\n<h3>错误的动机</h3>\n<p>但是 Hacker News 的朋友们提出了另一种观点。</p>\n<p>很多人认为，<strong>只要公司拿到了他们花钱想要的结果，那这个人用多少时间去完成都无所谓</strong>。尽管这个阵营的人也同意，故意制造一些 bug 确实是错的。</p>\n<p><a href=\"https://news.ycombinator.com/user?id=barrkel\">其中一个人写道</a>：“我不认为这里有什么道德问题，只有交易关系——支付工资，创造价值。如果公司用另一种方法能花更少的钱达到目的，它就会采用这种方法并解雇员工。这种事可以避免吗？这位员工正在为公司创造价值，他正在守护自己（和公司）讨价还价的底线，毕竟公司一直都在剥削员工。”</p>\n<p>另一位程序员表示他在做网页的时候也有<a href=\"https://news.ycombinator.com/item?id=14657663\">相似的境遇</a>，而且受到了负面的影响：</p>\n<blockquote><p>“他们想按小时付费给我，但是我协商要按页数付费。当然了，我是自动化完成工作的。但出乎我意料的是，即使他们花同样的钱得到了同样的结果，我们也明确地达成协议不按时间付费，而是按产量付费，他们还是很讨厌我写程序自动化工作。”</p></blockquote>\n<p>有人<a href=\"https://news.ycombinator.com/item?id=14657672\">指出</a>，在整个 IT 行业，自动化不是特例，而是规则。拿系统管理这个工作来说，这项工作是确保 IT 系统不出故障。“我知道很多系统管理员自动化完成大多数工作，他们自己只是做一些监控和维护，他们很棒，没人因为这件事儿指责他们，事实上，这是很好的实践。”</p>\n<p>另一个人<a href=\"https://news.ycombinator.com/item?id=14659048\">表示同意</a>。“作为一个系统管理员，我工作的 90% 都是自动化完成的。如果出了问题，我会一周七天 24 小时随叫随到，但是工作中的其他时间，我可以做做杂事，看看电影，玩玩游戏。我所知道的每个系统管理员，几乎都是这样的。”</p>\n<p>一个人说他<a href=\"https://news.ycombinator.com/item?id=14658785\">整个职业生涯</a>中都是自动化工作的，从没隐瞒过：</p>\n<blockquote><p>“五年前，我在一家大公司做着一份入门级的夜班。那六个月里，我几乎用脚本完成了所有工作，大部分时间都在看 Netflix，我也没花什么心思去隐瞒我没事做这件事。</p>\n<p>为此公司奖励我一次升职，然后我做了同样的事（自动化工作）并且又升职了两次。我现在的产出是从前的两倍多，我的职责是告诉别人如何自动化工作。”</p></blockquote>\n<p>一位程序员完美<a href=\"https://news.ycombinator.com/item?id=14662152\">总结</a>了 Hacker News 上的观点：</p>\n<blockquote><p>“他（发帖求助的程序员 Etherable）唯一的错误就是，没能充分利用他的才能和潜在的生产力。对此最好的解决办法，就是找一份更好的工作。”</p></blockquote>\n<p>技术人员对自动化工作并不陌生。2015 年，曾经有过这样一个程序员，他离开公司后才被发现自动化到了这样的程度：甚至连用咖啡机煮一杯拿铁都要自动化。详情请看《<strong><a href=\"http://blog.jobbole.com/95222/\" target=\"_blank\">超过 90 秒的任务不自动化，你好意思说自己是黑客？</a></strong>》</p>\n<p>有趣的是，编程对于需要长时间且难以忍受的工作来说是小有名气的。许多技术人员都这样工作。</p>\n<p>但显然也出现了这样的亚文化：一些人在做相反的事情，创造一些没有他们就进行不下去的工作。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/acb658caeaa7401d5d7d20f28a1eab52.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111742\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111742votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111742\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 7 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">刘唱</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/5f17a18404975a50e3a341f2f8e27d59.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据挖掘研究生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/liuchang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/liuchang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 37</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.csdn.net/github_36299736\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2577872237\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：learningDM\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"url_object_id": "d6c60ad6f33322af9638bd63ca311732", "praise_num": 1, "tags": "职场", "fav_nums": 0, "title": "为什么要招老程序员？这 5 个理由或许说服你", "comments_num": 0, "create_date": "2017/07/12", "front_image_url": ["http://wx2.sinaimg.cn/large/7cc829d3gy1fhhdgxng67j20sg0lc770.jpg"], "front_image_path": "full/aaec96648512ccffa716f4cd61c4a0886166ec66.jpg", "url": "http://blog.jobbole.com/111715/", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://joshondesign.com/2017/07/02/hire_old_programmer\">Josh Marinacci</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32532\">ITEYE/Vincent</a>   </div><p>【导读】： Josh Marinacci 是一名经历很丰富的老程序员了，他从经验、判断力、知识面的广度和深度等 5 个方面，阐述了为什么需要雇佣老程序员的原因。</p>\n<hr>\n<p>你真的应该雇用老程序员。这一点我深信不疑。这些资历比较老的程序员，不会像那些刚从大学里面毕业的学生那样工作那么多时间。他们有孩子、配偶，需要还房贷，有机会还要去看一场比赛。他们不会在办公室里通宵玩 Xbox 和乒乓球，也不会每周工作 80 个小时，实际上他们会利用他们的假期。当然，他们的工资比年轻程序员要高。不管有多少种理由会说雇佣老程序员有哪些不好的地方，但是你仍然需要一名。原因很简单：他们就像巴黎欧莱雅那样值得你拥有。我之所以知道这一点，因为就是其中一员。</p>\n<p><em><img id=\"pic\" class=\"M_cur_zoom_out aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhhdgxng67j20sg0lc770.jpg\" width=\"500\" height=\"375\"></em></p>\n<p style=\"text-align: center;\"><em>(网络图，非本文作者）</em></p>\n<h3>经验</h3>\n<p>老程序员可能无法像25岁时那样，在脑子里保存那么多的代码，但这些人的经验非常丰富。我们知道，每一套系统的规模都在越来越大，大到最后都超过了你的脑容量——无论你的脑袋有多大——所以说能不能记住代码并不是像你想的那么重要。相反，我们知道如何对每个系统进行模块化。我们就是传说中的“10x程序员”，不是因为我们代码写的有多好，而是因为我们已经看穿了一切。我们可以快速了解任何一门新的语言，因为我们已经用了很多年了。我们知道这些开发语言的共同特征。语言这个概念一次又一次地流行起来。只要有足够的时间，我们就能发现其中的相似之处，并突出这些不同点。</p>\n<h3>判断力</h3>\n<blockquote><p>“在低价所获欣喜被遗忘后低质量带来的苦恼会长久保持。” —本杰明.富兰克林</p></blockquote>\n<p>老程序员有更好的判断力。他们知道需要重点测试系统的哪个地方，哪些地方是不需要的。他们可以从架构图中看出可能出现的问题。他们可以告诉你针对特定项目可以运用哪些技术，以及如何优化可靠性、性能或开发速度(选择任意两种)。他们还知道如何做出好的权衡。即使从来没有为你的项目写过一行代码，但是他们也是对得起他们的收入的。他们懂得如何提高质量。从长远来看，质量意味着更低的成本。</p>\n<h3>学识渊博</h3>\n<blockquote><p>“真正的知识来源于对某个主题及其内部工作的深刻理解” —阿尔伯特·爱因斯坦</p></blockquote>\n<p>老程序员在特定领域有很深厚的知识。这些知识帮助他们知道在哪里寻找bug，以及如何避免bug。例如，我非常了解GUI工具包，已经用了几十年了。我曾在三个(Swing、JavaFX 和 SubArctic) 核心团队中工作过。我从头开始构建了自己的工具包，只是为了好玩！我知道UI工具包。我可以写出过去的40年里关于工具箱的详细历史(嗯……也许我应该在某个时候把它写下来)。</p>\n<p>当我在一个新的 GUI 系统上工作时，我可以立即投入进去。如果我看到三个按钮在右边移动了相同的68个像素，那么我就可以立即看出这个 bug 是在三个位置中的一个(可能是全局到局部协调转换代码)。如果你想要创建一个新组件，我可以准确地告诉你需要哪些扩展点。对于UI工具包的工作方式的深入了解，意味着我可以比其他人更快地构建应用程序。我有25年的肌肉记忆，这一点可以帮我壮大我的胆子。关于UI工具包我有着很深厚的知识。对于其他人来说，它可能是内核驱动程序、数据库索引或编译器。关键是，深度知识要比数小时应用或原始编码能力更重要。</p>\n<h3>知识面广</h3>\n<blockquote><p>都是优秀员工的小团队可以轻松击败都是良好或者一般员工的大团队。 —史蒂夫·乔布斯</p></blockquote>\n<p>老程序员都不求甚解。虽然我专门从事应用程序和前端开发，但我已经把整个堆栈都了解得很透彻了。我编写了无内存限制系统的代码。我已经构建了解析器、数据库和固件;甚至还有一个非常糟糕的内核驱动程序。我已经绘制了演示图形并生成了千兆字节的测试数据。你雇用我，应该不是叫我来建立数据库或编写固件或设计你的下一个网站，但我已经足够了解这些系统的工作原理。这意味着我可以和那些在数据库和固件方面的专家交谈。我知道的内容已经足够让我和其他领域的人进行有效的沟通。正是这种沟通技巧使我成为一个富有成效的团队成员，而不是原始的编码能力。</p>\n<h3>沟通技巧</h3>\n<p>任何一名40多岁的程序员都必须具备良好的沟通技巧。这些能力和他们的编程能力一样有价值。对于那些需要用到新的API的开发者们来说，如果没有地去看这些API，那么它们几乎是毫无价值的。很多大型软件项目之所以失败，不是因为糟糕的代码，而是因为沟通出现了问题。</p>\n<p>是的，表面上似乎是花了更多的钱，使得工作量变得更少了，但实际上是变多了。老程序员们可以正确估计并按时运行代码。我们开发出的软件，bug很少，性能表现也不错。虽然我们写的代码少了，但是我们会产生更多的业务价值。这就是我们值得拥有的原因。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111715\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111715votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111715\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}]